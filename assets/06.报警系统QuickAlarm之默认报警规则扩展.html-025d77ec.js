import{_ as p,V as o,W as e,X as c,Y as n,Z as s,$ as t,a1 as l,F as u}from"./framework-094145d2.js";const i={},r=n("p",null,"本篇主要是扩展默认的报警规则，使其能更加友好的支持同时选择多种报警方式",-1),k=n("p",null,"扩展遵循两个原则",-1),d=n("ul",null,[n("li",null,"不影响原有的配置文件格式"),n("li",null,"简化规则解析复杂度")],-1),m=l(`<h2 id="i-配置文件的扩展" tabindex="-1"><a class="header-anchor" href="#i-配置文件的扩展" aria-hidden="true">#</a> I. 配置文件的扩展</h2><p>先看一下原有的配置文件</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NONE&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;yihui&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;erhui&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;yihui&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;NPE,SELFDEFINE&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SMS&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;345345345345&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;123123123123&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;小灰灰Blog&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;greyBlog&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;yihui&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们希望是能够支持多重报警方式同时选中，那么上面的配置中， threshold中只定义了一个阀值参数显然是不合适的，主要问题在于</p><ul><li>单一阀值，不允许不同报警方式存在交叉</li><li>两个报警方式的threshold值相等时，选中的具体是哪个不可预期</li></ul><p>所以我们的目标是将上面的参数中，新增一个指定上限的值max</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NONE&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;yihui&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;erhui&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;yihui&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;NPE,SELFDEFINE&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SMS&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;345345345345&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;123123123123&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;小灰灰Blog&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;greyBlog&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;yihui&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ZZZ&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        <span class="token property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SMS&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;345345345345&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;123123123123&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;yihui&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;erhui&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;EMAIL&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
                <span class="token property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
                <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;yihui@xxx.com&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;erhui@xxx.com&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;yihui@xxx.com&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>向上面这般改动之后，相当于每个报警方式都可以定义自己的区间，因此允许多重报警方式存在区间的交叉，计数在交叉区间即表示选中这多重方式</p><h2 id="ii-扩展的实现支持" tabindex="-1"><a class="header-anchor" href="#ii-扩展的实现支持" aria-hidden="true">#</a> II. 扩展的实现支持</h2><p>从配置文件的变动来看，改动很小，只是新增一个参数而已，且这个参数不是必填的，那么对应的do应该为</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicAlarmThreshold</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> level<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 启用定义的报警方式的阀值下限，
     *
     * 当报警计数 count &gt;= min
     *   - max 非null, count &lt; max 则选择本报警方式; 
    *       count &gt;= max 则不选择本报警方式
     *   - max 为null（即表示为定义时），
     *      则max赋值为:恰好大于 min 的 <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">BasicAlarmThreshold</span><span class="token punctuation">#</span><span class="token field">threshold</span></span><span class="token punctuation">}</span>值
     *
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> threshold<span class="token punctuation">;</span>


    <span class="token doc-comment comment">/**
     * 报警上限值，注意这是包装类型，允许为null
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> max<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后顺带着，优化一把我们的映射规则，将配置规则的DO对象，映射为业务对象</p><p>主要的映射规则如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 将配置项转换为业务DO对象, 会做一些兼容, 保证 level. min, max, users, thresholds 都不会为null
 *
 * <span class="token keyword">@param</span> <span class="token parameter">basicAlarmConfig</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AlarmConfig</span> <span class="token function">parse2BizConfig</span><span class="token punctuation">(</span><span class="token class-name">BasicAlarmConfig</span> basicAlarmConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果没有填写用户, 则直接抛弃</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">AlarmConfig</span> alarmConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果配置的报警类型是异常的, 则下面会兼容一把，设置为 NONE, 避免因为配置的原因导致系统异常</span>
    alarmConfig<span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span><span class="token class-name">SimpleExecuteFactory</span><span class="token punctuation">.</span><span class="token function">getExecute</span><span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    alarmConfig<span class="token punctuation">.</span><span class="token function">setAutoIncEmergency</span><span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">isAutoIncEmergency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 报警用户, 要求用户必须存在</span>
    alarmConfig<span class="token punctuation">.</span><span class="token function">setUsers</span><span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 报警上限, 如果用户没有填写，采用默认的（因为短信报警按条数要钱, 没必要一直无上限的报）</span>
    alarmConfig<span class="token punctuation">.</span><span class="token function">setMaxLimit</span><span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">AlarmConfig</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_MAX_NUM</span> <span class="token operator">:</span> basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 报警下限, 如果用户没有填写, 采用默认的最小值0</span>
    alarmConfig<span class="token punctuation">.</span><span class="token function">setMinLimit</span><span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">AlarmConfig</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_MIN_NUM</span> <span class="token operator">:</span> basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 获取配置中的阀值列表，并排序</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BasicAlarmThreshold</span><span class="token punctuation">&gt;</span></span> basicAlarmThresholdList <span class="token operator">=</span> basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>basicAlarmThresholdList <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        basicAlarmThresholdList <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    basicAlarmThresholdList<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span><span class="token class-name">BasicAlarmThreshold</span><span class="token operator">::</span><span class="token function">getThreshold</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlarmThreshold</span><span class="token punctuation">&gt;</span></span> alarmThresholdList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>basicAlarmThresholdList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AlarmThreshold</span> tmpAlarmThreshold<span class="token punctuation">;</span>
    <span class="token class-name">BasicAlarmThreshold</span> tmpBasicAlarmThreshold<span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> containDefaultExecute <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> basicAlarmThresholdList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmpBasicAlarmThreshold <span class="token operator">=</span> basicAlarmThresholdList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span><span class="token class-name">SimpleExecuteFactory</span><span class="token punctuation">.</span><span class="token function">getExecute</span><span class="token punctuation">(</span>tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setUsers</span><span class="token punctuation">(</span>tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMin</span><span class="token punctuation">(</span>tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> basicAlarmThresholdList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 最后一个，则使用默认的上限阀值</span>
                tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getMaxLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>basicAlarmThresholdList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>containDefaultExecute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            containDefaultExecute <span class="token operator">=</span> tmpBasicAlarmThreshold<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>basicAlarmConfig<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        alarmThresholdList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tmpAlarmThreshold<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">int</span> thresholdSize <span class="token operator">=</span> alarmThresholdList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>thresholdSize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 没有配置阀值列表，直接使用默认</span>
        tmpAlarmThreshold <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setUsers</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMin</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getMinLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getMaxLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmThresholdList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tmpAlarmThreshold<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>containDefaultExecute<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 不包含时默认时，补全</span>
        tmpAlarmThreshold <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setUsers</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMin</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getMinLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>alarmThresholdList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmThresholdList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tmpAlarmThreshold<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>alarmThresholdList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>thresholdSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getMaxLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tmpAlarmThreshold <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setExecutor</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setUsers</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMin</span><span class="token punctuation">(</span>alarmThresholdList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>thresholdSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmpAlarmThreshold<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getMaxLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            alarmThresholdList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tmpAlarmThreshold<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    alarmConfig<span class="token punctuation">.</span><span class="token function">setAlarmThreshold</span><span class="token punctuation">(</span>alarmThresholdList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> alarmConfig<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在映射为业务对象的逻辑中，直接保障了<code>AlarmThreshold</code>列表中的顺序为最终的需求顺序，映射规则为</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  如果配置的basicAlarmThresholdList列表中包含默认的报警方式
 *    - 则报警方式完全按照basicAlarmThresholdList的定义来
 *    - eg: 默认报警为 Log, min=5, max=30
 *    -       basicAlarmThresholdList 中定义为  : <span class="token punctuation">{</span> Log, min=6 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> Email, min=8 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> WeiXin, min=10, max=16 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> SMS, min=14, max=26 <span class="token punctuation">}</span>
 *    - 则转换后的 alarmThresholdList为:
 *    -     <span class="token punctuation">{</span> Log, min=6, max=8 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> Email, min=8, max=10 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> WeiXin, min=10, max=16 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> SMS, min=14, max=26 <span class="token punctuation">}</span>
 *    -       count : [6, 8)  Log
 *    -       count : [8, 10) Email
 *    -       count : [10, 16) WeiXin
 *    -       count : [14, 26) SMS
 *
 *  如果不包含默认报警方式
 *    - 则需要补全最外层定义的Min-Max区间中的空余位
 *    - eg:   默认报警为 Log, min=5, max=30
 *    -       basicAlarmThresholdList 中定义为  : <span class="token punctuation">{</span> Email, min=8 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> WeiXin, min=10, max=16 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> SMS, min=14, max=26 <span class="token punctuation">}</span>
 *    - 则转换后的 alarmThresholdList为:
 *    -       <span class="token punctuation">{</span> Log, min=5, max=8 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> Email, min=8, max=10 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> WeiXin, min=10, max=16 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> SMS, min=14, max=26 <span class="token punctuation">}</span>, <span class="token punctuation">{</span> Log, min=26, max=30 <span class="token punctuation">}</span>
 *    -       count : [5, 8)  Log
 *    -       count : [8, 10) Email
 *    -       count : [10, 16) WeiXin
 *    -       count : [14, 26) SMS
 *    -       count : [26, 30) Log
 *
 *
 *    上面改造后，很容易得知，支持多重报警方式同时工作，即当技术为14，15 时，同时发起WeiXin和SMS报警
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相应的就可以干掉原来不太好懂的Executor选择逻辑，对应的代码为</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// com.hust.hui.alarm.core.execut.AlarmExecuteSelector#getExecute</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExecuteHelper</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExecute</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">AlarmConfig</span> alarmConfig<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 未达到报警的下限 or 超过报警的上限时</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getMinLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> count <span class="token operator">&gt;</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getMaxLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExecuteHelper</span><span class="token punctuation">(</span><span class="token class-name">SimpleExecuteFactory</span><span class="token punctuation">.</span><span class="token function">getExecute</span><span class="token punctuation">(</span><span class="token class-name">NoneExecute</span><span class="token punctuation">.</span><span class="token constant">NAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 未开启报警升级, 直接返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>alarmConfig<span class="token punctuation">.</span><span class="token function">isAutoIncEmergency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExecuteHelper</span><span class="token punctuation">(</span>alarmConfig<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getAlarmThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 未达到报警的下限</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExecuteHelper</span><span class="token punctuation">(</span><span class="token class-name">SimpleExecuteFactory</span><span class="token punctuation">.</span><span class="token function">getExecute</span><span class="token punctuation">(</span><span class="token class-name">NoneExecute</span><span class="token punctuation">.</span><span class="token constant">NAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ExecuteHelper</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">AlarmThreshold</span> alarmThreshold<span class="token operator">:</span> alarmConfig<span class="token punctuation">.</span><span class="token function">getAlarmThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>alarmThreshold<span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> count <span class="token operator">&amp;&amp;</span> count <span class="token operator">&lt;</span> alarmThreshold<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExecuteHelper</span><span class="token punctuation">(</span>alarmThreshold<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alarmThreshold<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span><span class="token punctuation">(</span>alarmThreshold<span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="项目-quickalarm" tabindex="-1"><a class="header-anchor" href="#项目-quickalarm" aria-hidden="true">#</a> 项目: QuickAlarm</h3>`,19),v={href:"https://github.com/liuyueyi/quick-alarm",target:"_blank",rel:"noopener noreferrer"},b={href:"https://liuyueyi.github.io/hexblog/",target:"_blank",rel:"noopener noreferrer"};function h(g,q){const a=u("ExternalLinkIcon");return o(),e("div",null,[r,k,d,c(" more "),m,n("ul",null,[n("li",null,[s("项目地址： "),n("a",v,[s("Quick-Alarm"),t(a)])]),n("li",null,[s("博客地址： "),n("a",b,[s("小灰灰Blog"),t(a)])])])])}const y=p(i,[["render",h],["__file","06.报警系统QuickAlarm之默认报警规则扩展.html.vue"]]);export{y as default};
