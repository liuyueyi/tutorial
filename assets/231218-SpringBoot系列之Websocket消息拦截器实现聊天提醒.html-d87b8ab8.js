import{_ as e,V as p,W as o,a1 as c,Y as n,Z as s,$ as t,X as i,F as l}from"./framework-eef79181.js";const u="/tutorial/imgs/231218/00.jpg",r="/tutorial/imgs/231218/01.gif",k={},d=n("p",null,"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä¸ºWebSocketçš„èŠå¤©åº”ç”¨æ·»åŠ äº†èº«ä»½éªŒè¯åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå½“æ—¶é—ç•™äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼šå½“ä¸€ä¸ªæ–°ç”¨æˆ·åŠ å…¥ç¾¤èŠæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å‘ç¾¤èŠå†…çš„å…¶ä»–æˆå‘˜å‘é€ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ï¼Œä»¥å‘ŠçŸ¥ä»–ä»¬æœ‰æ–°æœ‹å‹åŠ å…¥äº†ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å®ç°è¿™ä¸€éœ€æ±‚å‘¢ï¼Ÿ",-1),m=n("p",null,[s("æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨"),n("code",null,"ChannelInterceptor"),s("æ¥å®ç°åŠ å…¥/é€€å‡ºç¾¤èŠçš„é€šçŸ¥åŠŸèƒ½ã€‚")],-1),v=i(`<h2 id="i-å®ä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#i-å®ä¾‹æ¼”ç¤º" aria-hidden="true">#</a> I. å®ä¾‹æ¼”ç¤º</h2><h3 id="_1-é¡¹ç›®æ­å»º" tabindex="-1"><a class="header-anchor" href="#_1-é¡¹ç›®æ­å»º" aria-hidden="true">#</a> 1. é¡¹ç›®æ­å»º</h3><p>é¡¹ç›®æ­å»ºè¿‡ç¨‹ä¸å‰æ–‡ç±»ä¼¼ï¼Œè¯·ç›´æ¥å‚è€ƒä¸Šæ–‡ æˆ–è€… æŸ¥çœ‹æ–‡æœ«çš„é¡¹ç›®æºç </p><h3 id="_2-websocketé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-websocketé…ç½®" aria-hidden="true">#</a> 2. WebSocketé…ç½®</h3><p>åœ¨ä¹‹å‰ä»‹ç»çš„å‡ ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†é€šè¿‡å®ç°æ¥å£<code>WebSocketMessageBrokerConfigure</code>åœ¨ä¹‹å‰ä»‹ç»çš„å‡ ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†é€šè¿‡å®ç°æ¥å£<code>WebSocketMessageBrokerConfigurer</code> æ¥è¿›è¡Œ WebSocket çš„é…ç½®ã€‚</p><p>æœ¬æ–‡çš„é‡ç‚¹æ­£æ˜¯åœ¨è¿™ä¸ªé…ç½®ç±»ä¸­è¿›è¡Œå®ç°ï¼Œå› æ­¤æˆ‘ä»¬å°†å€Ÿæ­¤æœºä¼šå›é¡¾ä¸€ä¸‹ä¹‹å‰çš„å†…å®¹ã€‚</p><ul><li>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œå¹¶å®ç° <code>WebSocketMessageBrokerConfigurer</code> æ¥å£ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™å…¶ä¸­çš„æ–¹æ³•æ¥é…ç½® WebSocket çš„ç›¸å…³å‚æ•°å’Œæ¶ˆæ¯ä»£ç†ã€‚</li><li>åœ¨ <code>configureMessageBroker</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä½¿ç”¨çš„æ¶ˆæ¯ä»£ç†ï¼ˆä¾‹å¦‚ï¼šSimpleBrokerï¼‰ä»¥åŠå¯¹åº”çš„å‰ç¼€ï¼ˆç”¨äºè·¯ç”±æ¶ˆæ¯ï¼‰ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®è®¢é˜…è€…æ¨¡å¼ï¼ˆ<code>subscriptionChannel</code>ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆ<code>publisherChannel</code>ï¼‰ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ä½¿ç”¨ä¸åŒçš„é€šä¿¡æ–¹å¼ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œåœ¨ <code>registerStompEndpoints</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªç«¯ç‚¹ï¼ˆ<code>endpoint</code>ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªç«¯ç‚¹æŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼ˆ<code>path</code>ï¼‰ã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè·¯å¾„ä¸æœåŠ¡å™¨è¿›è¡Œ WebSocket é€šä¿¡äº†ã€‚</li><li>æœ€åï¼Œåœ¨ <code>addInterceptors</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›æ‹¦æˆªå™¨ï¼ˆ<code>interceptor</code>ï¼‰ï¼Œç”¨äºå¤„ç† WebSocket è¿æ¥ã€æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ç­‰è¿‡ç¨‹ä¸­çš„ä¸€äº›é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªèº«ä»½éªŒè¯æ‹¦æˆªå™¨ï¼Œç”¨äºéªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ä¿¡æ¯ã€‚</li></ul><p><code>WebSocketMessageBrokerConfigurer</code> æ¥å£å…è®¸æˆ‘ä»¬é…ç½® Stomp åè®®çš„å„ç§å±æ€§ï¼ŒåŒ…æ‹¬ç«¯ç‚¹ã€æ‹¦æˆªå™¨ã€æ¶ˆæ¯è½¬æ¢å™¨ç­‰ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSocketMessageBroker</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StompConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">WebSocketMessageBrokerConfigurer</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * è¿™é‡Œå®šä¹‰çš„æ˜¯å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯æ¶ˆæ¯çš„ç›¸å…³ä¿¡æ¯
     *
     * <span class="token keyword">@param</span> <span class="token parameter">registry</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureMessageBroker</span><span class="token punctuation">(</span><span class="token class-name">MessageBrokerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ¶ˆæ¯ä»£ç†æŒ‡å®šäº†å®¢æˆ·ç«¯è®¢é˜…åœ°å€ï¼Œå‰ç«¯è®¢é˜…çš„å°±æ˜¯è¿™ä¸ªè·¯å¾„, æ¥æ”¶åç«¯å‘é€çš„æ¶ˆæ¯</span>
        <span class="token comment">// å¯¹åº” index.jsä¸­çš„ stompClient.subscribe(&#39;/topic/hello&#39;</span>
        registry<span class="token punctuation">.</span><span class="token function">enableSimpleBroker</span><span class="token punctuation">(</span><span class="token string">&quot;/topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¡¨ç¤ºé…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªå‰ç¼€ï¼Œé€šè¿‡è¿™äº›å‰ç¼€è¿‡æ»¤å‡ºéœ€è¦è¢«æ³¨è§£æ–¹æ³•å¤„ç†çš„æ¶ˆæ¯ã€‚</span>
        <span class="token comment">// ä¾‹å¦‚ï¼Œå‰ç¼€ä¸º /app çš„ destination å¯ä»¥é€šè¿‡@MessageMappingæ³¨è§£çš„æ–¹æ³•å¤„ç†ï¼Œ</span>
        <span class="token comment">// è€Œå…¶ä»– destination ï¼ˆä¾‹å¦‚ /topic /queueï¼‰å°†è¢«ç›´æ¥äº¤ç»™ broker å¤„ç†</span>
        registry<span class="token punctuation">.</span><span class="token function">setApplicationDestinationPrefixes</span><span class="token punctuation">(</span><span class="token string">&quot;/app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ·»åŠ ä¸€ä¸ªæœåŠ¡ç«¯ç‚¹ï¼Œæ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥
     * å³å®¢æˆ·ç«¯åˆ›å»ºwsæ—¶ï¼ŒæŒ‡å®šçš„åœ°å€, let socket = new WebSocket(&quot;ws://ws/hello&quot;);
     *
     * <span class="token keyword">@param</span> <span class="token parameter">registry</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerStompEndpoints</span><span class="token punctuation">(</span><span class="token class-name">StompEndpointRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// EndpointæŒ‡å®šäº†å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶çš„è¯·æ±‚åœ°å€</span>
        registry<span class="token punctuation">.</span><span class="token function">addEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;/ws/chat/{channel}&quot;</span>
                <span class="token comment">// è®¾ç½®æ‹¦æˆªå™¨ï¼Œä»cookieä¸­è¯†åˆ«å‡ºç™»å½•ç”¨æˆ·</span>
                <span class="token punctuation">.</span><span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token function">authHandshakeInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSockJS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å®šä¹‰æ¥æ”¶å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„æ‹¦æˆªå™¨
     *
     * <span class="token keyword">@param</span> <span class="token parameter">registration</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureClientInboundChannel</span><span class="token punctuation">(</span><span class="token class-name">ChannelRegistration</span> registration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registration<span class="token punctuation">.</span><span class="token function">interceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SocketInChannelInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å®šä¹‰åç«¯è¿”å›æ¶ˆæ¯ç»™å®¢æˆ·ç«¯çš„æ‹¦æˆªå™¨
     *
     * <span class="token keyword">@param</span> <span class="token parameter">registration</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureClientOutboundChannel</span><span class="token punctuation">(</span><span class="token class-name">ChannelRegistration</span> registration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registration<span class="token punctuation">.</span><span class="token function">interceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SocketOutChannelInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>configureMessageBroker()æ–¹æ³•</strong></p><p>é…ç½®æ¶ˆæ¯ä»£ç†ä¸æ¶ˆæ¯è½¬å‘</p><ul><li><code>registry.enableSimpleBroker(&quot;/topic&quot;)</code>: å¯ç”¨ç®€å•çš„æ¶ˆæ¯ä»£ç†ï¼Œå³å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå‰ç«¯éœ€è¦è®¢é˜…çš„å°±æ˜¯è¿™ä¸ªè·¯å¾„ï¼Œå¦‚å¯¹åº” index.jsä¸­çš„ <code>stompClient.subscribe(&#39;/topic/hello&#39;, xx)</code></li><li><code>registry.setApplicationDestinationPrefixes(&quot;/app&quot;)</code>: è®¾ç½®äº†ç›®æ ‡è½¬å‘çš„å‰ç¼€ä¸º<code>/app</code>ï¼Œå®¢æˆ·ç«¯å‘é€ç»™<code>/app/xxx</code>çš„æ¶ˆæ¯ï¼Œä¼šè¢«è½¬å‘ç»™<code>@MessageMapping</code>æ³¨è§£ä¿®é¥°çš„æ–¹æ³•</li></ul><p>å¦‚æˆ‘ä»¬å®šä¹‰çš„æ¶ˆæ¯è½¬å‘å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatController</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * å½“æ¥å—åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶, å‘é€çš„è·¯å¾„æ˜¯ï¼š /app/hello/xxx (è¿™ä¸ª/appå‰ç¼€æ˜¯ StompConfiguration ä¸­çš„é…ç½®çš„)
     * å°†è¿”å›ç»“æœæ¨é€ç»™æ‰€æœ‰è®¢é˜…äº† /topic/chat/channel çš„æ¶ˆè´¹è€…
     *
     * <span class="token keyword">@param</span> <span class="token parameter">content</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@MessageMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello/{channel}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token annotation punctuation">@DestinationVariable</span><span class="token punctuation">(</span><span class="token string">&quot;channel&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> channel<span class="token punctuation">,</span> <span class="token class-name">SimpMessageHeaderAccessor</span> headerAccessor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;ã€%sã€‘å‘é€å†…å®¹ï¼š%s&quot;</span><span class="token punctuation">,</span> headerAccessor<span class="token punctuation">.</span><span class="token function">getSessionAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;uname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WsAnswerHelper</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;/topic/chat/&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>registerStompEndpoints()æ–¹æ³•</strong></p><p>æ³¨å†Œè¿æ¥ç«¯ç‚¹</p><ul><li><code>registry.addEndpoint(&quot;/ws/chat/{channel}&quot;)</code>: æ·»åŠ ç«¯ç‚¹ï¼Œå¯¹åº”çš„å°±æ˜¯å®¢æˆ·ç«¯å»ºç«‹è¿æ¥çš„url</li><li><code>.addInterceptors(authHandshakeInterceptor())</code>: ä¸Šæ–‡ä¸­ç”¨äºèº«ä»½è¯†åˆ«çš„æ‹¦æˆªå™¨</li></ul><p>æ­¤å¤–å¯¹äºè·¨åŸŸæ”¯æŒï¼Œä¹Ÿæ˜¯åœ¨è¿™é‡Œè¿›è¡Œè®¾ç½®ï¼Œå¦‚åœ¨ä¸Šé¢çš„é“¾å¼ä½¿ç”¨ä¸­ï¼Œæ·»åŠ  <code>.setAllowedOrigins(&quot;*&quot;)</code></p><p><strong>configureClientInboundChannel()æ–¹æ³•</strong></p><p>ç”¨äºè®¾ç½®æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯çš„ç›¸å…³é…ç½®å‚æ•°ï¼Œå¦‚çº¿ç¨‹è¿æ¥å‚æ•°ã€æ‹¦æˆªå™¨é…ç½®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureClientInboundChannel</span><span class="token punctuation">(</span><span class="token class-name">ChannelRegistration</span> registration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registration<span class="token punctuation">.</span><span class="token function">taskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">corePoolSize</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxPoolSize</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queueCapacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keepAliveSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    registration<span class="token punctuation">.</span><span class="token function">interceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SocketInChannelInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äºæ‹¦æˆªå™¨<code>SocketInChannelInterceptor</code>ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å®ç°ï¼Œå…¶å†…éƒ¨å®ç°äº†æˆ‘ä»¬å¯¹èŠå¤©é€šçŸ¥çš„æ ¸å¿ƒé€»è¾‘ï¼›å’±ä»¬ä¸‹ä¸€èŠ‚å†çœ‹å®ƒ</p><p>è¯·æ³¨æ„ä¸Šé¢é…ç½®çš„taskExecutor, ä¸Šé¢çš„å‡ ä¸ªé…ç½®å‚æ•°å’Œçº¿ç¨‹æ± çš„é…ç½®å‚æ•°åˆ«æ— äºŒè‡´ï¼Œä¸€èˆ¬å»ºè®®æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± æ¥è¿›è¡Œç®¡ç†ï¼›æ–¹ä¾¿ç›‘æ§</p><p><strong>configureClientOutboundChannel()æ–¹æ³•</strong></p><p>ä¸å‰é¢çš„ä½¿ç”¨å§¿åŠ¿ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«åˆ™åœ¨äºå®ƒä¸»è¦è®¾ç½®çš„æ˜¯æœåŠ¡ç«¯è¿”å›æ¶ˆæ¯ç»™å®¢æˆ·ç«¯çš„ç›¸å…³é…ç½®ï¼Œæˆ–è€…æ‹¦æˆª</p><h3 id="_3-ç®¡é“æ‹¦æˆª" tabindex="-1"><a class="header-anchor" href="#_3-ç®¡é“æ‹¦æˆª" aria-hidden="true">#</a> 3. ç®¡é“æ‹¦æˆª</h3><p>åœ¨å®Œæˆå‰é¢çš„é…ç½®åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿›å…¥ç®¡é“æ‹¦æˆªå™¨çš„é‡ç‚¹éƒ¨åˆ†ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨ç”¨æˆ·è¿›å…¥æˆ–ç¦»å¼€ç¾¤èŠæ—¶ï¼Œå‘ç¾¤èŠçš„å…¶ä»–æˆå‘˜æ¨é€ä¸€æ¡é€šçŸ¥ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œä¸€ä¸ªç›´è§‚çš„æ–¹æ¡ˆæ˜¯ç›‘æ§å®¢æˆ·ç«¯çš„è®¢é˜…å’Œå–æ¶ˆè®¢é˜…æ“ä½œï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒå®ç°å°†åŸºäºä¹‹å‰å®šä¹‰çš„<code>SocketInChannelInterceptor</code>ã€‚</p><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ç®¡é“æ‹¦æˆªå™¨çš„æ¥å£ç­¾å</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelInterceptor</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¶ˆæ¯å®é™…å‘é€åˆ°channelä¹‹å‰è°ƒç”¨</span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">default</span> <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">preSend</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">,</span> <span class="token class-name">MessageChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ¶ˆæ¯å‘é€åˆ°channelä¹‹åè°ƒç”¨</span>
    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">postSend</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">,</span> <span class="token class-name">MessageChannel</span> channel<span class="token punctuation">,</span> <span class="token keyword">boolean</span> sent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å‘é€å®Œæ¯•ä¹‹åè°ƒç”¨ï¼Œæ— è®ºæœ‰æ²¡æœ‰å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«å›è°ƒ</span>
    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">afterSendCompletion</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">,</span> <span class="token class-name">MessageChannel</span> channel<span class="token punctuation">,</span> <span class="token keyword">boolean</span> sent<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºæ¶ˆæ¯å¹¿æ’­é€šçŸ¥ï¼Œæˆ‘ä»¬æ”¾åœ¨<code>afterSendCompletion</code>æ¥å®ç°ï¼Œåˆ¤æ–­å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼Œå¯¹äºè®¢é˜…/å–æ¶ˆè®¢é˜…è¿›è¡Œå¤„ç†</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SocketInChannelInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">ChannelInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterSendCompletion</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">,</span> <span class="token class-name">MessageChannel</span> channel<span class="token punctuation">,</span> <span class="token keyword">boolean</span> sent<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;IN: afterSendCompletion: {}, sent: {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> sent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StompHeaderAccessor</span> headerAccessor <span class="token operator">=</span> <span class="token class-name">StompHeaderAccessor</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ¶ˆæ¯å¤´è®¿é—®å™¨</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAccessor<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">// é¿å…éstompæ¶ˆæ¯ç±»å‹ï¼Œä¾‹å¦‚å¿ƒè·³æ£€æµ‹</span>

        <span class="token comment">// è®¢é˜…æˆåŠŸï¼Œå›å¤ä¸€ä¸ªè®¢é˜…æˆåŠŸçš„æ¶ˆæ¯</span>
        <span class="token class-name">String</span> uname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> headerAccessor<span class="token punctuation">.</span><span class="token function">getSessionAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token string">&quot;uname&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAccessor<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">StompCommand</span><span class="token punctuation">.</span><span class="token constant">SUBSCRIBE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è®¢é˜…æˆåŠŸï¼Œå›å¤ä¸€ä¸ªè®¢é˜…æˆåŠŸçš„æ¶ˆæ¯</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;[IN-After] {} è®¢é˜…å®Œæˆ: {}&quot;</span><span class="token punctuation">,</span> uname<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">WsAnswerHelper</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> message<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;simpDestination&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;ğŸ””ã€ç³»ç»Ÿæ¶ˆæ¯ã€‘ï¼šæ¬¢è¿: ã€&quot;</span> <span class="token operator">+</span> uname <span class="token operator">+</span> <span class="token string">&quot;ã€‘ åŠ å…¥èŠå¤©!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAccessor<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">StompCommand</span><span class="token punctuation">.</span><span class="token constant">UNSUBSCRIBE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// fixme éœ€è¦æ³¨æ„ï¼Œä¸‹é¢è¿™ä¸ªè¦æ±‚å–æ¶ˆè®¢é˜…æ—¶ï¼Œå°†è®¢é˜…çš„ destination ä¹Ÿä¼ é€’è¿‡æ¥ï¼Œå¦åˆ™è¿™ä¸ªç¦»å¼€çš„æ¶ˆæ¯ä¸çŸ¥é“å‘é€ç»™è°</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;[IN-After] {} å–æ¶ˆè®¢é˜…: {}&quot;</span><span class="token punctuation">,</span> uname<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">WsAnswerHelper</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> message<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;simpSubscriptionId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;ğŸ””ã€ç³»ç»Ÿæ¶ˆæ¯ã€‘ï¼šã€&quot;</span> <span class="token operator">+</span> uname <span class="token operator">+</span> <span class="token string">&quot;ã€‘ ç¦»å¼€äº†èŠå¤©!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">ChannelInterceptor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">afterSendCompletion</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> channel<span class="token punctuation">,</span> sent<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„è®¢é˜…å®ç°ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªå…³é”®çŸ¥è¯†ç‚¹ï¼š</p><ol><li>å°è£…æ¶ˆæ¯å¤´è®¿é—®å™¨ï¼š <code>StompHeaderAccessor.wrap(message)</code>ï¼Œ ç®€åŒ–è¯·æ±‚ç›¸å…³ä¿¡æ¯çš„è·å–æ–¹å¼</li><li>åˆ¤æ–­äº¤äº’ç±»å‹ï¼š <code>headerAccessor.getCommand()</code></li><li>è·å–è¯·æ±‚å¤´ï¼š</li></ol><ul><li><code>headerAccessor.getHeader(&quot;simpDestination&quot;)</code></li><li><code>message.getHeaders().get(&quot;simpDestination&quot;)</code></li></ul><p>éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šç›´æ¥å¯ä»¥ä»è¯·æ±‚å¤´ä¸­æ‰¾åˆ°å®¢æˆ·ç«¯è®¢é˜…çš„æ˜¯å“ªä¸ªç¾¤ç»„(é€šè¿‡<code>destination</code>)ï¼Œä½†æ˜¯å¯¹äºå–æ¶ˆè®¢é˜…æ—¶ï¼Œåˆ™æ‹¿ä¸åˆ°è¿™ä¸ªä¿¡æ¯äº†ï¼Œå› æ­¤éœ€è¦å®¢æˆ·ç«¯å†å–æ¶ˆæ—¶ï¼Œå°†è¿™ä¸ªå…³é”®ä¿¡æ¯å›ä¼ ç»™æˆ‘ä»¬</p><h3 id="_4-å‰ç«¯è®¢é˜…-å–æ¶ˆè®¢é˜…" tabindex="-1"><a class="header-anchor" href="#_4-å‰ç«¯è®¢é˜…-å–æ¶ˆè®¢é˜…" aria-hidden="true">#</a> 4. å‰ç«¯è®¢é˜…/å–æ¶ˆè®¢é˜…</h3><p>å‰é¢è¯´åˆ°äº†éœ€è¦å†å–æ¶ˆè®¢é˜…çš„æ—¶å€™ï¼Œå‘Šè¯‰åç«¯é€€å‡ºçš„æ˜¯å“ªä¸ªç¾¤ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å®¢æˆ·ç«¯çš„ä½¿ç”¨ä¸Šï¼Œéœ€è¦åšä¸€äº›å°çš„é€‚é…è°ƒæ•´</p><p>å®Œæ•´çš„å‰ç«¯ä»£ç å¯ä»¥å‚è€ƒé¡¹ç›®æºç ä¸­çš„ <code>chat.html</code>ï¼Œ ä¸‹é¢æ˜¯å…³é”®çš„è®¢é˜…/å–æ¶ˆè®¢é˜…é€»è¾‘</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> subscribeMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * è®¢é˜…
 * <span class="token keyword">@param</span> <span class="token parameter">ref</span>
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 */</span>
<span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">ref<span class="token punctuation">,</span> id<span class="token punctuation">,</span> showMsgId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å‡†å¤‡è®¢é˜…: &quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token constant">SUBS_ID</span> <span class="token operator">=</span> <span class="token string">&quot;/topic/chat/&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>ref<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&#39;btn-success&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stompClient <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·å…ˆå»ºç«‹é“¾æ¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ‰§è¡Œè®¢é˜…</span>
        ref<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">&#39;è®¢é˜…æˆåŠŸ&#39;</span><span class="token punctuation">;</span>
        ref<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&#39;btn-success&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ref<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;btn-danger&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è®¢é˜…ï¼Œå¹¶ä¿å­˜è¿”å›çš„å¯¹è±¡ï¼Œç”¨æˆ·åç»­çš„å–æ¶ˆè®¢é˜…</span>
        subscribeMap<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">=</span> stompClient<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&#39;/topic/chat/&#39;</span> <span class="token operator">+</span> channel<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">greeting</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¡¨ç¤ºè¿™ä¸ªé•¿è¿æ¥ï¼Œè®¢é˜…äº† &quot;/topic/hello&quot; , è¿™æ ·åç«¯åƒè¿™ä¸ªè·¯å¾„è½¬å‘æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„è¿”å›</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;resp: &quot;</span><span class="token punctuation">,</span> greeting<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
                <span class="token function">showGreeting</span><span class="token punctuation">(</span>showMsgId<span class="token punctuation">,</span> greeting<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token constant">SUBS_ID</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// å–æ¶ˆè®¢é˜…</span>
        ref<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">&#39;å¼€å§‹è®¢é˜…&#39;</span><span class="token punctuation">;</span>
        ref<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;btn-success&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ref<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&#39;btn-danger&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸‹é¢è¿™ç§å–æ¶ˆè®¢é˜…æ–¹å¼ï¼Œå’Œifä¸­çš„å–æ¶ˆè®¢é˜…æ–¹å¼ç­‰ä»·</span>
        <span class="token comment">// stompClient.unsubscribe(SUBS_ID);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subscribeMap<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            subscribeMap<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            subscribeMap<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†ä¸Šé¢çš„å®ç°ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå¯¹è±¡<code>subscribeMap</code>æ¥å­˜å‚¨è®¢é˜…å…³ç³»ï¼Œå¹¶è®¾ç½®äº†è®¢é˜…çš„ID æ­£å¥½ç­‰äºè®¢é˜…çš„<code>channel</code>, è¿™æ ·åœ¨è®¢é˜…/å–æ¶ˆè®¢é˜…æ—¶ï¼Œéƒ½ä¼šæ–°å¢ä¸€ä¸ªidçš„è¯·æ±‚å¤´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ ·åç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªidæ¥åšç¦»å¼€ç¾¤èŠçš„å¹¿æ’­é€šçŸ¥</p><figure><img src="`+u+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_5-æ•ˆæœæ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_5-æ•ˆæœæ¼”ç¤º" aria-hidden="true">#</a> 5. æ•ˆæœæ¼”ç¤º</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®é™…æ¼”ç¤ºä¸€ä¸‹ï¼Œå¼€å§‹è®¢é˜…/å’Œç»“æŸè®¢é˜…æ—¶ï¼Œå…¶ä»–çš„å°ä¼™ä¼´æ˜¯å¦å¯ä»¥æ”¶åˆ°ç›¸å…³çš„æç¤ºæ¶ˆæ¯</p><figure><img src="'+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥æ¯”è¾ƒç›´è§‚çš„çœ‹åˆ°ï¼Œå½“ä¸€ä¸ªç”¨æˆ·åŠ å…¥ç¾¤èŠæ—¶ï¼Œå…¶ä»–ç”¨æˆ·/è‡ªå·±å‡å¯ä»¥æ­£å¸¸æ”¶åˆ°å¯¹åº”çš„ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯ï¼›ç¦»å¼€ç¾¤èŠæ—¶ï¼Œå› ä¸ºå–æ¶ˆäº†è®¢é˜…æ‰€ä»¥ä¹Ÿå°±åªæœ‰å…¶ä»–çš„å°ä¼™ä¼´èƒ½æ”¶åˆ°ç³»ç»Ÿæ¶ˆæ¯ï¼Œè€Œè‡ªå·±æ˜¯æ”¶ä¸åˆ°çš„</p><h3 id="_6-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_6-å°ç»“" aria-hidden="true">#</a> 6. å°ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ç®¡é“æ‹¦æˆªå™¨ï¼Œç”¨äºåœ¨æ¥æ”¶å’Œå‘é€å®¢æˆ·ç«¯æ¶ˆæ¯æ—¶è¿›è¡Œå®šåˆ¶å¼€å‘ï¼Œä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚åœºæ™¯ã€‚</p><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€è®¨è®ºçš„éƒ½æ˜¯ä¸ç¾¤èŠç›¸å…³çš„å†…å®¹ã€‚ç„¶è€Œï¼Œå¦‚æœåå°ç³»ç»Ÿå¸Œæœ›å‘ç”¨æˆ·æ¨é€ç§äººæ¶ˆæ¯ï¼Œä¾‹å¦‚æé†’ç”¨æˆ·åœ¨çº¿æ—¶é—´è¿‡é•¿éœ€è¦ä¼‘æ¯çš„æç¤ºæ¶ˆæ¯ï¼Œåº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><h2 id="iii-ä¸èƒ½é”™è¿‡çš„æºç å’Œç›¸å…³çŸ¥è¯†ç‚¹" tabindex="-1"><a class="header-anchor" href="#iii-ä¸èƒ½é”™è¿‡çš„æºç å’Œç›¸å…³çŸ¥è¯†ç‚¹" aria-hidden="true">#</a> III. ä¸èƒ½é”™è¿‡çš„æºç å’Œç›¸å…³çŸ¥è¯†ç‚¹</h2><h3 id="_0-é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_0-é¡¹ç›®" aria-hidden="true">#</a> 0. é¡¹ç›®</h3>',51),b={href:"https://github.com/liuyueyi/spring-boot-demo",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/liuyueyi/spring-boot-demo/tree/master/spring-case/207-websocket-chat",target:"_blank",rel:"noopener noreferrer"};function h(f,y){const a=l("ExternalLinkIcon");return p(),o("div",null,[d,m,c(" more "),v,n("ul",null,[n("li",null,[s("å·¥ç¨‹ï¼š"),n("a",b,[s("https://github.com/liuyueyi/spring-boot-demo"),t(a)])]),n("li",null,[s("æºç ï¼š"),n("a",g,[s("https://github.com/liuyueyi/spring-boot-demo/tree/master/spring-case/207-websocket-chat"),t(a)])])])])}const S=e(k,[["render",h],["__file","231218-SpringBootç³»åˆ—ä¹‹Websocketæ¶ˆæ¯æ‹¦æˆªå™¨å®ç°èŠå¤©æé†’.html.vue"]]);export{S as default};
