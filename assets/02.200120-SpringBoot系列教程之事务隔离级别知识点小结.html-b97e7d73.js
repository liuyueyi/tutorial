import{_ as e,V as p,W as o,a1 as c,Y as n,a0 as s,Z as t,X as l,F as i}from"./framework-ad59245f.js";const u="/tutorial/imgs/200120/00.jpg",r={},d=n("blockquote",null,[n("p",null,"ç»ˆäºæ¸¡è¿‡æ¼«é•¿çš„è‡ªæˆ‘éš”ç¦»æœŸï¼Œå¥åº·çš„æ´»ç€çœŸå¥½ï¼›ä¸ºæ­¦æ±‰ç¥ˆç¦ï¼Œå¸Œæœ›å¿«ç‚¹æ¸¡è¿‡ï¼Œèƒ½æ—©æ—¥å›å½’å¤§æ­¦æ±‰ ğŸ˜­ğŸ˜­ğŸ˜­")],-1),k=n("p",null,[s("ä¸Šä¸€ç¯‡åšæ–‡ä»‹ç»äº†å£°æ˜å¼äº‹åŠ¡"),n("code",null,"@Transactional"),s("çš„ç®€å•ä½¿ç”¨å§¿åŠ¿ï¼Œæœ€æ–‡ç« çš„æœ€åç»™å‡ºäº†è¿™ä¸ªæ³¨è§£çš„å¤šä¸ªå±æ€§ï¼Œæœ¬æ–‡å°†ç€é‡æ”¾åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«çš„çŸ¥è¯†ç‚¹ä¸Šï¼Œå¹¶é€šè¿‡å®ä¾‹æ¼”ç¤ºä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»çš„å…·ä½“åœºæ™¯")],-1),v=n("h2",{id:"i-åŸºç¡€çŸ¥è¯†",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#i-åŸºç¡€çŸ¥è¯†","aria-hidden":"true"},"#"),s(" I. åŸºç¡€çŸ¥è¯†")],-1),m=n("p",null,"åœ¨è¿›å…¥æ­£æ–‡ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ç‚¹ï¼Œè¯¦ç»†å†…å®¹ï¼Œæ¨èå‚è€ƒåšæ–‡",-1),b={href:"https://juejin.im/post/5ab5e44a6fb9a028c97a013d",target:"_blank",rel:"noopener noreferrer"},g=l('<h3 id="_1-åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> 1. åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p>ä»¥ä¸‹åŸºæœ¬æ¦‚å¿µæºäºä¸ªäººç†è§£ä¹‹åï¼Œé€šè¿‡ç®€å•çš„caseè¿›è¡Œæè¿°ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æ‹ç –</p></blockquote><p><strong>æ›´æ–°ä¸¢å¤±</strong></p><p>ç®€å•æ¥è®²ï¼Œä¸¤ä¸ªäº‹åŠ¡A,Båˆ†åˆ«æ›´æ–°ä¸€æ¡è®°å½•çš„filedA, filedBå­—æ®µï¼Œå…¶ä¸­äº‹åŠ¡Bå¼‚å¸¸ï¼Œå¯¼è‡´å›æ»šï¼Œå°†è¿™æ¡è®°å½•çš„æ¢å¤ä¸ºä¿®æ”¹ä¹‹å‰çš„çŠ¶æ€ï¼Œå¯¼è‡´äº‹åŠ¡Açš„ä¿®æ”¹ä¸¢å¤±äº†ï¼Œè¿™å°±æ˜¯æ›´æ–°ä¸¢å¤±</p><p><strong>è„è¯»</strong></p><p>è¯»å–åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„ä¿®æ”¹ï¼Œæ‰€ä»¥å½“å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ˜¯å¤±è´¥å¯¼è‡´å›æ»šçš„æ—¶å€™ï¼Œè¿™ä¸ªè¯»å–çš„æ•°æ®å…¶å®æ˜¯ä¸å‡†ç¡®çš„ï¼Œè¿™å°±æ˜¯è„è¯»</p><p><strong>ä¸å¯é‡å¤è¯»</strong></p><p>ç®€å•æ¥è®²ï¼Œå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡æŸ¥è¯¢åŒä¸€ä¸ªæ•°æ®ï¼Œè¿”å›çš„ç»“æœå±…ç„¶ä¸ä¸€æ ·ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤åº¦ï¼ˆé‡å¤è¯»å–çš„ç»“æœä¸ä¸€æ ·ï¼‰</p><p><strong>å¹»è¯»</strong></p><p>åŒæ ·æ˜¯å¤šæ¬¡æŸ¥è¯¢ï¼Œä½†æ˜¯åé¢æŸ¥è¯¢æ—¶ï¼Œå‘ç°å¤šäº†æˆ–è€…å°‘äº†ä¸€äº›è®°å½•</p><p>æ¯”å¦‚ï¼šæŸ¥è¯¢idåœ¨[1,10]ä¹‹é—´çš„è®°å½•ï¼Œç¬¬ä¸€æ¬¡è¿”å›äº†1,2,3ä¸‰æ¡è®°å½•ï¼›ä½†æ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ–°å¢äº†ä¸€ä¸ªidä¸º4çš„è®°å½•ï¼Œå¯¼è‡´å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œè¿”å›äº†1,2,3,4å››æ¡è®°å½•ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶å¤šäº†ä¸€æ¡è®°å½•ï¼Œè¿™å°±æ˜¯å¹»è¯»</p><p>å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p><ul><li>å¹»è¯»é’ˆå¯¹çš„æ˜¯æŸ¥è¯¢ç»“æœä¸ºå¤šä¸ªçš„åœºæ™¯ï¼Œå‡ºç°äº†æ•°æ®çš„å¢åŠ orå‡å°‘</li><li>ä¸å¯é‡å¤åº¦è¯»å¯¹çš„æ˜¯æŸäº›ç‰¹å®šçš„è®°å½•ï¼Œè¿™äº›è®°å½•çš„æ•°æ®ä¸ä¹‹å‰ä¸ä¸€è‡´</li></ul><h3 id="_2-éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#_2-éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> 2. éš”ç¦»çº§åˆ«</h3><p>åé¢æµ‹è¯•çš„æ•°æ®åº“ä¸ºmysqlï¼Œå¼•æ“ä¸ºinnodbï¼Œå¯¹åº”æœ‰å››ä¸ªéš”ç¦»çº§åˆ«</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è¯´æ˜</th><th>fix</th><th>not fix</th></tr></thead><tbody><tr><td>RU(read uncommitted)</td><td>æœªæˆæƒè¯»ï¼Œè¯»äº‹åŠ¡å…è®¸å…¶ä»–è¯»å†™äº‹åŠ¡ï¼›æœªæäº¤å†™äº‹åŠ¡ç¦æ­¢å…¶ä»–å†™äº‹åŠ¡ï¼ˆè¯»äº‹åŠ¡okï¼‰</td><td>æ›´æ–°ä¸¢å¤±</td><td>è„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»</td></tr><tr><td>RC(read committed)</td><td>æˆæƒè¯»ï¼Œè¯»äº‹åŠ¡å…è®¸å…¶ä»–è¯»å†™äº‹åŠ¡ï¼›æœªæäº¤å†™äº‹åŠ¡ï¼Œç¦æ­¢å…¶ä»–è¯»å†™äº‹åŠ¡</td><td>æ›´æ–°ä¸¢å¤±ï¼Œè„è¯»</td><td>ä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»</td></tr><tr><td>RR(repeatable read)</td><td>å¯é‡å¤åº¦ï¼Œè¯»äº‹åŠ¡ç¦æ­¢å…¶ä»–å†™äº‹åŠ¡ï¼›æœªæäº¤å†™äº‹åŠ¡ï¼Œç¦æ­¢å…¶ä»–è¯»å†™äº‹åŠ¡</td><td>æ›´æ–°ä¸¢å¤±ï¼Œè„è¯»ï¼Œä¸å¯é‡å¤åº¦</td><td><del>å¹»è¯»</del></td></tr><tr><td>serializable</td><td>åºåˆ—åŒ–è¯»ï¼Œæ‰€æœ‰äº‹åŠ¡ä¾æ¬¡æ‰§è¡Œ</td><td>æ›´æ–°ä¸¢å¤±ï¼Œè„è¯»ï¼Œä¸å¯é‡å¤åº¦ï¼Œå¹»è¯»</td><td>-</td></tr></tbody></table><p><strong>è¯´æ˜ï¼Œä¸‹é¢å­˜ä¸ºä¸ªäººè§‚ç‚¹ï¼Œä¸ä»£è¡¨æƒå¨ï¼Œè°¨æ…ç†è§£å’Œå¼•ç”¨</strong></p><ul><li>æˆ‘ä¸ªäººçš„è§‚ç‚¹ï¼Œrrçº§åˆ«åœ¨mysqlçš„innodbå¼•æ“ä¸Šï¼Œé…åˆmvvc + gapé”ï¼Œå·²ç»è§£å†³äº†å¹»è¯»é—®é¢˜</li><li>ä¸‹é¢è¿™ä¸ªcaseæ˜¯å¹»è¯»é—®é¢˜ä¹ˆï¼Ÿ <ul><li>ä»é”çš„è§’åº¦æ¥çœ‹ï¼Œæ­¥éª¤1ã€2è™½ç„¶å¼€å¯äº‹åŠ¡ï¼Œä½†æ˜¯å±äºå¿«ç…§è¯»ï¼›è€Œ9å±äºå½“å‰è¯»ï¼›ä»–ä»¬è¯»å–çš„æºä¸åŒï¼Œåº”è¯¥ä¸ç®—åœ¨å¹»è¯»å®šä¹‰ä¸­çš„åŒä¸€æŸ¥è¯¢æ¡ä»¶ä¸­</li></ul></li></ul><figure><img src="'+u+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="ii-é…ç½®" tabindex="-1"><a class="header-anchor" href="#ii-é…ç½®" aria-hidden="true">#</a> II. é…ç½®</h2><p>æ¥ä¸‹æ¥è¿›å…¥å®ä¾‹æ¼”ç¤ºç¯èŠ‚ï¼Œé¦–å…ˆéœ€è¦å‡†å¤‡ç¯å¢ƒï¼Œåˆ›å»ºæµ‹è¯•é¡¹ç›®</p><p>åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œç‰ˆæœ¬ä¸º<code>2.2.1.RELEASE</code>ï¼Œä½¿ç”¨mysqlä½œä¸ºç›®æ ‡æ•°æ®åº“ï¼Œå­˜å‚¨å¼•æ“é€‰æ‹©<code>Innodb</code>ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRR</p><h3 id="_1-é¡¹ç›®é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-é¡¹ç›®é…ç½®" aria-hidden="true">#</a> 1. é¡¹ç›®é…ç½®</h3><p>åœ¨é¡¹ç›®<code>pom.xml</code>æ–‡ä»¶ä¸­ï¼ŒåŠ ä¸Š<code>spring-boot-starter-jdbc</code>ï¼Œä¼šæ³¨å…¥ä¸€ä¸ª<code>DataSourceTransactionManager</code>çš„beanï¼Œæä¾›äº†äº‹åŠ¡æ”¯æŒ</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æ•°æ®åº“é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®åº“é…ç½®" aria-hidden="true">#</a> 2. æ•°æ®åº“é…ç½®</h3><p>è¿›å…¥springé…ç½®æ–‡ä»¶<code>application.properties</code>ï¼Œè®¾ç½®ä¸€ä¸‹dbç›¸å…³çš„ä¿¡æ¯</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">## DataSource</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://127.0.0.1:3306/story?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#_3-æ•°æ®åº“" aria-hidden="true">#</a> 3. æ•°æ®åº“</h3><p>æ–°å»ºä¸€ä¸ªç®€å•çš„è¡¨ç»“æ„ï¼Œç”¨äºæµ‹è¯•</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>money<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·å&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>money<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;é’±&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>is_deleted<span class="token punctuation">\`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>create_at<span class="token punctuation">\`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;åˆ›å»ºæ—¶é—´&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>update_at<span class="token punctuation">\`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æ›´æ–°æ—¶é—´&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="iii-å®ä¾‹æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#iii-å®ä¾‹æ¼”ç¤º" aria-hidden="true">#</a> III. å®ä¾‹æ¼”ç¤º</h2><h3 id="_1-åˆå§‹åŒ–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_1-åˆå§‹åŒ–æ•°æ®" aria-hidden="true">#</a> 1. åˆå§‹åŒ–æ•°æ®</h3><p>å‡†å¤‡ä¸€äº›ç”¨äºåç»­æ“ä½œçš„æ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DetailDemo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;replace into money (id, name, money) values (320, &#39;åˆå§‹åŒ–&#39;, 200),&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;(330, &#39;åˆå§‹åŒ–&#39;, 200),&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;(340, &#39;åˆå§‹åŒ–&#39;, 200),&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;(350, &#39;åˆå§‹åŒ–&#39;, 200)&quot;</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æä¾›ä¸€äº›åŸºæœ¬çš„æŸ¥è¯¢å’Œä¿®æ”¹æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">updateName</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update money set \`name\`=&#39;æ›´æ–°&#39; where id=&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> tag<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;select * from money where id=&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForMap</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tag <span class="token operator">+</span> <span class="token string">&quot; &gt;&gt;&gt;&gt; &quot;</span> <span class="token operator">+</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">updateMoney</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;update money set \`money\`= \`money\` + 10 where id=&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ruéš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#_2-ruéš”ç¦»çº§åˆ«" aria-hidden="true">#</a> 2. RUéš”ç¦»çº§åˆ«</h3><p>æˆ‘ä»¬å…ˆæ¥æµ‹è¯•RUéš”ç¦»çº§åˆ«ï¼Œé€šè¿‡æŒ‡å®š<code>@Transactional</code>æ³¨è§£çš„<code>isolation</code>å±æ€§æ¥è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p><p>é€šè¿‡å‰é¢çš„æè¿°ï¼Œæˆ‘ä»¬çŸ¥é“RUä¼šæœ‰è„è¯»é—®é¢˜ï¼Œæ¥ä¸‹æ¥è®¾è®¡ä¸€ä¸ªcaseï¼Œè¿›è¡Œæ¼”ç¤º</p><p>äº‹åŠ¡ä¸€ï¼Œä¿®æ”¹æ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ruéš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œå¯èƒ½å‡ºç°è„è¯»ï¼Œä¸å¯é¿å…ä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»
 *
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">READ_UNCOMMITTED</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">ruTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;ru: after updateMoney name&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMoney</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;ru: after updateMoney money&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åªè¯»äº‹åŠ¡äºŒ(è®¾ç½®readOnlyä¸ºtrueï¼Œåˆ™äº‹åŠ¡ä¸ºåªè¯»)å¤šæ¬¡è¯»å–ç›¸åŒçš„æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨äº‹åŠ¡äºŒçš„ç¬¬ä¸€æ¬¡è¯»å–ä¸­ï¼Œèƒ½è·å–åˆ°äº‹åŠ¡ä¸€çš„ä¸­é—´ä¿®æ”¹ç»“æœï¼ˆæ‰€ä»¥è¯·æ³¨æ„ä¸¤ä¸ªæ–¹æ³•ä¸­çš„sleepä½¿ç”¨ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">READ_UNCOMMITTED</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">readRuTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;ru read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;ru read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å±äºæµ‹è¯•çš„caseï¼Œç”¨ä¸¤ä¸ªçº¿ç¨‹æ¥è°ƒç”¨åªè¯»äº‹åŠ¡ï¼Œå’Œè¯»å†™äº‹åŠ¡</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DetailTransactionalSample</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DetailDemo</span> detailDemo<span class="token punctuation">;</span>

     <span class="token doc-comment comment">/**
     * ru éš”ç¦»çº§åˆ«
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRuIsolation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">330</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;ru: åªè¯»äº‹åŠ¡ - read&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">readRuTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;ru è¯»å†™äº‹åŠ¡&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">ruTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">String</span> tag<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">CallFunc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> func<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;============ &quot;</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">&quot; start ========== &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        func<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;============ &quot;</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">&quot; end ========== \\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CallFunc</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">R</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>============ ru è¯»å†™äº‹åŠ¡ start ========== 
============ ru: åªè¯»äº‹åŠ¡ - read start ========== 
ru read only &gt;&gt;&gt;&gt; {id=330, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 11:37:51.0, update_at=2020-01-20 11:37:51.0}
ru: after updateMoney name &gt;&gt;&gt;&gt; {id=330, name=æ›´æ–°, money=200, is_deleted=false, create_at=2020-01-20 11:37:51.0, update_at=2020-01-20 11:37:52.0}
ru read only &gt;&gt;&gt;&gt; {id=330, name=æ›´æ–°, money=200, is_deleted=false, create_at=2020-01-20 11:37:51.0, update_at=2020-01-20 11:37:52.0}
============ ru: åªè¯»äº‹åŠ¡ - read end ========== 

ru: after updateMoney money &gt;&gt;&gt;&gt; {id=330, name=æ›´æ–°, money=210, is_deleted=false, create_at=2020-01-20 11:37:51.0, update_at=2020-01-20 11:37:54.0}
============ ru è¯»å†™äº‹åŠ¡ end ==========
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³æ³¨ä¸€ä¸‹ä¸Šé¢ç»“æœä¸­<code>ru read only &gt;&gt;&gt;&gt;</code>å¼€å¤´çš„è®°å½•ï¼Œé¦–å…ˆä¸¤æ¬¡è¾“å‡ºç»“æœä¸ä¸€è‡´ï¼Œæ‰€ä»¥ä¸å¯é‡å¤è¯»é—®é¢˜æ˜¯å­˜åœ¨çš„</p><p>å…¶æ¬¡ï¼Œç¬¬äºŒæ¬¡è¯»å–çš„æ•°æ®ä¸è¯»å†™äº‹åŠ¡ä¸­çš„ä¸­é—´ç»“æœä¸€è‡´ï¼Œå³è¯»å–åˆ°äº†æœªæäº¤çš„ç»“æœï¼Œå³ä¸ºè„è¯»</p><h3 id="_3-rcäº‹åŠ¡éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#_3-rcäº‹åŠ¡éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> 3. RCäº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>rcéš”ç¦»çº§åˆ«ï¼Œå¯ä»¥è§£å†³è„è¯»ï¼Œä½†æ˜¯ä¸å¯é‡å¤è¯»é—®é¢˜æ— æ³•é¿å…ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªcaseï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦å¯ä»¥è¯»å–å¦å¤–ä¸€ä¸ªäº‹åŠ¡æäº¤åçš„ç»“æœ</p><p>åœ¨å‰é¢çš„æµ‹è¯•caseä¸Šï¼Œç¨å¾®æ”¹ä¸€æ”¹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ---------- rc äº‹ç‰©éš”ç¦»çº§åˆ«</span>
<span class="token comment">// æµ‹è¯•ä¸å¯é‡å¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€æ ·</span>


<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">READ_COMMITTED</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">readRcTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rc read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rc read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rc read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * rcéš”ç¦»çº§åˆ«äº‹åŠ¡ï¼Œæœªæäº¤çš„å†™äº‹åŠ¡ï¼Œä¼šæŒ‚èµ·å…¶ä»–çš„è¯»å†™äº‹åŠ¡ï¼›å¯é¿å…è„è¯»ï¼Œæ›´æ–°ä¸¢å¤±ï¼›ä½†ä¸èƒ½é˜²æ­¢ä¸å¯é‡å¤è¯»ã€å¹»è¯»
 *
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">READ_COMMITTED</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">rcTranaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rc: after updateMoney name&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMoney</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ç”¨ä¾‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * rc éš”ç¦»çº§åˆ«
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">testRcIsolation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">340</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;rc: åªè¯»äº‹åŠ¡ - read&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">readRcTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;rc è¯»å†™äº‹åŠ¡ - read&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">rcTranaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>============ rc: åªè¯»äº‹åŠ¡ - read start ========== 
rc read only &gt;&gt;&gt;&gt; {id=340, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:17.0}
============ rc è¯»å†™äº‹åŠ¡ - read start ========== 
rc: after updateMoney name &gt;&gt;&gt;&gt; {id=340, name=æ›´æ–°, money=200, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:23.0}
rc read only &gt;&gt;&gt;&gt; {id=340, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:17.0}
============ rc è¯»å†™äº‹åŠ¡ - read end ========== 

rc read only &gt;&gt;&gt;&gt; {id=340, name=æ›´æ–°, money=210, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:25.0}
============ rc: åªè¯»äº‹åŠ¡ - read end ========== 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢çš„è¾“å‡ºä¸­ï¼Œåœ¨åªè¯»äº‹åŠ¡ï¼Œå‰é¢ä¸¤æ¬¡æŸ¥è¯¢ï¼Œç»“æœä¸€è‡´ï¼Œè™½ç„¶ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ï¼Œè¯»å†™äº‹åŠ¡ä¿®æ”¹äº†è¿™ä¸ªè®°å½•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯»å–åˆ°è¿™ä¸ªä¸­é—´è®°å½•çŠ¶æ€ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰è„è¯»é—®é¢˜ï¼›</p><p>å½“è¯»å†™äº‹åŠ¡å®Œæ¯•ä¹‹åï¼Œåªè¯»äº‹åŠ¡çš„ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ä¸­ï¼Œè¿”å›çš„æ˜¯è¯»å†™äº‹åŠ¡æäº¤ä¹‹åçš„ç»“æœï¼Œå¯¼è‡´äº†ä¸å¯é‡å¤è¯»</p><h3 id="_4-rräº‹åŠ¡éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#_4-rräº‹åŠ¡éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> 4. RRäº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>é’ˆå¯¹rrï¼Œæˆ‘ä»¬ä¸»è¦æµ‹è¯•ä¸€ä¸‹ä¸å¯é‡å¤è¯»çš„è§£å†³æƒ…å†µï¼Œè®¾è®¡caseç›¸å¯¹ç®€å•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åªè¯»äº‹åŠ¡ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†éš”ç¦»å…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹ï¼Œå¯¹æœ¬æ¬¡æ“ä½œçš„å½±å“ï¼›
 *
 * æ¯”å¦‚åœ¨æŸäº›è€—æ—¶çš„æ¶‰åŠå¤šæ¬¡è¡¨çš„è¯»å–æ“ä½œä¸­ï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œè¿™ä¸ªå°±æœ‰ç”¨äº†ï¼› å¼€å¯åªè¯»äº‹åŠ¡ä¹‹åï¼Œä¸æ”¯æŒä¿®æ”¹æ•°æ®
 */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">REPEATABLE_READ</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">readRrTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rr read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rr read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * rréš”ç¦»çº§åˆ«äº‹åŠ¡ï¼Œè¯»äº‹åŠ¡ç¦æ­¢å…¶ä»–çš„å†™äº‹åŠ¡ï¼Œæœªæäº¤å†™äº‹åŠ¡ï¼Œä¼šæŒ‚èµ·å…¶ä»–è¯»å†™äº‹åŠ¡ï¼›å¯é¿å…è„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œï¼ˆæˆ‘ä¸ªäººè®¤ä¸ºï¼Œinnodbå¼•æ“å¯é€šè¿‡mvvc+gapé”é¿å…å¹»è¯»ï¼‰
 *
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">REPEATABLE_READ</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">rrTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;rr: after updateMoney name&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMoney</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¸Œæœ›è¯»å†™äº‹åŠ¡çš„æ‰§è¡Œå‘¨æœŸåœ¨åªè¯»äº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹å†…ï¼Œæ‰€æœ‰æµ‹è¯•ä»£ç å¦‚ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * rr
 * æµ‹è¯•åªè¯»äº‹åŠ¡
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">testReadOnlyCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// å­çº¿ç¨‹å¼€å¯åªè¯»äº‹åŠ¡ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œä¿®æ”¹</span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">320</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;rr åªè¯»äº‹åŠ¡ - read&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">readRrTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;rr è¯»å†™äº‹åŠ¡&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">rrTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>============ rr åªè¯»äº‹åŠ¡ - read start ========== 
rr read only &gt;&gt;&gt;&gt; {id=320, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:17.0}
============ rr è¯»å†™äº‹åŠ¡ start ========== 
rr: after updateMoney name &gt;&gt;&gt;&gt; {id=320, name=æ›´æ–°, money=200, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:28.0}
============ rr è¯»å†™äº‹åŠ¡ end ========== 

rr read only &gt;&gt;&gt;&gt; {id=320, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 11:46:17.0, update_at=2020-01-20 11:46:17.0}
============ rr åªè¯»äº‹åŠ¡ - read end ========== 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤æ¬¡åªè¯»äº‹åŠ¡çš„è¾“å‡ºä¸€è‡´ï¼Œå¹¶æ²¡æœ‰å‡ºç°ä¸Šé¢çš„ä¸å¯é‡å¤è¯»é—®é¢˜</p><p><strong>è¯´æ˜</strong></p><ul><li><code>@Transactional</code>æ³¨è§£çš„é»˜è®¤éš”ç¦»çº§åˆ«ä¸º<code>Isolation#DEFAULT</code>ï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨æ•°æ®æºçš„éš”ç¦»çº§åˆ«ï¼Œmysql innodbå¼•æ“é»˜è®¤éš”ç¦»çº§åˆ«ä¸ºRRï¼ˆæ‰€æœ‰ä¸é¢å¤–æŒ‡å®šæ—¶ï¼Œç›¸å½“äºRRï¼‰</li></ul><h3 id="_5-serializableäº‹åŠ¡éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#_5-serializableäº‹åŠ¡éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> 5. SERIALIZABLEäº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p>ä¸²è¡Œäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰çš„äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘æ²¡ç”¨è¿‡... ä¹Ÿä¸å¤ªèƒ½æƒ³åƒï¼Œä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦è¿™ç§</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">SERIALIZABLE</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">readSerializeTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;serialize read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;serialize read only&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * serializeï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œfixæ‰€æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½ä½
 *
 * <span class="token keyword">@param</span> <span class="token parameter">id</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">SERIALIZABLE</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">serializeTransaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateName</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;serialize: after updateMoney name&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMoney</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•case</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Serialize éš”ç¦»çº§åˆ«
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">testSerializeIsolation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">350</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Serialize: åªè¯»äº‹åŠ¡ - read&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">readSerializeTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Serialize è¯»å†™äº‹åŠ¡ - read&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> detailDemo<span class="token operator">::</span><span class="token function">serializeTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>============ Serialize: åªè¯»äº‹åŠ¡ - read start ========== 
serialize read only &gt;&gt;&gt;&gt; {id=350, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 12:10:23.0, update_at=2020-01-20 12:10:23.0}
============ Serialize è¯»å†™äº‹åŠ¡ - read start ========== 
serialize read only &gt;&gt;&gt;&gt; {id=350, name=åˆå§‹åŒ–, money=200, is_deleted=false, create_at=2020-01-20 12:10:23.0, update_at=2020-01-20 12:10:23.0}
============ Serialize: åªè¯»äº‹åŠ¡ - read end ========== 

serialize: after updateMoney name &gt;&gt;&gt;&gt; {id=350, name=æ›´æ–°, money=200, is_deleted=false, create_at=2020-01-20 12:10:23.0, update_at=2020-01-20 12:10:39.0}
============ Serialize è¯»å†™äº‹åŠ¡ - read end ========== 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åªè¯»äº‹åŠ¡çš„æŸ¥è¯¢è¾“å‡ºä¹‹åï¼Œæ‰è¾“å‡ºè¯»å†™äº‹åŠ¡çš„æ—¥å¿—ï¼Œç®€å•æ¥è®²å°±æ˜¯è¯»å†™äº‹åŠ¡ä¸­çš„æ“ä½œè¢«delayäº†</p><h3 id="_6-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_6-å°ç»“" aria-hidden="true">#</a> 6. å°ç»“</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†äº‹åŠ¡çš„å‡ ç§éš”ç¦»çº§åˆ«ï¼Œå·²ç»ä¸åŒå¹²çš„éš”ç¦»çº§åˆ«å¯¹åº”çš„åœºæ™¯ï¼Œå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼›</p><p><strong>éš”ç¦»çº§åˆ«è¯´æ˜</strong></p><table><thead><tr><th>çº§åˆ«</th><th>fix</th><th>not fix</th></tr></thead><tbody><tr><td>RU</td><td>æ›´æ–°ä¸¢å¤±</td><td>è„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»</td></tr><tr><td>RC</td><td>æ›´æ–°ä¸¢å¤± è„è¯»</td><td>ä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»</td></tr><tr><td>RR</td><td>æ›´æ–°ä¸¢ã€è„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»</td><td>-</td></tr><tr><td>serialze</td><td>æ›´æ–°ä¸¢å¤±ã€ è„è¯»ï¼Œä¸å¯é‡å¤è¯»ï¼Œå¹»è¯»</td><td>-</td></tr></tbody></table><p><strong>ä½¿ç”¨è¯´æ˜</strong></p><ul><li>mysql innodbå¼•æ“é»˜è®¤ä¸ºRRéš”ç¦»çº§åˆ«ï¼›<code>@Transactinoal</code>æ³¨è§£ä½¿ç”¨æ•°æ®åº“çš„éš”ç¦»çº§åˆ«ï¼Œå³RR</li><li>é€šè¿‡æŒ‡å®š<code>Transactional#isolation</code>æ¥è®¾ç½®äº‹åŠ¡çš„äº‹åŠ¡çº§åˆ«</li></ul><h2 id="iv-å…¶ä»–" tabindex="-1"><a class="header-anchor" href="#iv-å…¶ä»–" aria-hidden="true">#</a> IV. å…¶ä»–</h2><h3 id="_0-ç³»åˆ—åšæ–‡-æºç " tabindex="-1"><a class="header-anchor" href="#_0-ç³»åˆ—åšæ–‡-æºç " aria-hidden="true">#</a> 0. ç³»åˆ—åšæ–‡&amp;æºç </h3><p><strong>ç³»åˆ—åšæ–‡</strong></p>`,87),y={href:"http://spring.hhui.top/spring-blog/2018/09/26/180926-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87DB%E4%B9%8B%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/",target:"_blank",rel:"noopener noreferrer"},h={href:"http://spring.hhui.blog/spring-blog/2019/04/07/190407-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87JdbcTemplate%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF%E8%AF%A6%E8%A7%A3/",target:"_blank",rel:"noopener noreferrer"},w={href:"http://spring.hhui.top/spring-blog/2019/04/12/190412-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87JdbcTemplate%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E4%B8%8A%E7%AF%87/",target:"_blank",rel:"noopener noreferrer"},f={href:"http://spring.hhui.top/spring-blog/2019/04/17/190417-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87JdbcTemplate%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E4%B8%8B%E7%AF%87/",target:"_blank",rel:"noopener noreferrer"},_={href:"http://spring.hhui.top/spring-blog/2019/04/18/190418-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87JdbcTemplate%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%88%A0%E9%99%A4/",target:"_blank",rel:"noopener noreferrer"},E={href:"http://spring.hhui.top/spring-blog/2020/01/19/200119-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%E4%B9%8B%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1Transactional/",target:"_blank",rel:"noopener noreferrer"},T=n("p",null,[n("strong",null,"æºç ")],-1),q={href:"https://github.com/liuyueyi/spring-boot-demo",target:"_blank",rel:"noopener noreferrer"},A={href:"https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/101-jdbctemplate-transaction",target:"_blank",rel:"noopener noreferrer"};function x(B,R){const a=i("ExternalLinkIcon");return p(),o("div",null,[d,k,c(" more "),v,m,n("blockquote",null,[n("p",null,[n("a",b,[s("mysqlä¹‹é”ä¸äº‹åŠ¡"),t(a)])])]),g,n("ul",null,[n("li",null,[n("a",y,[s("180926-SpringBooté«˜çº§ç¯‡DBä¹‹åŸºæœ¬ä½¿ç”¨"),t(a)])]),n("li",null,[n("a",h,[s("190407-SpringBooté«˜çº§ç¯‡JdbcTemplateä¹‹æ•°æ®æ’å…¥ä½¿ç”¨å§¿åŠ¿è¯¦è§£"),t(a)])]),n("li",null,[n("a",w,[s("190412-SpringBooté«˜çº§ç¯‡JdbcTemplateä¹‹æ•°æ®æŸ¥è¯¢ä¸Šç¯‡"),t(a)])]),n("li",null,[n("a",f,[s("190417-SpringBooté«˜çº§ç¯‡JdbcTemplateä¹‹æ•°æ®æŸ¥è¯¢ä¸‹ç¯‡"),t(a)])]),n("li",null,[n("a",_,[s("190418-SpringBooté«˜çº§ç¯‡JdbcTemplateä¹‹æ•°æ®æ›´æ–°ä¸åˆ é™¤"),t(a)])]),n("li",null,[n("a",E,[s("200119-SpringBootç³»åˆ—æ•™ç¨‹ä¹‹å£°æ˜å¼äº‹åŠ¡Transactional"),t(a)])])]),T,n("ul",null,[n("li",null,[s("å·¥ç¨‹ï¼š"),n("a",q,[s("https://github.com/liuyueyi/spring-boot-demo"),t(a)])]),n("li",null,[s("å®ä¾‹æºç : "),n("a",A,[s("https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/101-jdbctemplate-transaction"),t(a)])])])])}const S=e(r,[["render",x],["__file","02.200120-SpringBootç³»åˆ—æ•™ç¨‹ä¹‹äº‹åŠ¡éš”ç¦»çº§åˆ«çŸ¥è¯†ç‚¹å°ç»“.html.vue"]]);export{S as default};
