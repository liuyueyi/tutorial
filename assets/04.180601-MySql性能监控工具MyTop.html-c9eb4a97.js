import{_ as l,V as i,W as t,Y as s,Z as n,$ as o,X as p,a1 as a,F as c}from"./framework-094145d2.js";const r={},u=s("h1",{id:"mysql-性能监控小工具之-mytop",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#mysql-性能监控小工具之-mytop","aria-hidden":"true"},"#"),n(" mysql 性能监控小工具之 mytop")],-1),d={href:"https://www.digitalocean.com/community/tutorials/how-to-use-mytop-to-monitor-mysql-performance",target:"_blank",rel:"noopener noreferrer"},m=a(`<h2 id="i-安装与配置" tabindex="-1"><a class="header-anchor" href="#i-安装与配置" aria-hidden="true">#</a> I. 安装与配置</h2><p>Centos 下可以直接通过yum进行安装</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> mytop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),b=a(`<p>使用姿势和top命令一样，直接用即可</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mytop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可能提示没有权限，如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># mytop                                                                                            !500</span>
Cannot connect to MySQL server. Please check the:

  * database you specified <span class="token string">&quot;test&quot;</span> <span class="token punctuation">(</span>default is <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  * username you specified <span class="token string">&quot;root&quot;</span> <span class="token punctuation">(</span>default is <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
  * password you specified <span class="token string">&quot;&quot;</span> <span class="token punctuation">(</span>default is <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  * <span class="token function">hostname</span> you specified <span class="token string">&quot;localhost&quot;</span> <span class="token punctuation">(</span>default is <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
  * port you specified <span class="token string">&quot;3306&quot;</span> <span class="token punctuation">(</span>default is <span class="token number">3306</span><span class="token punctuation">)</span>
  * socket you specified <span class="token string">&quot;&quot;</span> <span class="token punctuation">(</span>default is <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>

The options my be specified on the command-line or <span class="token keyword">in</span> a ~/.mytop
config file. See the manual <span class="token punctuation">(</span>perldoc mytop<span class="token punctuation">)</span> <span class="token keyword">for</span> details.

Here<span class="token string">&#39;s the exact error from DBI. It might help you debug:

Access denied for user &#39;</span>root<span class="token string">&#39;@&#39;</span>localhost&#39; <span class="token punctuation">(</span>using password: NO<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h3><p>通过上面的提示，可以添加配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> ~/.mytop

<span class="token comment">## 配置信息如</span>

<span class="token assign-left variable">host</span><span class="token operator">=</span>localhost
<span class="token assign-left variable">user</span><span class="token operator">=</span>root
<span class="token assign-left variable">pass</span><span class="token operator">=</span>mypwd
<span class="token assign-left variable">db</span><span class="token operator">=</span>dbName
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token comment"># 刷新时间，5s刷新下</span>
<span class="token assign-left variable">delay</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">batchmode</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">color</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">idle</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用姿势" tabindex="-1"><a class="header-anchor" href="#使用姿势" aria-hidden="true">#</a> 使用姿势</h3><p>直接将密码写到配置文件，可能并不是非常安全，可以如下操作</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mytop <span class="token parameter variable">--prompt</span>
<span class="token comment"># 然后再窗口内输入密码即可</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不想添加上面的配置，可以指定参数监控的db</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mytop <span class="token parameter variable">-d</span> dbName <span class="token parameter variable">--prompt</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ii-监控与参数说明" tabindex="-1"><a class="header-anchor" href="#ii-监控与参数说明" aria-hidden="true">#</a> II. 监控与参数说明</h2><p>执行上面的命令之后，窗口显示内容如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>MySQL on localhost <span class="token punctuation">(</span><span class="token number">5.7</span>.18<span class="token punctuation">)</span>                                                     up <span class="token number">345</span>+19:27:20 <span class="token punctuation">[</span><span class="token number">18</span>:55:58<span class="token punctuation">]</span>
 Queries: <span class="token number">778</span>.2k  qps:    <span class="token number">0</span> Slow:     <span class="token number">0.0</span>         Se/In/Up/De<span class="token punctuation">(</span>%<span class="token punctuation">)</span>:    <span class="token number">72</span>/00/02/00
             qps now:    <span class="token number">1</span> Slow qps: <span class="token number">0.0</span>  Threads:    <span class="token number">3</span> <span class="token punctuation">(</span>   <span class="token number">1</span>/   <span class="token number">6</span><span class="token punctuation">)</span> <span class="token number">50</span>/00/00/00
 Key Efficiency: <span class="token number">50.0</span>%  Bps in/out:   <span class="token number">3.3</span>/163.3   Now in/out:  <span class="token number">24.9</span>/ <span class="token number">2</span>.1k

      Id      User         Host/IP         DB      Time    Cmd Query or State
       --      ----         -------         --      ----    --- ----------
      <span class="token number">568</span>      root       localhost      story         <span class="token number">0</span>  Query show full processlist
      <span class="token number">567</span>      root       localhost      story         <span class="token number">5</span>  Sleep
      <span class="token number">541</span>      root localhost:44568       solo      <span class="token number">3529</span>  Sleep
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-参数说明" tabindex="-1"><a class="header-anchor" href="#_1-参数说明" aria-hidden="true">#</a> 1. 参数说明</h3><p><strong>第一行</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Queries: <span class="token number">778</span>.2k  qps:    <span class="token number">0</span> Slow:     <span class="token number">0.0</span>         Se/In/Up/De<span class="token punctuation">(</span>%<span class="token punctuation">)</span>:    <span class="token number">72</span>/00/02/00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>整体信息：</p><ul><li>Queries 服务器处理过的query总数</li><li>qps 每秒处理的query数量的平均值</li><li>Slow 慢查询总数</li><li>Se/In/Up/De(%) Select,Insert,Update,Delete 各自的占比</li></ul><p><strong>第二行</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>             qps now:    <span class="token number">1</span> Slow qps: <span class="token number">0.0</span>  Threads:    <span class="token number">3</span> <span class="token punctuation">(</span>   <span class="token number">1</span>/   <span class="token number">6</span><span class="token punctuation">)</span> <span class="token number">50</span>/00/00/00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当前的qps信息：</p><ul><li>qps now 本周期内的每秒处理query的数量</li><li>Slow qps 本周期内的每秒慢查询数量</li><li>Threads 当前连接线程数量，后面括号内的第一个数字是active状态的线程数量，第二个数字是在线程缓存中的数量</li><li>最后一列是本周期内的 Select,Insert,Update,Delete 各自的占比</li></ul><p><strong>第三行</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Key Efficiency: <span class="token number">50.0</span>%  Bps in/out:   <span class="token number">3.3</span>/163.3   Now in/out:  <span class="token number">24.9</span>/ <span class="token number">2</span>.1k
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Key Efficiency : 表示有多少key是从缓存中读取，而不是从磁盘读取的</li><li>Bps in/out : 表示mysql平均的流入流出数据量</li><li>Now in/out : 是本周期内的流入流出数据量</li></ul><p><strong>剩余</strong></p><p>后面的就是线程信息</p><h3 id="_2-常用命令" tabindex="-1"><a class="header-anchor" href="#_2-常用命令" aria-hidden="true">#</a> 2. 常用命令</h3><p>查看活动线程的详细信息，看下这个线程里面正在执行的sql是什么</p><ul><li>按F, 然后输入线程ID</li><li>然后 e 可以查看sql的情况</li></ul><p>查看命令执行的汇总情况</p><ul><li>按c</li><li>退出按 t</li></ul><p>需要更多地命令帮助</p><ul><li>按 ?</li></ul>`,36);function v(k,h){const e=c("ExternalLinkIcon");return i(),t("div",null,[u,s("p",null,[n("参考： "),s("a",d,[n("How To Use Mytop to Monitor MySQL Performance"),o(e)])]),m,p(" more "),b])}const f=l(r,[["render",v],["__file","04.180601-MySql性能监控工具MyTop.html.vue"]]);export{f as default};
