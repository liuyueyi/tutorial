import{_ as s,V as e,W as n,X as a,Y as i,a1 as d}from"./framework-094145d2.js";const c={},l=i("p",null,"centos添加ssh免密配置，结果发现登录时，依然要求设置密码，记录一下解决过程与最终的方案",-1),o=d(`<h2 id="i-ssh免密配置" tabindex="-1"><a class="header-anchor" href="#i-ssh免密配置" aria-hidden="true">#</a> I. ssh免密配置</h2><p>免密配置比较简单，自己的电脑上生成公私钥，然后将公钥丢上去即可</p><p>本机执行流程：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ssh-keygen
<span class="token comment"># 一路回车，在home目录的.ssh下会生成两个文件</span>
<span class="token builtin class-name">cd</span> ~/.ssh<span class="token punctuation">;</span> <span class="token function">ls</span>
<span class="token comment"># id_rsa      这个是生成的私钥</span>
<span class="token comment"># id_rsa.pub  这个是生成的公钥</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来我们需要将<code>id_rsa.pub</code>的内容，粘贴到服务器的 <code>authorized_keys</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> ~/.ssh/authorized_keys
<span class="token comment"># 将上面的公钥内容拷贝进来，保存，退出即可</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>正常来讲，上面的逻辑执行完毕之后，就可以免密登录了，但是突然遇到了登录还是要密码的情况</p><p><strong>原因定位</strong></p><p>查看ssh的登录日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /var/log/secure
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后发现日志显示</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>Dec 22 17:00:15 localhost sshd[21485]: Connection closed by xxx port xxx [preauth]
Dec 22 17:01:15 localhost sshd[21528]: Authentication refused: bad ownership or modes for directory /home/xxx/.ssh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面的日志中看出，问题应该就在.ssh目录的权限上，添加上权限即可</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,14);function t(r,p){return e(),n("div",null,[l,a(" more "),o])}const h=s(c,[["render",t],["__file","181222-Centos-SSH免密登录配置不生效问题fix.html.vue"]]);export{h as default};
