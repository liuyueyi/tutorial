import{_ as t,V as p,W as o,Y as n,Z as s,$ as e,X as c,a1 as l,F as i}from"./framework-094145d2.js";const u="/tutorial/imgs/201226/00.jpg",r="/tutorial/imgs/201226/01.jpg",d={},k=n("p",null,[s("åœ¨ä¹‹å‰æœ‰ä»‹ç»è¿‡å€ŸåŠ©æ³¨è§£"),n("code",null,"@PropertySource"),s("æ¥å¼•å…¥è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨å½“æ—¶é‡åˆ°æŠ›å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œé€šè¿‡è¿™ä¸ªæ³¨è§£å¯ä»¥æ­£ç¡®è·å–åˆ°"),n("code",null,".properties"),s("æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ï¼Œä½†æ˜¯"),n("code",null,"yaml"),s("æ–‡ä»¶å´è¯»å–ä¸åˆ°ï¼Œæœ€è¿‘åˆç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ­£å¥½æŠŠä¹‹å‰æŒ–çš„å‘å¡«ä¸Šï¼›æœ¬æ–‡å°†ä¸»è¦å®šä½ä¸€ä¸‹ï¼Œä¸ºå•¥ymlæ–‡ä»¶è¯»å–ä¸äº†ï¼Œåˆå¯ä»¥å¦‚ä½•å¤„ç†")],-1),v={href:"https://spring.hhui.top/spring-blog/2018/09/21/180921-SpringBoot%E5%9F%BA%E7%A1%80%E7%AF%87%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%8C%87%E5%AE%9A%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%86%85%E5%BC%95%E7%94%A8/",target:"_blank",rel:"noopener noreferrer"},m=l(`<h2 id="i-é¡¹ç›®ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#i-é¡¹ç›®ç¯å¢ƒ" aria-hidden="true">#</a> I. é¡¹ç›®ç¯å¢ƒ</h2><h3 id="_1-åŸºæœ¬é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-åŸºæœ¬é…ç½®" aria-hidden="true">#</a> 1. åŸºæœ¬é…ç½®</h3><p>æœ¬æ–‡åç»­çš„æºç å®šä½ä»¥åŠå®ä¾‹æ¼”ç¤ºéƒ½æ˜¯åŸºäº<code>SpringBoot 2.2.1.RELEASE</code>è¿›è¡Œï¼Œå¦‚éœ€å¤ç°æœ¬æ–‡ä¸­çš„caseï¼Œè¯·ç¡®ä¿ç¯å¢ƒä¸€è‡´</p><ul><li>IDEA</li><li>MAVEN</li><li>SpringBoot 2.2.1.RELEASE</li><li>JDK1.8</li></ul><h3 id="_2-å®ä¾‹é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_2-å®ä¾‹é¡¹ç›®" aria-hidden="true">#</a> 2. å®ä¾‹é¡¹ç›®</h3><p>åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œç”¨äºåç»­çš„æ¼”ç¤ºï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶<code>biz.properties</code></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">biz.token</span><span class="token punctuation">=</span><span class="token value attr-value">mytoken</span>
<span class="token key attr-name">biz.appKey</span><span class="token punctuation">=</span><span class="token value attr-value">asdf</span>
<span class="token key attr-name">biz.appVersion</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">biz.source</span><span class="token punctuation">=</span><span class="token value attr-value">xxx.yyy</span>

<span class="token key attr-name">biz.uuid</span><span class="token punctuation">=</span><span class="token value attr-value">\${biz.token}#\${biz.appKey}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å®šä¹‰å¯¹åº”çš„é…ç½®ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;classpath:biz.properties&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;biz&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OtherProperBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> token<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appKey<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> appVersion<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> source<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uuid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åè¡¥ä¸ŠSpringBooté¡¹ç›®ä¸å¯è·å–çš„å¯åŠ¨ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Created by @author yihui in 14:08 18/9/19.
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ii-propertysourceåŸç†åˆ†æ" tabindex="-1"><a class="header-anchor" href="#ii-propertysourceåŸç†åˆ†æ" aria-hidden="true">#</a> II. PropertySourceåŸç†åˆ†æ</h2><p>æƒ³è¦å®šä½ä¸ºå•¥<code>@PropertySource</code>æ³¨è§£åªä¼šè·å–åˆ°<code>properties</code>æ–‡ä»¶çš„é…ç½®ï¼Œè€Œä¸èƒ½è·å–<code>yaml</code>æ–‡ä»¶é…ç½®ä¿¡æ¯ï¼Œæœ€ç›´æ¥çš„åŠæ³•å½“ç„¶æ˜¯ç›´æ¥æ’¸æºç ï¼ˆå®é™…ä¸Šæœ€ç®€å•çš„åŠæ³•ç›´æ¥å€ŸåŠ©æœç´¢å¼•æ“ï¼Œçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å“ªä½å¤§ä½¬æœ‰è¿‡ç›¸å…³åˆ†äº«ï¼Œå¦‚æœä¸æ˜¯ä¸ºäº†å†™æœ¬æ–‡ï¼Œæˆ‘å¯æ˜¯å®Œå…¨æ²¡æƒ³å¼€æ’¸ï¼Œæ¯•ç«Ÿä»æå‡ºè¿™ä¸ªé—®é¢˜åˆ°ç°åœ¨å›å¤ï¼Œä¹Ÿè¿‡äº†ä¸¤å¹´å¤šäº†ğŸ˜­...ï¼‰</p><h3 id="_1-æºç å®šä½" tabindex="-1"><a class="header-anchor" href="#_1-æºç å®šä½" aria-hidden="true">#</a> 1. æºç å®šä½</h3><p>é‚£ä¹ˆè¿™ä¸ªæºç å¯ä»¥æ€ä¹ˆå®šä½åˆ†æå‘¢ï¼Œå…ˆç›´æ¥è¿›å…¥è¿™ä¸ªæ³¨è§£ç…ä¸€ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">PropertySource</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... çœç•¥æ— å…³çš„å±æ€§</span>

	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">PropertySourceFactory</span><span class="token punctuation">&gt;</span></span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">PropertySourceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ä¸Šé¢çš„ç‰¹æ„ç•™å‡ºæ¥çš„<code>PropertySourceFactory</code>, ä»å‘½åä¸Šæ¥çœ‹ï¼Œå¤§è‡´å°±èƒ½æ„Ÿè§‰è¿™ä¸ªå·¥å‚ç±»ä¸å±æ€§æœ‰å…³äº†ï¼Œä¸»è¦å°±æ˜¯ä¸ºäº†åˆ›å»º<code>PropertySource</code>å¯¹è±¡</p><p>å®ƒå°±æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œå¦‚æœæ²¡æœ‰çŒœé”™çš„è¯ï¼Œé…ç½®æ–‡ä»¶åŠ è½½åˆ°Springå®¹å™¨ä¹‹åï¼Œå¤šåŠå°±ä¼šä¸<code>PropertySource</code>å…³è”èµ·æ¥äº†ï¼ˆæ‰€ä»¥è¯´å¥½çš„å‘½åå¯ä»¥çœå¾ˆå¤šæ³¨é‡Šè¯´æ˜ï¼‰</p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå·¥å‚ç±»çš„é»˜è®¤å®ç°<code>DefaultPropertySourceFactory</code>ï¼Œæºç å¾ˆç®€å•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultPropertySourceFactory</span> <span class="token keyword">implements</span> <span class="token class-name">PropertySourceFactory</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">createPropertySource</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">EncodedResource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">ResourcePropertySource</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> resource<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ResourcePropertySource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œæˆ‘ä»¬æ‰“ä¸ªæ–­ç‚¹ï¼Œç¡®è®¤ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆç¥å™¨çš„äº‹æƒ…</p><figure><img src="`+u+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä»ä¸Šé¢çš„æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª<code>EncodedResource</code>åŒ…å«äº†æˆ‘ä»¬æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œç›´æ¥å•æ­¥è¿›å»ï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„æ—¶å€™ä¸‹é¢è¿™ä¸ª</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// org.springframework.core.io.support.ResourcePropertySource#ResourcePropertySource(org.springframework.core.io.support.EncodedResource)</span>
<span class="token keyword">public</span> <span class="token class-name">ResourcePropertySource</span><span class="token punctuation">(</span><span class="token class-name">EncodedResource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token function">getNameForResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PropertiesLoaderUtils</span><span class="token punctuation">.</span><span class="token function">loadProperties</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>resourceName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œæ ¸å¿ƒä»£ç ä¸æ˜¯<code>super()</code>è¿™ä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œæ˜¯ä¼ å‚çš„<code>PropertiesLoaderUtils.loadProperties(resource)</code></p><p>ä¸Šé¢è¿™ä¸€è¡Œè°ƒç”¨ï¼Œå°±æ˜¯å®ç°å…·ä½“çš„ä»é…ç½®æ–‡ä»¶ä¸­è·å–é…ç½®ä¿¡æ¯</p><p>ä¸‹é¢æ˜¯å…·ä½“çš„å®ç°ï¼ˆæ‘˜æŠ„æœ‰ç”¨çš„éƒ¨åˆ†é€»è¾‘ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// org.springframework.core.io.support.PropertiesLoaderUtils</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Properties</span> <span class="token function">loadProperties</span><span class="token punctuation">(</span><span class="token class-name">EncodedResource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
	<span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">fillProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> props<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fillProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> props<span class="token punctuation">,</span> <span class="token class-name">EncodedResource</span> resource<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token comment">// å±æ€§å¡«å……ï¼Œæ³¨æ„DefaultPropertiesPersister</span>
	<span class="token function">fillProperties</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> resource<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPropertiesPersister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fillProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> props<span class="token punctuation">,</span> <span class="token class-name">EncodedResource</span> resource<span class="token punctuation">,</span> <span class="token class-name">PropertiesPersister</span> persister<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> filename <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>filename <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> filename<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token constant">XML_FILE_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			stream <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// è¿™ä¸ªæ˜¯å…³é”®</span>
			persister<span class="token punctuation">.</span><span class="token function">loadFromXml</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">requiresReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			reader <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// å…³é”®è°ƒç”¨</span>
			persister<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			stream <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// å…³é”®è°ƒç”¨</span>
			persister<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®ä¿¡æ¯çš„è¯»å–ï¼Œæœ€ç»ˆä¾é çš„å°±æ˜¯<code>org.springframework.util.DefaultPropertiesPersister#load()</code>ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬åŸºæœ¬ä¸Šå°±æ‰¾åˆ°äº†ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®çš„â€œå¹•åé»‘æ‰‹â€ï¼Œç›´æ¥çœ‹ä¸€ä¸‹å®ƒçš„å®ç°é€»è¾‘å°±èƒ½çŸ¥é“ä¸ºå•¥ä¸æ”¯æŒyamläº†</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultPropertiesPersister</span> <span class="token keyword">implements</span> <span class="token class-name">PropertiesPersister</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> props<span class="token punctuation">,</span> <span class="token class-name">InputStream</span> is<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		props<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> props<span class="token punctuation">,</span> <span class="token class-name">Reader</span> reader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		props<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›´æ¥è¿›å…¥çœ‹åˆ°æºç ï¼Œéå¸¸ç®€å•ç›´è§‚çš„å®ç°æ–¹å¼äº†ï¼Œç›´æ¥ä½¿ç”¨jdkçš„<code>java.util.Properties#load(java.io.InputStream)</code>æ¥è¯»å–é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥çœŸç›¸å·²ç»å¤§ç™½äº†ï¼ˆåŸæ¥éƒ½æ˜¯jdkçš„é”…ğŸ˜‚ï¼‰</p><h3 id="_2-yamlæ–‡ä»¶æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#_2-yamlæ–‡ä»¶æ”¯æŒ" aria-hidden="true">#</a> 2. yamlæ–‡ä»¶æ”¯æŒ</h3><p>ç»è¿‡ä¸Šé¢çš„ä¸€ç•ªæ“ä½œï¼Œæˆ‘ä»¬çŸ¥é“<code>@ConfigurationProperties</code>åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯å€ŸåŠ©jdkçš„<code>Properties#load</code>æ–¹æ³•æ¥è¯»å–é…ç½®æ–‡ä»¶åˆ°å®¹å™¨å†…ï¼Œé‚£ä¹ˆè‹¥æˆ‘ä»¬å¸Œæœ›åŠ è½½yamlé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ€ä¹ˆæå‘¢ï¼Ÿ</p><p>å› ä¸ºSpringBootæ˜¯æ”¯æŒyamlé…ç½®æ–‡ä»¶çš„è¯»å–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥æ‰©å±•ä¸€ä¸‹ï¼Œå€ŸåŠ©SpringBootçš„å·¥å…·ç±»æ¥å®ç°é…ç½®æ–‡ä»¶åŠ è½½ï¼Œæ‰€ä»¥å¯ä»¥å®ç°è‡ªå®šä¹‰çš„<code>PropertySourceFactory</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YamlSourceFactory</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultPropertySourceFactory</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">createPropertySource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">EncodedResource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createPropertySource</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è¿™é‡Œä½¿ç”¨Yamlé…ç½®åŠ è½½ç±»æ¥è¯»å–ymlæ–‡ä»¶ä¿¡æ¯</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertySource</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YamlPropertySourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> resource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sources<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå†æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çš„åœ°æ–¹ï¼Œåˆ©ç”¨è‡ªå®šä¹‰çš„å·¥å‚ç±»æ›¿æ¢é»˜è®¤çš„å³å¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:biz2.yml&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> factory <span class="token operator">=</span> <span class="token class-name">YamlSourceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;biz2.yml&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YmlProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> type<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> ary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹åº”çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">biz2</span><span class="token punctuation">:</span>
  <span class="token key atrule">yml</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> biz.yml.name
    <span class="token key atrule">ary</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">a</span><span class="token punctuation">:</span> hello
      <span class="token punctuation">-</span> <span class="token key atrule">b</span><span class="token punctuation">:</span> world
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åå®ä¾‹éªŒè¯ä¸€ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token class-name">YmlProperties</span> ymlProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ymlProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_3-å°ç»“" aria-hidden="true">#</a> 3. å°ç»“</h3><p>å½“æˆ‘ä»¬å¸Œæœ›åŠ è½½è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œ<code>@PropertySource</code>æ³¨è§£æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥å€ŸåŠ©å¤šç¯å¢ƒé…ç½®æ–¹æ¡ˆï¼ŒæŒ‡å®š<code>spring.profiles.active</code>çš„å€¼ï¼Œå®ç°åŠ è½½å‰ç¼€ä¸º<code>application-</code>çš„é…ç½®æ–‡ä»¶ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰çš„åšæ–‡ï¼‰</p><p>è¯·æ³¨æ„<code>@PropertySource</code>å¼•å…¥çš„é…ç½®æ–‡ä»¶ä¸æ”¯æŒ<code>yaml</code>æ–‡ä»¶ï¼Œå¦‚éœ€æ”¯æŒï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡ä¸­çš„å®ç°æ–¹å¼ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªyamlæ–‡ä»¶çš„<code>PropertySourceFactory</code></p><p>æœ€åæä¸€å¥ï¼Œé‡åˆ°é—®é¢˜åƒä¸‡ä¸è¦æ”¾è¿‡ï¼Œå°½é‡è¿…é€Ÿè§£å†³ï¼Œä¸è¦ç•™å¾…ä»¥åï¼Œä¸ç„¶æ‹–å»¶ç—‡å‘ä½œçš„è¯ï¼Œè¿™ä¸ªæ—¶é—´å¯èƒ½å°±ä¸€ç›´æ‚¬ç€äº†...</p><h2 id="iii-å…¶ä»–" tabindex="-1"><a class="header-anchor" href="#iii-å…¶ä»–" aria-hidden="true">#</a> III. å…¶ä»–</h2><h3 id="_0-é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_0-é¡¹ç›®" aria-hidden="true">#</a> 0. é¡¹ç›®</h3><p><strong>é¡¹ç›®æºç </strong></p>',49),b={href:"https://github.com/liuyueyi/spring-boot-demo",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/liuyueyi/spring-boot-demo/tree/master/spring-boot/000-properties",target:"_blank",rel:"noopener noreferrer"},y=n("p",null,[n("strong",null,"ç³»åˆ—åšæ–‡")],-1),E={href:"https://spring.hhui.top/spring-blog/2020/05/07/200507-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%99%A8/",target:"_blank",rel:"noopener noreferrer"},h={href:"https://spring.hhui.top/spring-blog/2018/09/25/180925-SpringBoot%E5%9F%BA%E7%A1%80%E7%AF%87%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B9%8B%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE/",target:"_blank",rel:"noopener noreferrer"},f={href:"https://spring.hhui.top/spring-blog/2018/09/22/180922-SpringBoot%E5%9F%BA%E7%A1%80%E7%AF%87%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B9%8B%E9%85%8D%E7%BD%AE%E5%88%B7%E6%96%B0/",target:"_blank",rel:"noopener noreferrer"},w={href:"https://spring.hhui.top/spring-blog/2018/09/21/180921-SpringBoot%E5%9F%BA%E7%A1%80%E7%AF%87%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%8C%87%E5%AE%9A%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%86%85%E5%BC%95%E7%94%A8/",target:"_blank",rel:"noopener noreferrer"},A={href:"https://spring.hhui.top/spring-blog/2018/09/20/180920-SpringBoot%E5%9F%BA%E7%A1%80%E7%AF%87%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B9%8B%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF/",target:"_blank",rel:"noopener noreferrer"},B={href:"https://spring.hhui.top/spring-blog/2018/09/19/180919-SpringBoot%E5%9F%BA%E7%A1%80%E7%AF%87%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E4%B9%8B%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF/",target:"_blank",rel:"noopener noreferrer"};function S(_,P){const a=i("ExternalLinkIcon");return p(),o("div",null,[k,n("p",null,[s("å¦‚å¯¹ä¹‹å‰åšæ–‡æœ‰å…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æŸ¥çœ‹: "),n("a",v,[s("180921-SpringBootåŸºç¡€ç¯‡é…ç½®ä¿¡æ¯ä¹‹è‡ªå®šä¹‰é…ç½®æŒ‡å®šä¸é…ç½®å†…å¼•ç”¨"),e(a)])]),c(" more "),m,n("ul",null,[n("li",null,[s("å·¥ç¨‹: "),n("a",b,[s("https://github.com/liuyueyi/spring-boot-demo"),e(a)])]),n("li",null,[s("æºç : "),n("a",g,[s("https://github.com/liuyueyi/spring-boot-demo/tree/master/spring-boot/000-properties"),e(a)])])]),y,n("ul",null,[n("li",null,[n("a",E,[s("ã€åŸºç¡€ç³»åˆ—ã€‘å®ç°ä¸€ä¸ªè‡ªå®šä¹‰é…ç½®åŠ è½½å™¨ï¼ˆåº”ç”¨ç¯‡ï¼‰"),e(a)])]),n("li",null,[n("a",h,[s("ã€åŸºç¡€ç³»åˆ—ã€‘SpringBooté…ç½®ä¿¡æ¯ä¹‹é»˜è®¤é…ç½®"),e(a)])]),n("li",null,[n("a",f,[s("ã€åŸºç¡€ç³»åˆ—ã€‘SpringBooté…ç½®ä¿¡æ¯ä¹‹é…ç½®åˆ·æ–°"),e(a)])]),n("li",null,[n("a",w,[s("ã€åŸºç¡€ç³»åˆ—ã€‘SpringBootåŸºç¡€ç¯‡é…ç½®ä¿¡æ¯ä¹‹è‡ªå®šä¹‰é…ç½®æŒ‡å®šä¸é…ç½®å†…å¼•ç”¨"),e(a)])]),n("li",null,[n("a",A,[s("ã€åŸºç¡€ç³»åˆ—ã€‘SpringBootåŸºç¡€ç¯‡é…ç½®ä¿¡æ¯ä¹‹å¤šç¯å¢ƒé…ç½®ä¿¡æ¯"),e(a)])]),n("li",null,[n("a",B,[s("ã€åŸºç¡€ç³»åˆ—ã€‘SpringBootåŸºç¡€ç¯‡é…ç½®ä¿¡æ¯ä¹‹å¦‚ä½•è¯»å–é…ç½®ä¿¡æ¯"),e(a)])])])])}const x=t(d,[["render",S],["__file","07.201226-SpringBootç³»åˆ—PropertySourceåŠ è½½Yamlé…ç½®æ–‡ä»¶å®ä¾‹æ¼”ç¤º.html.vue"]]);export{x as default};
