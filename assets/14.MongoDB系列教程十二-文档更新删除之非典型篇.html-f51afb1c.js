import{_ as p,V as e,W as c,X as l,Y as n,Z as s,$ as o,a1 as a,F as i}from"./framework-094145d2.js";const u="/tutorial/imgs/200410/00.jpg",d="/tutorial/imgs/200410/01.jpg",k="/tutorial/imgs/200410/02.jpg",r="/tutorial/imgs/200410/03.jpg",m="/tutorial/imgs/200410/04.jpg",b="/tutorial/imgs/200410/05.jpg",g="/tutorial/imgs/200410/06.jpg",v="/tutorial/imgs/200410/07.jpg",h="/tutorial/imgs/200410/08.jpg",_={},f=n("p",null,"前面介绍document的新增、删除、更新都处于相对常见和基础的说明，但是考虑到mongodb非结构化的特点，它的一些特性是我们的mysql不会遇到的，本文将针对这些特殊场景给出示例说明",-1),$=n("ul",null,[n("li",null,"在现有文档中，增加一个field"),n("li",null,"删除文档中的某个field"),n("li",null,"重命名文档的field"),n("li",null,"在文档的数组orObject中，添加/删除/更新数据")],-1),x=a(`<h3 id="_1-增加field" tabindex="-1"><a class="header-anchor" href="#_1-增加field" aria-hidden="true">#</a> 1. 增加field</h3><p>我们知道修改文档的命令格式如下</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   }
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当我们更新一个文档中，不存在的field，会怎样</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 插入一条数据，然后设置一个不存在的field</span>
db.doc_demo.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token string">&quot;author&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;一灰灰blog&quot;</span>,    <span class="token string">&quot;title&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;测试&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;java&#39;</span>, <span class="token string">&#39;db&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+u+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2-重命名field" tabindex="-1"><a class="header-anchor" href="#_2-重命名field" aria-hidden="true">#</a> 2. 重命名field</h3><p>同样是借助update方法，但是我们用到的关键字为 <code>$rename</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$rename</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;like&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+d+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>请注意，当文档中不存在这个field，则不会有任何影响</strong></p><h3 id="_3-删除field" tabindex="-1"><a class="header-anchor" href="#_3-删除field" aria-hidden="true">#</a> 3. 删除field</h3><p>既然<code>$set</code>可以新增一个不存在的field，那么是不是就可以用<code>$unset</code>来删除一个已存在的field呢</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$unset</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;title&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+k+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_4-数组元素修改" tabindex="-1"><a class="header-anchor" href="#_4-数组元素修改" aria-hidden="true">#</a> 4. 数组元素修改</h3>',16),y={href:"https://www.mongodb.org.cn/manual/update-array/",target:"_blank",rel:"noopener noreferrer"},q=a(`<p>如果我们希望直接修改数组中的某个元素，可以借助之前查询的case</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 修改数组中第0个元素</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;like.0&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;spring&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 如果查询条件中，包含了数组内容的过滤，则可以用\`$\`来代替具体的数组下标，如</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span>, <span class="token string">&#39;like&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$eq</span><span class="token builtin class-name">:</span> <span class="token string">&#39;db&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;like.$&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;mysql&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>请注意，使用<code>$</code>占位符的前途是，前面的查询条件可以限定数组元素</strong></p><h3 id="_5-数组元素新增" tabindex="-1"><a class="header-anchor" href="#_5-数组元素新增" aria-hidden="true">#</a> 5. 数组元素新增</h3><p>元素添加支持两种方式，一是<code>addToSet</code>，一是<code>push</code></p><p><strong><code>$addToSet</code></strong></p><ul><li>确保没有重复的项添加到数组集合，对于已经存在的重复元素不受影响；</li><li>不能保证添加时元素的顺序</li><li>如果值是数组，则作为一个元素添加进去</li><li>可以通过 <code>$each</code> 实现添加多个元素到数组中</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 不存在时，则添加，存在则忽略</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;like&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;redis&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 借助 $each 实现批量添加</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$addToSet</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;like&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$each</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;mongodb&#39;</span>, <span class="token string">&#39;es&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+m+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong><code>$push</code></strong></p><ul><li>如果被更新的文档该数组不存在，那么$push将添加数组字段和值</li><li>如果字段不是数组，失败</li><li>如果值是数组，那么整个数组作为一个单个元素添加到数组</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 不存在时，创建一个数组</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$push</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 存在时，添加到数组</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$push</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 批量添加</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$push</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$each</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;b&#39;</span>, <span class="token string">&#39;c&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+b+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_6-数组元素删除" tabindex="-1"><a class="header-anchor" href="#_6-数组元素删除" aria-hidden="true">#</a> 6. 数组元素删除</h3><p><strong><code>$pop</code></strong> 删除第一个or最后一个</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 删除最后一个</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pop</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 删除第一个</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pop</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> -1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+g+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong><code>$pull</code></strong> 删除满足条件的数组元素</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 将数组中添加几个元素</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$push</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$each</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span>, <span class="token string">&#39;b&#39;</span>, <span class="token string">&#39;c&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 删除指定的元素</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pull</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 删除多个指定的元素</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pull</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$in</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span>, <span class="token string">&#39;c&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+v+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>注意，<code>$pull</code>后面跟上的可以理解为限定条件，查询教程篇的一些操作也是支持的（如比较查询等）</p><h3 id="_7-内嵌文档操作" tabindex="-1"><a class="header-anchor" href="#_7-内嵌文档操作" aria-hidden="true">#</a> 7. 内嵌文档操作</h3><p>对于内嵌文档的操作，实际上普通的field的操作姿势没有什么区别，只是对于key加了一个<code>xx.xx</code>的限定而已</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 删除测试数据</span>
db.doc_demo.remove<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 初始话一条演示文档</span>
db.doc_demo.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;author&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span>,<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 不存在内嵌文档，则新增</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;t&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;a&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&#39;b&#39;</span><span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 修改子field</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;t.a&#39;</span><span class="token builtin class-name">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 新增子field</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;t.c&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 删除子field</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$unset</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;t.c&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 重命名</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$rename</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;t.b&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;t.dd&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+h+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',26);function j(z,B){const t=i("ExternalLinkIcon");return e(),c("div",null,[f,$,l(" more "),x,n("blockquote",null,[n("p",null,[s("数组元素的修改删除增加，可以参考官方教程: "),n("a",y,[s("MongoDB update-array Method"),o(t)])])]),q])}const N=p(_,[["render",j],["__file","14.MongoDB系列教程十二-文档更新删除之非典型篇.html.vue"]]);export{N as default};
