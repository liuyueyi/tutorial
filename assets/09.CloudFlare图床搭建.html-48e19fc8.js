import{_ as o,V as i,W as l,Z as n,a1 as a,$ as t,Y as e,F as d}from"./framework-b1bd8911.js";const p={},c=e('<h1 id="零成本搭建专属图床-cloudflare-imgbed-开源项目部署与深度体验" tabindex="-1"><a class="header-anchor" href="#零成本搭建专属图床-cloudflare-imgbed-开源项目部署与深度体验" aria-hidden="true">#</a> 零成本搭建专属图床：CloudFlare ImgBed 开源项目部署与深度体验</h1><p>在日常的博文记录时，原始图片都是和教程放在一起的，这样的好处是所有的相关信息都很完整，不至于因为外部的存储的各种问题（比如备案、被攻击、价格因素等）导致数据缺失；当然缺点也很明显，在将本地的文章分享到各平台时，还得手动再传一遍图，就有点麻烦</p><p>当然经常做分享的小伙伴，大概率都会维护一个自己的图床。最近在github上发现一个基于CloudFlare的个人免费图床搭建的方案，试了一下，门槛很低，效果不错，推荐给有兴趣的小伙伴</p><h2 id="效果预览" tabindex="-1"><a class="header-anchor" href="#效果预览" aria-hidden="true">#</a> 效果预览</h2><p>我的图床部署在CloudFlare，绑定了自己的域名，为了安全起见，上传图添加了密码限制🤣</p><p>上传页面如下：</p><figure><img src="https://imgbed.ppai.top/file/1770878130782_260212-01.webp" alt="260212-01.webp" tabindex="0" loading="lazy"><figcaption>260212-01.webp</figcaption></figure><p>上传的方式多种，支持拖拽、粘贴、选中文件上传；同时也支持外链批量转存</p><figure><img src="https://imgbed.ppai.top/file/1770878404255_260212-02.webp" alt="260212-02.webp" tabindex="0" loading="lazy"><figcaption>260212-02.webp</figcaption></figure><figure><img src="https://imgbed.ppai.top/file/1770878403207_260212-03.webp" alt="260212-03.webp" tabindex="0" loading="lazy"><figcaption>260212-03.webp</figcaption></figure><p>后台提供了所有的图片管理，如下</p><figure><img src="https://imgbed.ppai.top/file/1770878606831_260212-04.webp" alt="260212-04.webp" tabindex="0" loading="lazy"><figcaption>260212-04.webp</figcaption></figure><p>每个文件支持点击查看详情</p><figure><img src="https://imgbed.ppai.top/file/1770878676528_260212-05.webp" alt="260212-05.webp" tabindex="0" loading="lazy"><figcaption>260212-05.webp</figcaption></figure><blockquote><p>从使用者的角度来看，属实是非常方便了</p></blockquote><p>当然从管理员的角度出发，也有很多使用的设置（比如统计、安全设置、存储通道配置、个性化的设置等等）</p><figure><img src="https://imgbed.ppai.top/file/1770879045350_260212-06.webp" alt="260212-06.webp" tabindex="0" loading="lazy"><figcaption>260212-06.webp</figcaption></figure><h2 id="快速部署" tabindex="-1"><a class="header-anchor" href="#快速部署" aria-hidden="true">#</a> 快速部署</h2><p>这个项目的部署成本真不算高，官方文档写的也挺清晰了，比如我是选择的 Cloudflare + Discord 方案</p><ul><li>CloudFlare：部署项目工程</li><li>Discord: 作为图床存储渠道，保存上传的内容</li></ul><h3 id="前期准备" tabindex="-1"><a class="header-anchor" href="#前期准备" aria-hidden="true">#</a> 前期准备</h3><p>准备CloudFlare账号，注册免费，如果需要使用 <code>Cloudflare R2</code> 作为存储渠道，那么需要绑定支付方式（注意：需要支持境外支付的信用卡）</p><h3 id="discord账号" tabindex="-1"><a class="header-anchor" href="#discord账号" aria-hidden="true">#</a> Discord账号</h3><p>注册免费，使用免费</p><p><strong>创建 Discord Bot</strong></p>',25),r={href:"https://discord.com/developers/applications",target:"_blank",rel:"noopener noreferrer"},u=e("<li>点击 &quot;New Application&quot; 创建应用</li><li>进入 &quot;Bot&quot; 页面，获取你的token（如果没有则点击 <code>Reset Token</code>）</li><li>复制 Bot Token</li><li>点击 OAuth2，在 <code>Scopes</code> 区域勾选 <code>bot</code></li><li>在下面的BotPermissons勾选权限 （不知道选择哪些权限的话，就都选上）</li><li>保存最下面的 <code>Generated URL</code></li>",6),k=n("figure",null,[n("img",{src:"https://imgbed.ppai.top/file/1770879806104_260212-07.webp",alt:"260212-07.webp",tabindex:"0",loading:"lazy"}),n("figcaption",null,"260212-07.webp")],-1),h=n("p",null,[n("strong",null,"获取 Channel ID")],-1),b={href:"https://discord.com/",target:"_blank",rel:"noopener noreferrer"},g=n("li",null,"在 Discord 客户端中启用开发者模式（用户设置 → 高级 → 开发者模式）",-1),m=n("li",null,"添加服务器",-1),f=n("li",null,"在服务器内，创建一个用于存储文件的频道",-1),v=n("li",null,'右键点击频道，选择 "复制频道 ID"',-1),_=n("li",null,"将 Bot 添加到服务器并授予发送文件的权限(这一步就是访问上面获取到的 URL)",-1),q=e('<p>配置成功之后，就会发现我们通过图床上传的文件就会在这个频道内展示，如下</p><figure><img src="https://imgbed.ppai.top/file/1770880110414_260212-08.webp" alt="260212-08.webp" tabindex="0" loading="lazy"><figcaption>260212-08.webp</figcaption></figure><h2 id="cloudflare部署" tabindex="-1"><a class="header-anchor" href="#cloudflare部署" aria-hidden="true">#</a> CloudFlare部署</h2><p>接下来我们就可以直接通过<code>Cloudflare Pages</code>来实现图床的部署。 CF提供免费托管、全球 CDN 加速和无需服务器维护，绝对是部署的首选方式</p><h3 id="_1-fork项目" tabindex="-1"><a class="header-anchor" href="#_1-fork项目" aria-hidden="true">#</a> 1. fork项目</h3>',5),y={href:"https://github.com/MarSeventh/CloudFlare-ImgBed",target:"_blank",rel:"noopener noreferrer"},w=n("h3",{id:"_2-创建pages项目",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-创建pages项目","aria-hidden":"true"},"#"),a(" 2. 创建Pages项目")],-1),x=n("h4",{id:"_2-1-访问-cloudflare-dashboard",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-1-访问-cloudflare-dashboard","aria-hidden":"true"},"#"),a(" 2.1 访问 Cloudflare Dashboard")],-1),C={href:"https://dash.cloudflare.com/",target:"_blank",rel:"noopener noreferrer"},D=n("li",null,'选择左侧菜单的 "Compute & AI" -> "Workers & Pages"',-1),I=n("li",null,'点击 "创建应用程序"',-1),B=n("li",null,[a("在最下方 "),n("code",null,"Looking to deploy Pages?"),a(" 选择 "),n("code",null,"Get started")],-1),T=n("li",null,'在 "导入现有 Git 存储库" 处点击 "开始使用"',-1),P=e('<h4 id="_2-2-连接-github-仓库" tabindex="-1"><a class="header-anchor" href="#_2-2-连接-github-仓库" aria-hidden="true">#</a> 2.2 连接 GitHub 仓库</h4><ul><li>如果首次使用，需要授权 Cloudflare 访问 GitHub</li><li>选择您 Fork 的 CloudFlare-ImgBed 仓库</li><li>点击 &quot;开始设置&quot;</li></ul><h4 id="_2-3-配置项目设置" tabindex="-1"><a class="header-anchor" href="#_2-3-配置项目设置" aria-hidden="true">#</a> 2.3 配置项目设置</h4><table><thead><tr><th>配置项</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>项目名称</td><td><code>cloudflare-imgbed</code>（或自定义）</td><td>项目标识符</td></tr><tr><td>生产分支</td><td><code>main</code></td><td>生产环境分支</td></tr><tr><td>构建命令</td><td><code>npm install</code></td><td>重要：v2.0 新构建命令</td></tr><tr><td>构建输出目录</td><td>/</td><td>保持默认</td></tr></tbody></table><figure><img src="https://cfbed.sanyue.de/images/deployment/pages-build-config.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_2-4-部署项目" tabindex="-1"><a class="header-anchor" href="#_2-4-部署项目" aria-hidden="true">#</a> 2.4 部署项目</h4><ol><li>点击 &quot;保存并部署&quot;</li><li>等待首次部署完成（约 2-3 分钟）</li></ol><h3 id="_3-配置数据库" tabindex="-1"><a class="header-anchor" href="#_3-配置数据库" aria-hidden="true">#</a> 3. 配置数据库</h3><p>数据库用于存储文件元数据，是必需的组件，可选数据库为 <code>KV</code> 数据库和 <code>D1</code> 数据库。两者对比如下表所示，根据自己使用场景<strong>从其中选择一种配置即可</strong>。</p><table><thead><tr><th>特点</th><th>KV 数据库</th><th>D1 数据库</th></tr></thead><tbody><tr><td>读写性能</td><td>高</td><td>较低</td></tr><tr><td>免费额度</td><td>少</td><td>多</td></tr><tr><td>大文件上传</td><td>支持</td><td>不支持</td></tr></tbody></table><blockquote><p>KV 数据库和 D1 数据库<strong>只需要配置其中一个</strong>即可，不需要同时配置两个！建议根据上表选择适合自己的数据库类型。</p></blockquote><p>接下来以 D1 数据库配置进行说明</p><h4 id="创建-d1-数据库" tabindex="-1"><a class="header-anchor" href="#创建-d1-数据库" aria-hidden="true">#</a> 创建 D1 数据库</h4><ol><li>在 Cloudflare Dashboard 中选择 &quot;存储和数据库&quot;</li><li>点击 &quot;D1 SQL 数据库&quot;</li><li>点击 &quot;创建数据库&quot;</li><li>输入数据库名称：<code>img_d1</code>（建议使用此名称）</li><li>点击 &quot;创建&quot;</li></ol><h4 id="初始化-d1-数据库" tabindex="-1"><a class="header-anchor" href="#初始化-d1-数据库" aria-hidden="true">#</a> 初始化 D1 数据库</h4>',15),A=n("li",null,"创建完成后，点击进入数据库详情页",-1),L=n("li",null,'选择 "控制台" 选项卡',-1),S={href:"https://github.com/MarSeventh/CloudFlare-ImgBed/blob/main/database/init.sql",target:"_blank",rel:"noopener noreferrer"},F=n("li",null,'点击 "执行"',-1),M=e('<h4 id="绑定-d1-到项目" tabindex="-1"><a class="header-anchor" href="#绑定-d1-到项目" aria-hidden="true">#</a> 绑定 D1 到项目</h4><ol><li>返回您的 Pages 项目</li><li>选择 &quot;设置&quot; → &quot;绑定&quot;</li><li>点击 &quot;添加&quot; → &quot;D1 数据库&quot;</li><li>填写绑定信息： <ul><li><strong>变量名称</strong>：<code>img_d1</code>（必须是这个名称）</li><li><strong>D1 数据库</strong>：选择刚创建的数据库</li></ul></li><li>点击 &quot;保存&quot;</li></ol><h3 id="_4-重新部署" tabindex="-1"><a class="header-anchor" href="#_4-重新部署" aria-hidden="true">#</a> 4. 重新部署</h3><p>绑定数据库后需要重新部署以生效：</p><ol><li>进入项目的 &quot;部署&quot; 页面</li><li>找到最新的部署记录</li><li>点击右侧的 &quot;...&quot; 菜单</li><li>选择 &quot;重试部署&quot;</li><li>等待部署完成</li></ol><figure><img src="https://cfbed.sanyue.de/images/deployment/redeploy.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h2><p>到上面这一步，我们的图床服务基本搭建完成，接下来就可以直接进入后台做一些配置</p><h3 id="🥘-配置-discord-渠道" tabindex="-1"><a class="header-anchor" href="#🥘-配置-discord-渠道" aria-hidden="true">#</a> 🥘 配置 Discord 渠道</h3><p>在管理后台的 Discord 渠道配置中填入：</p><ul><li><strong>渠道名称</strong>：自定义名称</li><li><strong>Bot Token</strong>：Discord Bot Token</li><li><strong>Channel ID</strong>：Discord 频道 ID</li><li><strong>Is Nitro</strong>：是否为 Nitro 用户（Nitro 用户单文件限制为 25MB，普通用户为 10MB）</li><li><strong>代理 URL</strong>：（可选）自定义代理地址</li></ul><h3 id="🔒-安全设置" tabindex="-1"><a class="header-anchor" href="#🔒-安全设置" aria-hidden="true">#</a> 🔒 安全设置</h3><p>安全相关设置，在管理后台的 &quot;系统设置&quot; → &quot;安全设置&quot; 中配置</p><h4 id="认证管理" tabindex="-1"><a class="header-anchor" href="#认证管理" aria-hidden="true">#</a> 认证管理</h4><ul><li>用户端认证：用于 Web 端用户登录和 API 认证</li><li>管理端认证： 管理员用户名和密码，用于访问管理后台</li></ul><h4 id="上传管理" tabindex="-1"><a class="header-anchor" href="#上传管理" aria-hidden="true">#</a> 上传管理</h4><p><strong>图像审查</strong></p><p>审查渠道支持 <code>nsfwjs</code> 和 <code>moderatecontent.com</code>，可根据如下步骤自行配置。</p>',18),R={href:"http://1.moderatecontent.com",target:"_blank",rel:"noopener noreferrer"},z={href:"https://moderatecontent.com/",target:"_blank",rel:"noopener noreferrer"},U=n("li",null,"注册并获取免费 API Key（目前已不再支持免费注册）",-1),N=n("li",null,'在管理后台 "系统设置" → "安全设置" 中填入 API Key',-1),V=e(`<p>2.nsfwjs</p><ul><li>使用 Docker 部署 <code>nsfwjs</code> 审查服务</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 参考命令</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:5000:5000/tcp <span class="token punctuation">\\</span>
  <span class="token parameter variable">--env</span> <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">5000</span> <span class="token punctuation">\\</span>
  <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
  eugencepoi/nsfw_api:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在管理后台 &quot;系统设置&quot; → &quot;安全设置&quot; 中填入审查服务地址，如 <code>https://nsfwjs.your.domain</code></li></ul><h4 id="访问管理" tabindex="-1"><a class="header-anchor" href="#访问管理" aria-hidden="true">#</a> 访问管理</h4><ul><li>域名过滤 <ul><li>放行域名：允许访问的域名列表（留空放行所有域名，否则需要手动添加图床自身域名）</li></ul></li><li>白名单模式：启用后仅允许加入白名单的文件被访问</li></ul><h3 id="🌐-网页设置" tabindex="-1"><a class="header-anchor" href="#🌐-网页设置" aria-hidden="true">#</a> 🌐 网页设置</h3><p>前端网页相关设置，在管理后台的 &quot;系统设置&quot; → &quot;网页设置&quot; 中配置</p><table><thead><tr><th>字段名</th><th>用途</th><th>类型</th><th>内容规范</th></tr></thead><tbody><tr><td>siteTitle</td><td>网站标题</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的网站标题</td></tr><tr><td>siteIcon</td><td>网站图标</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的网站图标链接</td></tr><tr><td>ownerName</td><td>图床名称</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的图床名称（默认为<code>Sanyue</code>）</td></tr><tr><td>logoUrl</td><td>图床Logo</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的图床Logo链接</td></tr><tr><td>logoLink</td><td>Logo跳转链接</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为点击Logo时跳转的链接，留空则使用默认GitHub链接。仅对上传页面生效</td></tr><tr><td>bkInterval</td><td>背景切换间隔</td><td>正整数</td><td>设置为背景图的轮播时间，默认<code>3000</code>，单位<code>ms</code>。<br>例如你希望10s切换一次，设置为<code>10000</code>即可。</td></tr><tr><td>bkOpacity</td><td>背景图透明度</td><td>(0,1]的浮点数</td><td>展示的背景图透明度，默认为<code>1</code>。<br>如果你觉得显示效果不佳，可以自定义，如<code>0.8</code></td></tr><tr><td>urlPrefix</td><td>默认 URL 前缀</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为自定义的全局默认链接前缀，该前缀会覆盖原始默认前缀，但不会覆盖用户自定义的链接前缀</td></tr><tr><td>announcement</td><td>公告</td><td>字符串</td><td>只支持<code>字符串</code>类型，可以为 HTML 格式，设置为你自定义的公告内容（如有）</td></tr><tr><td>defaultUploadChannel</td><td>默认上传渠道</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的默认上传渠道，支持<code>telegram</code>（Telegram 渠道）、<code>cfr2</code>（Cloudflare R2）、<code>s3</code>（S3 渠道）、<code>discord</code>（Discord 渠道）和<code>huggingface</code>（HuggingFace 渠道）</td></tr><tr><td>defaultChannelName</td><td>默认渠道名称</td><td>字符串</td><td>只支持<code>字符串</code>类型，指定默认使用的渠道名称，需先选择上传渠道。当同一渠道类型配置了多个渠道时，可通过此项指定默认使用哪个渠道</td></tr><tr><td>defaultUploadNameType</td><td>默认命名方式</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的默认上传文件命名方式，支持<code>default</code>（默认）、<code>index</code>（仅前缀）、<code>original</code>（仅原名）和<code>short</code>（短链接）</td></tr><tr><td>loginBkImg</td><td>登录页背景图</td><td>列表/字符串</td><td>1、当字段类型为<code>列表</code>时，列表中元素为需要添加到轮播列表中的图片链接（列表中只有一张图时即为固定背景），形如<code>[&quot;1.jpg&quot;,&quot;2.jpg&quot;]</code><br>2、当字段类型为<code>字符串</code>时，目前<strong>仅支持</strong>字符串值为<code>bing</code>，设置为该值时启用bing随机图片轮播模式。</td></tr><tr><td>uploadBkImg</td><td>上传页背景图</td><td>列表/字符串</td><td>同loginBkImg</td></tr><tr><td>footerLink</td><td>页脚传送门链接</td><td>字符串</td><td>只支持<code>字符串</code>类型，设置为你自定义的传送地址（如个人博客链接）</td></tr><tr><td>disableFooter</td><td>隐藏页脚</td><td>boolean</td><td>支持<code>boolean</code>类型，设为<code>true</code>时禁用页脚，默认<code>false</code></td></tr><tr><td>defaultConvertToWebp</td><td>默认转换 WebP</td><td>boolean</td><td>支持<code>boolean</code>类型，设为<code>true</code>时默认开启 WebP 转换，默认<code>false</code></td></tr><tr><td>defaultCustomerCompress</td><td>默认开启压缩</td><td>boolean</td><td>支持<code>boolean</code>类型，设为<code>true</code>时默认开启客户端压缩，默认<code>true</code></td></tr><tr><td>defaultCompressBar</td><td>默认压缩阈值</td><td>数字</td><td>图片大小超过此值将自动压缩，单位 MB，范围 1-20，默认<code>5</code></td></tr><tr><td>defaultCompressQuality</td><td>默认期望大小</td><td>数字</td><td>压缩后图片大小期望值，单位 MB，范围 0.5-压缩阈值，默认<code>4</code></td></tr><tr><td>adminLoginBkImg</td><td>管理页登录背景图</td><td>列表/字符串</td><td>同loginBkImg</td></tr><tr><td>adminBkImg</td><td>管理页背景图</td><td>列表/字符串</td><td>同loginBkImg</td></tr></tbody></table><h2 id="上传api" tabindex="-1"><a class="header-anchor" href="#上传api" aria-hidden="true">#</a> 上传API</h2><p>除了通过网页的控制台进行图片上传之外，还提供了API的上传方式，这样服务器开发的小伙伴，也是可以使用的，但是需要注意的是官方的文档有个bug，authCode是放在请求头中，通过 HTTP 的 <code>Authorization</code> 方式进行鉴权，而不是原文中的请求参数携带</p><p>如何发现的呢？源码的实现鉴权逻辑如下🤣</p><figure><img src="https://imgbed.ppai.top/file/1770881442064_260212-09.webp" alt="260212-09.webp" tabindex="0" loading="lazy"><figcaption>260212-09.webp</figcaption></figure><p>接口上传方式：</p><ul><li>端点：/upload</li><li>方法：POST</li><li>认证：使用上传认证码或 <code>API Token</code>（需要upload权限）</li><li>内容类型：multipart/form-data</li><li>文件大小限制：根据存储渠道而定</li></ul><p>请求示例</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> POST <span class="token string">&#39;https://your.domain/upload&#39;</span> <span class="token punctuation">\\</span>

 <span class="token parameter variable">--header</span> <span class="token string">&#39;Authorization: Bearer 你的token&#39;</span> <span class="token punctuation">\\</span>

 <span class="token parameter variable">--header</span> <span class="token string">&#39;User-Agent: Apifox/1.0.0 (https://apifox.com)&#39;</span> <span class="token punctuation">\\</span>
 
 <span class="token parameter variable">--form</span> <span class="token string">&#39;file=@&quot;D:\\\\杂文件\\\\壁纸\\\\genshin109.jpg&quot;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Java请求示例</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 上传文件
 *
 * <span class="token keyword">@param</span> <span class="token parameter">bytes</span>    文件字节数组
 * <span class="token keyword">@param</span> <span class="token parameter">fileType</span> 文件类型(如: jpg, png)
 * <span class="token keyword">@return</span> 上传后的文件URL
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">,</span> <span class="token class-name">String</span> fileType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">RestClient</span> restClient <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token constant">HOST</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建 ByteArrayResource</span>
        body<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayResource</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token constant">MD5</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digestHex</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> fileType<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> ans <span class="token operator">=</span> restClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> <span class="token constant">AUTH_CODE</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">MULTIPART_FORM_DATA</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ImgBedRes</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span> <span class="token class-name">ImgBedRes</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">HOST</span> <span class="token operator">+</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;文件上传异常&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;文件上传异常: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">ImgBedRes</span><span class="token punctuation">(</span><span class="token class-name">String</span> src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了上面的API方式之外，这个项目还提供了 WebDAV 并支持了 PicGo图床工具的搭配使用，有兴趣的小伙伴可以自行尝试</p><p><strong>WebDAV 支持</strong></p><ul><li>标准协议：支持 WebDAV 标准方法（PROPFIND, GET, PUT, DELETE 等）</li><li>目录浏览：支持通过 WebDAV 客户端浏览和管理文件</li><li>文件操作：支持上传、下载、删除文件和目录</li></ul><p><strong>第三方集成</strong></p><ul><li>PicGo 支持：完美兼容 PicGo 图床工具</li><li>跨域支持：API 支持跨域访问</li></ul>`,24),W={href:"https://github.com/MarSeventh/CloudFlare-ImgBed",target:"_blank",rel:"noopener noreferrer"};function j(O,G){const s=d("ExternalLinkIcon");return i(),l("div",null,[c,n("ul",null,[n("li",null,[a("访问 "),n("a",r,[a("Discord Developer Portal"),t(s)])]),u]),k,h,n("ul",null,[n("li",null,[a("进入主页："),n("a",b,[a("https://discord.com/"),t(s)])]),g,m,f,v,_]),q,n("p",null,[a("fork原始项目到自己的仓库: "),n("a",y,[a("https://github.com/MarSeventh/CloudFlare-ImgBed"),t(s)])]),w,x,n("ul",null,[n("li",null,[a("登录 "),n("a",C,[a("Cloudflare Dashboard"),t(s)])]),D,I,B,T]),P,n("ol",null,[A,L,n("li",null,[a("在 SQL 输入框中粘贴并执行注释区域以下的内容（见"),n("a",S,[a("https://github.com/MarSeventh/CloudFlare-ImgBed/blob/main/database/init.sql"),t(s)]),a("）")]),F]),M,n("p",null,[n("a",R,[a("1.moderatecontent.com"),t(s)])]),n("ul",null,[n("li",null,[a("访问 "),n("a",z,[a("ModerateContent"),t(s)])]),U,N]),V,n("p",null,[a("项目源码："),n("a",W,[a("MarSeventh/CloudFlare-ImgBed"),t(s)])])])}const E=o(p,[["render",j],["__file","09.CloudFlare图床搭建.html.vue"]]);export{E as default};
