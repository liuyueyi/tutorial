import{_ as p,V as e,W as o,X as l,Y as n,Z as s,$ as t,a1 as c,F as i}from"./framework-094145d2.js";const u="/tutorial/imgs/180927/00.jpg",r="/tutorial/imgs/180927/01.jpg",k="/tutorial/imgs/180927/02.jpg",g={},d=n("p",null,"对于一个后端来说，日志是不可缺少的，这个东西，形象点就像剑客手中的剑，没有剑你就刷不了帅，砍不了人。所以就有必要好好的说道说道，这个日志文件的管理了。本篇博文将关注以下几点内容",-1),v=n("ul",null,[n("li",null,"日志级别选择"),n("li",null,"日志输出到文件"),n("li",null,"格式化输出"),n("li",null,"日志文件管理（自动删除，压缩归档等）"),n("li",null,"常用的logback-spring.xml配置")],-1),m=c(`<h2 id="i-默认日志参数" tabindex="-1"><a class="header-anchor" href="#i-默认日志参数" aria-hidden="true">#</a> I. 默认日志参数</h2><h3 id="_1-基础项目搭建" tabindex="-1"><a class="header-anchor" href="#_1-基础项目搭建" aria-hidden="true">#</a> 1. 基础项目搭建</h3><p>创建一个SpringBoot项目，根据官方文档的说明，默认选择的是Logback来记录日志；logback也是相对来说用的比较多的框架了，下文全都默认以logback作为日志输出框架</p><blockquote><p>By default, if you use the “Starters”, Logback is used for logging. Appropriate Logback routing is also included to ensure that dependent libraries that use Java Util Logging, Commons Logging, Log4J, or SLF4J all work correctly.</p></blockquote><p>完整的pom依赖如下，即不需要引入什么特别的依赖，基本上就是SpringBoot项目最根本的项目结构</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>Finchley.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>写一个简单的日志测试</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;---&gt; debug start! &lt;------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;---&gt; info start! &lt;------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;---&gt; warn start! &lt;------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;---&gt; error start! &lt;------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===&gt; System.out.println &lt;=====&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看下控制台输出结果，info,warn,error可以正常输出且输出格式包含一些附加信息，System.out也可以正常输出，debug的日志没有</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2018</span>-09-26 <span class="token number">14</span>:16:01.136  INFO <span class="token number">38924</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.git.hui.boot.log.Application         <span class="token builtin class-name">:</span> ---<span class="token operator">&gt;</span> info start<span class="token operator">!</span> <span class="token operator">&lt;</span>------
<span class="token number">2018</span>-09-26 <span class="token number">14</span>:16:01.137  WARN <span class="token number">38924</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.git.hui.boot.log.Application         <span class="token builtin class-name">:</span> ---<span class="token operator">&gt;</span> warn start<span class="token operator">!</span> <span class="token operator">&lt;</span>------
<span class="token number">2018</span>-09-26 <span class="token number">14</span>:16:01.137 ERROR <span class="token number">38924</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.git.hui.boot.log.Application         <span class="token builtin class-name">:</span> ---<span class="token operator">&gt;</span> error start<span class="token operator">!</span> <span class="token operator">&lt;</span>------
<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> System.out.println <span class="token operator">&lt;=</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-配置说明" tabindex="-1"><a class="header-anchor" href="#_2-配置说明" aria-hidden="true">#</a> 2. 配置说明</h3><p>接下来在进入logback的配置文件之前，先看一下默认的配置有哪些，以及如何使用</p><h4 id="a-debug日志支持" tabindex="-1"><a class="header-anchor" href="#a-debug日志支持" aria-hidden="true">#</a> a. debug日志支持</h4><p>默认是不输出debug日志的，如果需要，则需要在配置文件中添加 <code>debug=true</code> 属性；同样可以设置<code>trace=true</code>，就可以看应用输出的trace日志</p><p>然而，即便开启了debug，上面测试中的debug日志也依然没有，那需要输出上面的debug日志，应该怎么设置？</p><h4 id="b-log-levels" tabindex="-1"><a class="header-anchor" href="#b-log-levels" aria-hidden="true">#</a> b. log levels</h4><p>上面的配置虽然在控制台打印了一些debug日志，但并没有打印我们业务代码中的debug日志，需要开启这个，需要如下设置</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token value attr-value">DEBUG</span>
<span class="token key attr-name">logging.level.org.springframework</span><span class="token punctuation">=</span><span class="token value attr-value">INFO</span>
<span class="token key attr-name">logging.level.org.hibernate</span><span class="token punctuation">=</span><span class="token value attr-value">ERROR</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个配置就是指定包下日志输出的等级，root表示默认的级别</p><p>如上配置后，再次执行上面的代码，输出结果如下</p><figure><img src="`+u+`" alt="log level测试" tabindex="0" loading="lazy"><figcaption>log level测试</figcaption></figure><h4 id="c-输出格式" tabindex="-1"><a class="header-anchor" href="#c-输出格式" aria-hidden="true">#</a> c. 输出格式</h4><p>默认的输出格式如前面的截图，如果希望更改下输出的日志格式，可以通过修改属性来完成，一个也实例如下</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">logging.pattern.console</span><span class="token punctuation">=</span><span class="token value attr-value">%date{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次执行，输出样式如下</p><figure><img src="`+r+`" alt="输出格式" tabindex="0" loading="lazy"><figcaption>输出格式</figcaption></figure><p>至于这个属性值的构成原则，在后面说到<code>logback.xml</code>配置文件语法时，一并再说</p><p><strong>说明</strong></p><p>还有个参数可以设置文本的颜色，个人感觉实用性不是特别大，只贴下配置如下</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">## 检测终端是否支持ANSI，是的话就采用彩色输出</span>
<span class="token key attr-name">spring.output.ansi.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">detect</span>
<span class="token comment">## %clr(){} 格式，使文本以蓝色输出</span>
<span class="token key attr-name">logging.pattern.console</span><span class="token punctuation">=</span><span class="token value attr-value">%clr(%d{yyyy-MM-dd HH:mm:ss.SSS} %thread] %-5level %logger{36} - %msg%n){blue}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="d-输出文件" tabindex="-1"><a class="header-anchor" href="#d-输出文件" aria-hidden="true">#</a> d. 输出文件</h4><p>上面所有的日志都是输出到控制台，在实际的生成环境中，一般要求日志写到文件，可以方便随时进行查看，通过设置相关参数也可以很简单实现</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">## 输出的日志文件</span>
<span class="token key attr-name">logging.file</span><span class="token punctuation">=</span><span class="token value attr-value">logs/info.log</span>
<span class="token comment">## 当文件超过1G时，归档压缩</span>
<span class="token key attr-name">logging.file.max-size</span><span class="token punctuation">=</span><span class="token value attr-value">1GB</span>
<span class="token comment">## 日志文件最多保存3天</span>
<span class="token key attr-name">logging.file.max-history</span><span class="token punctuation">=</span><span class="token value attr-value">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样执行前面的代码两次，输出如下, 两次的输出结果都可以在日志文件中查到，相比较于控制台而言，用于查历史日志就更加的方便了</p><figure><img src="`+k+'" alt="输出文件演示" tabindex="0" loading="lazy"><figcaption>输出文件演示</figcaption></figure><p>上图中，控制台的输出格式和日志文件的输出格式不一样，因为前面修改了控制台的输出样式；如果希望修改文件中的日志格式，也可以通过修改配置<code>logging.pattern.file</code>来实现</p><h4 id="e-logback-xml配置" tabindex="-1"><a class="header-anchor" href="#e-logback-xml配置" aria-hidden="true">#</a> e. logback.xml配置</h4><p>上面的配置虽然ok，但是对于Logback而言，还是有很多高级特性不太好配置，因此SpringBoot还是支持通过加载<code>logback-spring.xml</code>配置文件来定义日志相关的参数，只需要在资源文件目录下添加 <code>logback-spring.xml</code> 或者 <code>logging.config</code> 即可</p><h2 id="ii-其他" tabindex="-1"><a class="header-anchor" href="#ii-其他" aria-hidden="true">#</a> II. 其他</h2><h3 id="相关文档" tabindex="-1"><a class="header-anchor" href="#相关文档" aria-hidden="true">#</a> 相关文档</h3>',40),b={href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-logging.html",target:"_blank",rel:"noopener noreferrer"},h=n("h3",{id:"_0-项目",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_0-项目","aria-hidden":"true"},"#"),s(" 0. 项目")],-1),f={href:"https://github.com/liuyueyi/spring-boot-demo",target:"_blank",rel:"noopener noreferrer"},_={href:"https://github.com/liuyueyi/spring-boot-demo/tree/master/spring-boot/003-log",target:"_blank",rel:"noopener noreferrer"};function y(x,S){const a=i("ExternalLinkIcon");return e(),o("div",null,[d,v,l(" more "),m,n("ul",null,[n("li",null,[n("a",b,[s("SpringBoot Logging"),t(a)])])]),h,n("ul",null,[n("li",null,[s("工程："),n("a",f,[s("spring-boot-demo"),t(a)])]),n("li",null,[s("具体模块: "),n("a",_,[s("spring-boot-demo#003-log"),t(a)])])])])}const w=p(g,[["render",y],["__file","01.180927-SpringBoot基础篇日志管理之默认配置.html.vue"]]);export{w as default};
