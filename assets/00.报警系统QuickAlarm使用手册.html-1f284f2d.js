import{_ as e,V as o,W as c,a1 as l,X as n,Y as s,Z as t,a0 as p,F as u}from"./framework-23f3cf9b.js";const i={},r=n("p",null,"本文将主要说明QuickAlarm该如何使用，以及使用时需要注意事项",-1),k=p(`<h2 id="_1-基本使用姿势" tabindex="-1"><a class="header-anchor" href="#_1-基本使用姿势" aria-hidden="true">#</a> 1. 基本使用姿势</h2><p>首先我们不做任何的自定义操作，全部依靠系统默认的实现，我们的使用步骤如下</p><h3 id="_1-添加注册文件" tabindex="-1"><a class="header-anchor" href="#_1-添加注册文件" aria-hidden="true">#</a> 1. 添加注册文件</h3><p>首先在项目的资源目录下，添加注册文件 <code>alarm.properties</code>，文件内容如下</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>## 应用名，必填
appName=test

## 报警规则文件所在的路径，如果采用系统默认加载方式，必填
## / 开头，表示存的是绝对路径
## 非/开头，表示存的是系统相对路径，一般是放在资源目录下
alarmConfPath=/tmp/alarmConfig

## 最大的报警类型，非必填
maxAlarmType=1000

## 默认报警用户，必填
defaultAlarmUsers=yihui
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>具体存放的位置，可以参考下图，放在resources目录下（源码中，是放在测试资源目录下的）</p><figure><img src="https://s3.mogucdn.com/mlcdn/c45406/180211_19i0ckjaic6f22i7hlai52ja471gc_1988x1178.jpg" alt="IMAGE" tabindex="0" loading="lazy"><figcaption>IMAGE</figcaption></figure><h3 id="_2-添加报警规则" tabindex="-1"><a class="header-anchor" href="#_2-添加报警规则" aria-hidden="true">#</a> 2. 添加报警规则</h3><p>根据注册文件中指定的路径，设置报警规则文件，如我们的报警规则文件</p>`,9),d={href:"https://github.com/liuyueyi/PopClip#4-json",target:"_blank",rel:"noopener noreferrer"},m=p(`<p><strong>/tmp/alarmConig:</strong></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;default&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;SMS&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;345345345345&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123123123123&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;erhui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;LOG&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;erhui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;NPE&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;SMS&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;345345345345&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123123123123&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;3h    ui&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;4hui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">&quot;XXX,YYY&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;EMAIL&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;autoIncEmergency&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">&quot;max&quot;</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token property">&quot;min&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;SMS&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;345345345345&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123123123123&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;erhui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;level&quot;</span><span class="token operator">:</span><span class="token string">&quot;EMAIL&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui@xxx.com&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;erhui@xxx.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;yihui@xxx.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-测试类" tabindex="-1"><a class="header-anchor" href="#_3-测试类" aria-hidden="true">#</a> 3. 测试类</h3><p>一个简单的使用测试</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;NPE&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;NPE异常&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;出现NPE异常了!!!&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">AlarmWrapper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> title<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 微信报警</span>

    <span class="token comment">// 不存在异常配置类型, 采用默认报警, 次数较小, 则直接部署出</span>
    <span class="token class-name">AlarmWrapper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token string">&quot;zzz&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;不存在xxx异常配置&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;报警嗒嗒嗒嗒&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ii-报警执行机器扩展" tabindex="-1"><a class="header-anchor" href="#ii-报警执行机器扩展" aria-hidden="true">#</a> II. 报警执行机器扩展</h2><p>前面的报警规则配置中，有WEIXIN, SMS, EMAIL的报警，但是系统只提供了两个NONE和LOG，所以我们可以看下如何自定义实现上面的三个</p><h3 id="_1-实现iexecute接口" tabindex="-1"><a class="header-anchor" href="#_1-实现iexecute接口" aria-hidden="true">#</a> 1. 实现IExecute接口</h3><p>邮件报警</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailExecute</span> <span class="token keyword">extends</span> <span class="token class-name">LogExecute</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> title<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>短信报警</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Created by yihui on 2018/2/7.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsExecute</span> <span class="token keyword">extends</span> <span class="token class-name">LogExecute</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> title<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>微信报警</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Created by yihui on 2018/2/7.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeiXinExecute</span> <span class="token keyword">extends</span> <span class="token class-name">LogExecute</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> title<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明，因为没有具体的实现，所以我们直接用日志输出来模拟，所以就都继承了LogExecute, 实际使用中，可以在上面补上相应的实现代码</p><h3 id="_2-添加spi定义" tabindex="-1"><a class="header-anchor" href="#_2-添加spi定义" aria-hidden="true">#</a> 2. 添加SPI定义</h3><p>在 resources 目录下，新增</p><ul><li>目录：META-INF/services/</li><li>文件：com.hust.hui.alarm.core.execut.api.IExecute</li></ul><p>文件内容为上面几个实现类的全路径</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>com.hust.hui.alarm.core.test.execute.EmailExecute
com.hust.hui.alarm.core.test.execute.SmsExecute
com.hust.hui.alarm.core.test.execute.WeiXinExecute
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目录结构如：</p><figure><img src="https://s3.mogucdn.com/mlcdn/c45406/180211_39e88dgb9c5f1h1ggdae85dde89ii_938x266.jpg" alt="IMAGE" tabindex="0" loading="lazy"><figcaption>IMAGE</figcaption></figure><h3 id="_3-测试" tabindex="-1"><a class="header-anchor" href="#_3-测试" aria-hidden="true">#</a> 3. 测试</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 测试异常升级的case</span>
    <span class="token comment">// 计数 [1 - 2] 默认报警（即无日志） （其中 &lt; 3 的是因为未达到下限, 采用的默认报警）</span>
    <span class="token comment">// 计数 [3 - 4] 默认邮件报警（其中 &lt; 5 采用的默认报警, 与下面的区别是报警用户）</span>
    <span class="token comment">// 计数 [5 - 9] 邮件报警 （大于5小于10根据上升规则,还是选择邮件报警）</span>
    <span class="token comment">// 计数 [10 - 19] 微信报警</span>
    <span class="token comment">// 计数 [20 - 30] 短信报警</span>
    <span class="token comment">// 计数 [31 -] 默认报警 （超过上限, 不报警）</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">AlarmWrapper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token string">&quot;YYY&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;异常报警升级测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实测输出结果如下:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>Thread-12<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">26</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-24<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">16</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-33<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com, erhui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">6</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-22<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">18</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-26<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">14</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-23<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">17</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-35<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">4</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>sms-sender1-thread-4<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">10</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>sms-sender1-thread-3<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com, erhui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">5</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>Thread-18<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">27</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>Thread-11<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">28</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-21<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">19</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>sms-sender1-thread-2<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com, erhui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">9</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-14<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">24</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.997 <span class="token punctuation">[</span>Thread-10<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">29</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-15<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">22</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-16<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">23</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>sms-sender1-thread-5<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">15</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-9<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">30</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>sms-sender1-thread-1<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">11</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-13<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">25</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-19<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">21</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:28.998 <span class="token punctuation">[</span>Thread-34<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">3</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:29.010 <span class="token punctuation">[</span>sms-sender1-thread-4<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com, erhui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">7</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:29.010 <span class="token punctuation">[</span>sms-sender1-thread-3<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">12</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:29.011 <span class="token punctuation">[</span>sms-sender1-thread-2<span class="token punctuation">]</span> INFO  alarm - Do send msg by WEIXIN to user:<span class="token punctuation">[</span>yihui, erhui<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">13</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:29.014 <span class="token punctuation">[</span>sms-sender1-thread-5<span class="token punctuation">]</span> INFO  alarm - Do send msg by EMAIL to user:<span class="token punctuation">[</span>yihui@xxx.com, erhui@xxx.com<span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">8</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
<span class="token number">18</span>:36:29.014 <span class="token punctuation">[</span>sms-sender1-thread-1<span class="token punctuation">]</span> INFO  alarm - Do send msg by SMS to user:<span class="token punctuation">[</span><span class="token number">345345345345</span>, <span class="token number">123123123123</span><span class="token punctuation">]</span>, title: <span class="token punctuation">[</span>test<span class="token punctuation">]</span>, msg:  ip:172.17.13.18 <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> key:YYY <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常数: <span class="token number">20</span> <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 异常报警升级测试
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="iii-报警规则加载自定义" tabindex="-1"><a class="header-anchor" href="#iii-报警规则加载自定义" aria-hidden="true">#</a> III. 报警规则加载自定义</h2><h3 id="_1-实现iconfloader接口" tabindex="-1"><a class="header-anchor" href="#_1-实现iconfloader接口" aria-hidden="true">#</a> 1. 实现IConfLoader接口</h3><p>自定义加载器，给了一个最基本的</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SelfAlarmConfLoader</span> <span class="token keyword">implements</span> <span class="token class-name">IConfLoader</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">RegisterInfo</span> <span class="token function">getRegisterInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RegisterInfo</span> registerInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegisterInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registerInfo<span class="token punctuation">.</span><span class="token function">setMaxAlarmType</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registerInfo<span class="token punctuation">.</span><span class="token function">setDefaultAlarmUsers</span><span class="token punctuation">(</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registerInfo<span class="token punctuation">.</span><span class="token function">setAppName</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registerInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">alarmEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AlarmConfig</span> <span class="token function">getAlarmConfig</span><span class="token punctuation">(</span><span class="token class-name">String</span> alarmKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//db 查询，获取对应的配置信息</span>
        <span class="token comment">// 下面是模拟，返回一个固定的配置</span>
        <span class="token class-name">AlarmConfig</span> alarmConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlarmConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmConfig<span class="token punctuation">.</span><span class="token function">setAlarmLevel</span><span class="token punctuation">(</span><span class="token string">&quot;WEIXIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmConfig<span class="token punctuation">.</span><span class="token function">setAutoIncEmergency</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmConfig<span class="token punctuation">.</span><span class="token function">setMinLimit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmConfig<span class="token punctuation">.</span><span class="token function">setMaxLimit</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmConfig<span class="token punctuation">.</span><span class="token function">setUsers</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;yihui&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alarmConfig<span class="token punctuation">.</span><span class="token function">setAlarmThreshold</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> alarmConfig<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-添加spi配置" tabindex="-1"><a class="header-anchor" href="#_2-添加spi配置" aria-hidden="true">#</a> 2. 添加SPI配置</h3><p>在resources目录下新增</p><ul><li>目录： META-INF/services</li><li>文件： com.hust.hui.alarm.core.loader.api.IConfLoader</li></ul><p>文件内容</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>com.hust.hui.alarm.core.test.loader.SelfAlarmConfLoader
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-测试-1" tabindex="-1"><a class="header-anchor" href="#_3-测试-1" aria-hidden="true">#</a> 3. 测试</h3><p>同样是上面的代码，输出结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>18:43:04.275 [sms-sender1-thread-2] INFO  alarm - Do send msg by WEIXIN to user:[yihui], title: [test], msg:  ip:172.17.13.18 &gt;&gt;&gt; key:YYY &gt;&gt;&gt; 异常数: 10 &gt;&gt;&gt; 异常报警升级测试
18:43:04.275 [sms-sender1-thread-4] INFO  alarm - Do send msg by WEIXIN to user:[yihui], title: [test], msg:  ip:172.17.13.18 &gt;&gt;&gt; key:YYY &gt;&gt;&gt; 异常数: 12 &gt;&gt;&gt; 异常报警升级测试
18:43:04.276 [sms-sender1-thread-1] INFO  alarm - Do send msg by WEIXIN to user:[yihui], title: [test], msg:  ip:172.17.13.18 &gt;&gt;&gt; key:YYY &gt;&gt;&gt; 异常数: 11 &gt;&gt;&gt; 异常报警升级测试
18:43:04.275 [sms-sender1-thread-5] INFO  alarm - Do send msg by WEIXIN to user:[yihui], title: [test], msg:  ip:172.17.13.18 &gt;&gt;&gt; key:YYY &gt;&gt;&gt; 异常数: 14 &gt;&gt;&gt; 异常报警升级测试
18:43:04.275 [sms-sender1-thread-3] INFO  alarm - Do send msg by WEIXIN to user:[yihui], title: [test], msg:  ip:172.17.13.18 &gt;&gt;&gt; key:YYY &gt;&gt;&gt; 异常数: 13 &gt;&gt;&gt; 异常报警升级测试
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-说明" tabindex="-1"><a class="header-anchor" href="#_4-说明" aria-hidden="true">#</a> 4. 说明</h3><p>系统默认的order是10，所以如果在测试上面的第二步时，不妨把<code>com.hust.hui.alarm.core.test.loader.SelfAlarmConfLoader#order</code>返回值，改成大于10，这样就会走到默认的配置加载类</p><p>采用 <code>SelfAlarmConfLoader</code> 时，前面说的两个基础配置文件，是可以没有的，完全不会有任何影响，因为对应的注册类和报警规则，都是右这个类内部提供了</p><h2 id="iv-小结" tabindex="-1"><a class="header-anchor" href="#iv-小结" aria-hidden="true">#</a> IV. 小结</h2><p>所有测试相关数据，均可以在测试工程中获取，请主要关注:</p>`,43),g={href:"https://github.com/liuyueyi/quick-alarm/blob/master/core/src/test/java/com/hust/hui/alarm/core/test/",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/liuyueyi/quick-alarm/blob/master/core/src/test/resources/alarm.properties",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/liuyueyi/quick-alarm/blob/master/core/src/main/resources/alarmConfig",target:"_blank",rel:"noopener noreferrer"},h=n("h3",{id:"项目-quickalarm",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#项目-quickalarm","aria-hidden":"true"},"#"),s(" 项目: QuickAlarm")],-1),y={href:"https://github.com/liuyueyi/quick-alarm",target:"_blank",rel:"noopener noreferrer"},q={href:"https://liuyueyi.github.io/hexblog/",target:"_blank",rel:"noopener noreferrer"};function x(I,f){const a=u("ExternalLinkIcon");return o(),c("div",null,[r,l(" more "),k,n("p",null,[s("内容为json串格式，支持格式化的json串解析，为了节省篇幅，下面压缩成一行，点击获取"),n("a",d,[s("json格式化小工具"),t(a)])]),m,n("ul",null,[n("li",null,[n("a",g,[s("测试case"),t(a)])]),n("li",null,[s("注册文件："),n("a",v,[s("alarmConfig"),t(a)])]),n("li",null,[s("报警规则配置文件："),n("a",b,[s("alarm.properties"),t(a)])])]),h,n("ul",null,[n("li",null,[s("项目地址： "),n("a",y,[s("Quick-Alarm"),t(a)])]),n("li",null,[s("博客地址： "),n("a",q,[s("小灰灰Blog"),t(a)])])])])}const _=e(i,[["render",x],["__file","00.报警系统QuickAlarm使用手册.html.vue"]]);export{_ as default};
