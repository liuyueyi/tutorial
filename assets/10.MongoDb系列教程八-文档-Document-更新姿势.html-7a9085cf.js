import{_ as s,V as n,W as a,X as t,Y as e,a1 as p}from"./framework-094145d2.js";const i="/tutorial/imgs/200327/00.jpg",l="/tutorial/imgs/200327/01.jpg",o="/tutorial/imgs/200327/02.jpg",c="/tutorial/imgs/200327/03.jpg",u="/tutorial/imgs/200327/04.jpg",r={},d=e("p",null,"本篇介绍update/save两种方法提供的更新姿势",-1),k=p(`<h3 id="_1-update" tabindex="-1"><a class="header-anchor" href="#_1-update" aria-hidden="true">#</a> 1. update</h3><p>用于更新已经存在的文档，语法如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.collection.update<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>query<span class="token operator">&gt;</span>,
   <span class="token operator">&lt;</span>update<span class="token operator">&gt;</span>,
   <span class="token punctuation">{</span>
     upsert: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     multi: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>query: 查询条件</li><li>update: 更新语句</li><li>upsert: （可选）true, 不存在update的记录时插入；默认是false，不插入</li><li>multi: (可选) true，表示更新所有满足条件的记录；默认false，只更新第一条</li><li>writeConcern: (可选)，抛出异常的级别</li></ul><p>插入两条用于测试的数据</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰&#39;</span>, <span class="token string">&#39;age&#39;</span><span class="token builtin class-name">:</span> <span class="token number">19</span>, <span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;java&#39;</span>, <span class="token string">&#39;python&#39;</span>, <span class="token string">&#39;sql&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db.doc_demo.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰blog&#39;</span>, <span class="token string">&#39;age&#39;</span><span class="token builtin class-name">:</span> <span class="token number">20</span>, <span class="token string">&#39;skill&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;web&#39;</span>, <span class="token string">&#39;shell&#39;</span>, <span class="token string">&#39;js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>下面给出几个更新的实例</p><p><strong>更新age</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 将name为&quot;一灰灰&quot;的文档age + 1</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span><span class="token string">&#39;一灰灰&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$inc</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;age&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 修改name</span>
db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span><span class="token string">&#39;一灰灰&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰Blog&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>更新所有age为20的文档，新增一个tag成员</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;age&#39;</span><span class="token builtin class-name">:</span> <span class="token number">20</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;tag&#39;</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>multi:true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+l+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>更新一个不存在的文档</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰&#39;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&#39;age&#39;</span><span class="token builtin class-name">:</span> <span class="token number">18</span>, <span class="token string">&#39;sex&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;man&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>upsert: true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+o+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2-save" tabindex="-1"><a class="header-anchor" href="#_2-save" aria-hidden="true">#</a> 2. save</h3><p>save最大的特点是覆盖，用新的文档完全覆盖旧的文档；而update，则是更新指定的field</p><p>语法如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.collection.save<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>,
   <span class="token punctuation">{</span>
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>举例如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.save<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;一灰灰&#39;</span>, <span class="token string">&#39;age&#39;</span><span class="token builtin class-name">:</span> <span class="token number">22</span>, <span class="token string">&#39;hobby&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;reading&#39;</span>, <span class="token string">&#39;walking&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+c+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>那么问题来了，<strong>怎样判定是新增一条记录，还是覆盖已经存在的记录呢？</strong></p><ul><li>有唯一键来判定</li><li>即：如果save的文档中，某个field有唯一性要求，那么当数据库中存在这个field文档文档时，执行覆盖操作；否则执行插入</li></ul><p>举例如下, 指定ObjectId</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>db.doc_demo.save<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5e7b5c2e0172dc950171c48a&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;一灰灰New&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">18</span>, <span class="token string">&quot;hobby&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;play game&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+u+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',28);function g(m,b){return n(),a("div",null,[d,t(" more "),k])}const _=s(r,[["render",g],["__file","10.MongoDb系列教程八-文档-Document-更新姿势.html.vue"]]);export{_ as default};
