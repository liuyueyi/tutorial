import{_ as p,V as t,W as l,X as o,Y as a,Z as s,$ as c,a1 as n,F as i}from"./framework-094145d2.js";const r={},u=a("p",null,"今天在往mysql表中新增一列timestamp时，希望设置默认值为0，结果发现居然提示失败，记录一下",-1),k=n('<h3 id="问题记录" tabindex="-1"><a class="header-anchor" href="#问题记录" aria-hidden="true">#</a> 问题记录</h3><p>测试的mysql版本为 <code>5.7.24</code></p><p>创建要给测试的表用来说明</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show create table demo<span class="token punctuation">\\</span>G\n*************************** <span class="token number">1</span>. row ***************************\n       Table: demo\nCreate Table: CREATE TABLE <span class="token variable"><span class="token variable">`</span>demo<span class="token variable">`</span></span> <span class="token punctuation">(</span>\n  <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span> bigint<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT,\n  <span class="token variable"><span class="token variable">`</span>age<span class="token variable">`</span></span> int<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">&#39;0&#39;</span>,\n  <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> varchar<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">&#39;&#39;</span>,\n  PRIMARY KEY <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span><span class="token punctuation">)</span>,\n  KEY <span class="token variable"><span class="token variable">`</span>UNI_AGE<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>age<span class="token variable">`</span></span><span class="token punctuation">)</span>,\n  KEY <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span> <span class="token assign-left variable">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token assign-left variable">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">9</span> DEFAULT <span class="token assign-left variable">CHARSET</span><span class="token operator">=</span>utf8mb4\n<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们希望在这个表里面，新增一列, 默认值为0（即对应的日期为<code>1970-01-01 00:00:00</code>）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> alter table demo <span class="token function">add</span> <span class="token function">column</span> test_time timestamp not null default <span class="token string">&#39;1970-01-01 00:00:00&#39;</span><span class="token punctuation">;</span>\nERROR <span class="token number">1067</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: Invalid default value <span class="token keyword">for</span> <span class="token string">&#39;test_time&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>直接提示默认值非法，why?</p>',7),d={href:"https://dev.mysql.com/doc/refman/5.7/en/datetime.html",target:"_blank",rel:"noopener noreferrer"},v=n('<blockquote><p>The TIMESTAMP data type is used for values that contain both date and time parts. TIMESTAMP has a range of &#39;1970-01-01 00:00:01&#39; UTC to &#39;2038-01-19 03:14:07&#39; UTC.</p></blockquote><p>默认值有限制，要求必须是<code>&gt;=1970-01-01 00:00:01</code> 且 <code>&lt;=2038-01-19 03:14:07</code></p><p>然后我们再测试一下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> alter table demo <span class="token function">add</span> <span class="token function">column</span> test_time timestamp not null default <span class="token string">&#39;1970-01-01 00:00:01&#39;</span><span class="token punctuation">;</span>\nERROR <span class="token number">1067</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: Invalid default value <span class="token keyword">for</span> <span class="token string">&#39;test_time&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>依然是失败!!! why？</p><p><strong>注意上面说的时间是utc日期，而我们大中华是utc8</strong></p><p>所以我们需要把时间设置为<code>8:00:01</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> alter table demo <span class="token function">add</span> <span class="token function">column</span> test_time timestamp not null default <span class="token string">&#39;1970-01-01 08:00:01&#39;</span><span class="token punctuation">;</span>\nQuery OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.18</span> sec<span class="token punctuation">)</span>\nRecords: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  Warnings: <span class="token number">0</span>\n\nmysql<span class="token operator">&gt;</span> show create table demo<span class="token punctuation">\\</span>G\n*************************** <span class="token number">1</span>. row ***************************\n       Table: demo\nCreate Table: CREATE TABLE <span class="token variable"><span class="token variable">`</span>demo<span class="token variable">`</span></span> <span class="token punctuation">(</span>\n  <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span> bigint<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT,\n  <span class="token variable"><span class="token variable">`</span>age<span class="token variable">`</span></span> int<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">&#39;0&#39;</span>,\n  <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> varchar<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">&#39;&#39;</span>,\n  <span class="token variable"><span class="token variable">`</span>test_time<span class="token variable">`</span></span> timestamp NOT NULL DEFAULT <span class="token string">&#39;1970-01-01 08:00:01&#39;</span>,\n  PRIMARY KEY <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span><span class="token punctuation">)</span>,\n  KEY <span class="token variable"><span class="token variable">`</span>UNI_AGE<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>age<span class="token variable">`</span></span><span class="token punctuation">)</span>,\n  KEY <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span> <span class="token assign-left variable">ENGINE</span><span class="token operator">=</span>InnoDB <span class="token assign-left variable">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">9</span> DEFAULT <span class="token assign-left variable">CHARSET</span><span class="token operator">=</span>utf8mb4\n<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',8);function b(m,g){const e=i("ExternalLinkIcon");return t(),l("div",null,[u,o(" more "),k,a("p",null,[s("官方说明： "),a("a",d,[s("https://dev.mysql.com/doc/refman/5.7/en/datetime.html"),c(e)])]),v])}const _=p(r,[["render",b],["__file","13.190906-MySql-Timestamp默认值限制问题.html.vue"]]);export{_ as default};
