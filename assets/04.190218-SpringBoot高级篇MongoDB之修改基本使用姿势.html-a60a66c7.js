import{_ as t,V as p,W as o,X as c,Y as n,Z as a,$ as e,a1 as i,F as u}from"./framework-094145d2.js";const l={},d=n("p",null,"本篇依然是MongoDB curd中的一篇，主要介绍document的更新，主要内容如下",-1),r=n("ul",null,[n("li",null,"常见类型成员的修改"),n("li",null,"数组类型成员的增删改"),n("li",null,"document类型成员的增删改")],-1),k=n("h2",{id:"i-基本使用",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#i-基本使用","aria-hidden":"true"},"#"),a(" I. 基本使用")],-1),v=n("p",null,"首先是准备好基本环境，可以参考博文",-1),m={href:"http://spring.hhui.top/spring-blog/2018/12/13/181213-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87MongoDB%E4%B9%8B%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8/",target:"_blank",rel:"noopener noreferrer"},b={href:"http://spring.hhui.top/spring-blog/2019/01/13/190113-SpringBoot%E9%AB%98%E7%BA%A7%E7%AF%87MongoDB%E4%B9%8B%E6%9F%A5%E8%AF%A2%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/",target:"_blank",rel:"noopener noreferrer"},g=i(`<p>在开始之前，先封装一个输出方法，用于打印修改后的record对象</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">queryAndPrint</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">,</span> <span class="token class-name">String</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------- after &quot;</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">&quot; age -------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> record <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;query records: &quot;</span> <span class="token operator">+</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------------  end &quot;</span> <span class="token operator">+</span> tag <span class="token operator">+</span> <span class="token string">&quot; age --------------\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-基本类型修改" tabindex="-1"><a class="header-anchor" href="#_1-基本类型修改" aria-hidden="true">#</a> 1. 基本类型修改</h3><p>mongodb支持我们常见的各种基本类型，而MongoTemplate也封装了不少对应的修改方法，最基础的修改，主要是借助<code>Update</code>来实现</p><p>常见的使用姿势如:</p><h4 id="a-基本使用姿势" tabindex="-1"><a class="header-anchor" href="#a-基本使用姿势" aria-hidden="true">#</a> a. 基本使用姿势</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">basicUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
     * \uFEFF{
     *     &quot;_id&quot; : ObjectId(&quot;5c49b07ce6652f7e1add1ea2&quot;),
     *     &quot;age&quot; : 100,
     *     &quot;name&quot; : &quot;一灰灰blog&quot;,
     *     &quot;desc&quot; : &quot;Java Developer&quot;,
     *     &quot;add&quot; : [
     *         &quot;额外增加&quot;
     *     ],
     *     &quot;date&quot; : ISODate(&quot;2019-01-28T08:00:08.373Z&quot;),
     *     &quot;doc&quot; : {
     *         &quot;key&quot; : &quot;小目标&quot;,
     *         &quot;value&quot; : &quot;升职加薪，迎娶白富美&quot;
     *     }
     * }
     */</span>

    <span class="token comment">// 1. 直接修改值的内容</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;5c49b07ce6652f7e1add1ea2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Java &amp; Python Developer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果为：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>------------- after <span class="token builtin class-name">set</span> age -------------
query records: <span class="token punctuation">{</span>_id<span class="token operator">=</span>5c49b07ce6652f7e1add1ea2, <span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token number">100</span>, <span class="token assign-left variable">name</span><span class="token operator">=</span>一灰灰blog, <span class="token assign-left variable">desc</span><span class="token operator">=</span>Java <span class="token operator">&amp;</span> Python Developer, <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token punctuation">[</span>额外增加<span class="token punctuation">]</span>, <span class="token assign-left variable">date</span><span class="token operator">=</span>Mon Jan <span class="token number">28</span> <span class="token number">16</span>:00:08 CST <span class="token number">2019</span>, <span class="token assign-left variable">doc</span><span class="token operator">=</span><span class="token punctuation">{</span>key<span class="token operator">=</span>小目标, <span class="token assign-left variable">value</span><span class="token operator">=</span>升职加薪，迎娶白富美<span class="token punctuation">}</span><span class="token punctuation">}</span>
-------------  end <span class="token builtin class-name">set</span> age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="b-数字增加-减少" tabindex="-1"><a class="header-anchor" href="#b-数字增加-减少" aria-hidden="true">#</a> b. 数字增加/减少</h4><p>数字类型修改，使用 <code>org.springframework.data.mongodb.core.query.Update#inc</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 数字修改，实现添加or减少</span>
<span class="token class-name">Update</span> numUp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">20L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> numUp<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;inc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果为:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after inc age -------------
query records: {_id=5c49b07ce6652f7e1add1ea2, age=120, name=一灰灰blog, desc=Java &amp; Python Developer, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}}
-------------  end inc age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="c-数字比较修改" tabindex="-1"><a class="header-anchor" href="#c-数字比较修改" aria-hidden="true">#</a> c. 数字比较修改</h4><p>数字简单比较之后修改，如<code>org.springframework.data.mongodb.core.query.Update#max</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 数字比较修改</span>
<span class="token class-name">Update</span> cmpUp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> cmpUp<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;cmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after cmp age -------------
query records: {_id=5c49b07ce6652f7e1add1ea2, age=120, name=一灰灰blog, desc=Java &amp; Python Developer, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}}
-------------  end cmp age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="d-乘法" tabindex="-1"><a class="header-anchor" href="#d-乘法" aria-hidden="true">#</a> d. 乘法</h4><p>乘法运算, 主要使用 <code>org.springframework.data.mongodb.core.query.Update#multiply</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 乘法</span>
<span class="token class-name">Update</span> mulUp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> mulUp<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;multiply&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after multiply age -------------
query records: {_id=5c49b07ce6652f7e1add1ea2, age=360.0, name=一灰灰blog, desc=Java &amp; Python Developer, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}}
-------------  end multiply age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="e-日期修改" tabindex="-1"><a class="header-anchor" href="#e-日期修改" aria-hidden="true">#</a> e. 日期修改</h4><p>日期修改, 如 <code>org.springframework.data.mongodb.core.query.Update#currentDate</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 日期修改
Update dateUp = new Update().currentDate(&quot;date&quot;);
mongoTemplate.updateFirst(query, dateUp, COLLECTION_NAME);
queryAndPrint(query, &quot;date&quot;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after date age -------------
query records: {_id=5c49b07ce6652f7e1add1ea2, age=360.0, name=一灰灰blog, desc=Java &amp; Python Developer, add=[额外增加], date=Mon Feb 18 19:34:56 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}}
-------------  end date age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-field修改" tabindex="-1"><a class="header-anchor" href="#_2-field修改" aria-hidden="true">#</a> 2. field修改</h3><p>不同于mysql的列表是固定的,mongodb的field可以增加、删除和重命名，下面分别看下三种case如何使用</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 修改字段名，新增字段，删除字段
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fieldUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \uFEFF<span class="token punctuation">{</span>
     *     &quot;_id&quot; : ObjectId(&quot;5c6a7ada10ffc647d301dd62&quot;),
     *     &quot;age&quot; : 28.0,
     *     &quot;name&quot; : &quot;一灰灰blog&quot;,
     *     &quot;desc&quot; : &quot;Java Developer&quot;,
     *     &quot;add&quot; : [
     *         &quot;额外增加&quot;
     *     ],
     *     &quot;date&quot; : ISODate(&quot;2019-01-28T08:00:08.373Z&quot;),
     *     &quot;doc&quot; : <span class="token punctuation">{</span>
     *         &quot;key&quot; : &quot;小目标&quot;,
     *         &quot;value&quot; : &quot;升职加薪，迎娶白富美&quot;
     *     <span class="token punctuation">}</span>
     * <span class="token punctuation">}</span>
     */</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;5c6a7ada10ffc647d301dd62&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">renameFiled</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">addField</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delField</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="a-重命名" tabindex="-1"><a class="header-anchor" href="#a-重命名" aria-hidden="true">#</a> a. 重命名</h4><p>利用<code>org.springframework.data.mongodb.core.query.Update#rename</code>来实现重命名，需要注意的是，当修改的docuemnt没有这个成员时，相当于没有任务操作</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">renameFiled</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;skill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;rename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果字段不存在，相当于没有更新</span>
    update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;s-skill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;rename Not exists!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果如下，后面一个语句相当于没有执行</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after rename age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end rename age --------------

------------- after rename Not exists! age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end rename Not exists! age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="b-新增成员" tabindex="-1"><a class="header-anchor" href="#b-新增成员" aria-hidden="true">#</a> b. 新增成员</h4><p>新增也是直接利用的<code>Update#set</code>方法，当存在时，修改；不存在时，添加</p><ul><li>另外提一下<code>setOnInsert</code>, 如果要更新的文档存在那么$setOnInsert操作符不做任何处理；</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addField</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新增一个字段</span>
    <span class="token comment">// 直接使用set即可</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;new-skill&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Python&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;addField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 当更新一个不存在的文档时，可以使用setOnInsert</span>
    <span class="token comment">// 如果要更新的文档存在那么$setOnInsert操作符不做任何处理；</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after addField age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer, new-skill=Python}
-------------  end addField age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="c-删除成员" tabindex="-1"><a class="header-anchor" href="#c-删除成员" aria-hidden="true">#</a> c. 删除成员</h4><p>删除document中的某个成员，借助<code>org.springframework.data.mongodb.core.query.Update#unset</code>， 正好与添加对上</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">delField</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除字段，如果不存在，则不操作</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unset</span><span class="token punctuation">(</span><span class="token string">&quot;new-skill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;delField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果如下</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after delField age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end delField age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-数组操作" tabindex="-1"><a class="header-anchor" href="#_3-数组操作" aria-hidden="true">#</a> 3. 数组操作</h3><p>在MongoDB的document中，有两个有意思的类型，一个是数组，一个是document（即可以嵌套），这里则主要介绍下如何操作数组中的成员</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 更新文档中字段为数组成员的值
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateInnerArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \uFEFF<span class="token punctuation">{</span>
     *     &quot;_id&quot; : ObjectId(&quot;5c6a7ada10ffc647d301dd62&quot;),
     *     &quot;age&quot; : 28.0,
     *     &quot;name&quot; : &quot;一灰灰blog&quot;,
     *     &quot;skill&quot; : &quot;Java Developer&quot;,
     *     &quot;add&quot; : [
     *         &quot;额外增加&quot;
     *     ],
     *     &quot;date&quot; : ISODate(&quot;2019-01-28T08:00:08.373Z&quot;),
     *     &quot;doc&quot; : <span class="token punctuation">{</span>
     *         &quot;key&quot; : &quot;小目标&quot;,
     *         &quot;value&quot; : &quot;升职加薪，迎娶白富美&quot;
     *     <span class="token punctuation">}</span>
     * <span class="token punctuation">}</span>
     */</span>
    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;5c6a7ada10ffc647d301dd62&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addData2Array</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">batchAddData2Array</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delArrayData</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateArrayData</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="a-添加到数组中" tabindex="-1"><a class="header-anchor" href="#a-添加到数组中" aria-hidden="true">#</a> a. 添加到数组中</h4><p>在数组中新增一个数据，提供了两种方式，一个是<code>org.springframework.data.mongodb.core.query.Update#addToSet(java.lang.String, java.lang.Object)</code>，一个是<code>org.springframework.data.mongodb.core.query.Update#push(java.lang.String, java.lang.Object)</code>；两个的区别在于前者不能插入重复数据，后者可以</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addData2Array</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新加一个元素到数组，如果已经存在，则不会加入</span>
    <span class="token class-name">String</span> insert <span class="token operator">=</span> <span class="token string">&quot;新添加&gt;&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addToSet</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;add2List&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// push 新增元素，允许出现重复的数据</span>
    update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;push2List&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after add2List age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加, 新添加&gt;&gt;1550489696892], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end add2List age --------------

------------- after push2List age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加, 新添加&gt;&gt;1550489696892, 10], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end push2List age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="b-批量添加" tabindex="-1"><a class="header-anchor" href="#b-批量添加" aria-hidden="true">#</a> b. 批量添加</h4><p>一次添加多个，借助<code>addToSet</code>的<code>each</code>来实现</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">batchAddData2Array</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 批量插入数据到数组中, 注意不会将重复的数据丢入mongo数组中</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addToSet</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;batchAdd2List&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after batchAdd2List age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加, 新添加&gt;&gt;1550489696892, 10, 2, 3], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end batchAdd2List age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="c-删除" tabindex="-1"><a class="header-anchor" href="#c-删除" aria-hidden="true">#</a> c. 删除</h4><p>借助pull来精确删除某个值</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">delArrayData</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除数组中元素</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;delArrayData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下，注意对比，<code>2</code>没有了</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after delArrayData age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加, 新添加&gt;&gt;1550489696892, 10, 3], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end delArrayData age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="d-修改" tabindex="-1"><a class="header-anchor" href="#d-修改" aria-hidden="true">#</a> d. 修改</h4><p>修改，首先的问题是要定位，确定删除数组中某个下标的元素，这里借助了一个有意思的站位</p><ul><li>定位删除的数组元素方法： <code>arrayKey.index</code><ul><li><code>arrayKey</code> 是数组在docment中的名</li><li><code>index</code> 表示要删除的索引</li></ul></li></ul><p>一个实例如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateArrayData</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用set，field.index 来更新数组中的值</span>
    <span class="token comment">// 更新数组中的元素，如果元素存在，则直接更新；如果数组个数小于待更新的索引位置，则前面补null</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;add.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;updateField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;updateListData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;add.10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nullBefore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;updateListData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果，注意后面的，如果数组个数小于待更新的索引位置，则前面补null</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after updateListData age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加, updateField, 10, 3], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end updateListData age --------------

------------- after updateListData age -------------
query records: {_id=5c6a7ada10ffc647d301dd62, age=28.0, name=一灰灰blog, add=[额外增加, updateField, 10, 3, null, null, null, null, null, null, nullBefore], date=Mon Jan 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end updateListData age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-document操作" tabindex="-1"><a class="header-anchor" href="#_4-document操作" aria-hidden="true">#</a> 4. document操作</h3><p>内嵌文档，可以所是MongoDB的一个特色了，我们则来看下如何进行操作</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 更新文档中字段为document类型的值
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateInnerDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \uFEFF<span class="token punctuation">{</span>
     *     &quot;_id&quot; : ObjectId(&quot;5c6a956b10ffc647d301dd63&quot;),
     *     &quot;age&quot; : 18.0,
     *     &quot;name&quot; : &quot;一灰灰blog&quot;,
     *     &quot;date&quot; : ISODate(&quot;2019-02-28T08:00:08.373Z&quot;),
     *     &quot;doc&quot; : <span class="token punctuation">{</span>
     *         &quot;key&quot; : &quot;小目标&quot;,
     *         &quot;value&quot; : &quot;升职加薪，迎娶白富美&quot;
     *     <span class="token punctuation">}</span>,
     *     &quot;skill&quot; : &quot;Java Developer&quot;
     * <span class="token punctuation">}</span>
     */</span>

    <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;5c6a956b10ffc647d301dd63&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addFieldToDoc</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateFieldOfDoc</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">delFieldOfDoc</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="a-添加" tabindex="-1"><a class="header-anchor" href="#a-添加" aria-hidden="true">#</a> a. 添加</h4><p>借助前面的站位思想，就很好实现了，定位元素的方式采用</p><ul><li>docName.fieldName <ul><li>docName 为内嵌文档在docunent中的fieldName</li><li>fieldName 为内嵌文档内部需要修改的fieldName</li></ul></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addFieldToDoc</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 内嵌doc新增field</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;doc.title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;好好学习，天天向上!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;addFieldToDoc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after addFieldToDoc age -------------
query records: {_id=5c6a956b10ffc647d301dd63, age=18.0, name=一灰灰blog, date=Thu Feb 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美, title=好好学习，天天向上!}, skill=Java Developer}
-------------  end addFieldToDoc age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="c-修改" tabindex="-1"><a class="header-anchor" href="#c-修改" aria-hidden="true">#</a> c. 修改</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateFieldOfDoc</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 内嵌doc修改field</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;doc.title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;新的标题：一灰灰Blog!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;updateFieldOfDoc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after updateFieldOfDoc age -------------
query records: {_id=5c6a956b10ffc647d301dd63, age=18.0, name=一灰灰blog, date=Thu Feb 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美, title=新的标题：一灰灰Blog!}, skill=Java Developer}
-------------  end updateFieldOfDoc age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="d-删除" tabindex="-1"><a class="header-anchor" href="#d-删除" aria-hidden="true">#</a> d. 删除</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">delFieldOfDoc</span><span class="token punctuation">(</span><span class="token class-name">Query</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除内嵌doc中的field</span>
    <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unset</span><span class="token punctuation">(</span><span class="token string">&quot;doc.title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">queryAndPrint</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">&quot;delFieldOfDoc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------- after delFieldOfDoc age -------------
query records: {_id=5c6a956b10ffc647d301dd63, age=18.0, name=一灰灰blog, date=Thu Feb 28 16:00:08 CST 2019, doc={key=小目标, value=升职加薪，迎娶白富美}, skill=Java Developer}
-------------  end delFieldOfDoc age --------------
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ii-其他" tabindex="-1"><a class="header-anchor" href="#ii-其他" aria-hidden="true">#</a> II. 其他</h2><h3 id="_0-项目" tabindex="-1"><a class="header-anchor" href="#_0-项目" aria-hidden="true">#</a> 0. 项目</h3>`,92),q={href:"https://github.com/liuyueyi/spring-boot-demo",target:"_blank",rel:"noopener noreferrer"},y={href:"https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/111-mongo-template/README.md",target:"_blank",rel:"noopener noreferrer"};function f(h,x){const s=u("ExternalLinkIcon");return p(),o("div",null,[d,r,c(" more "),k,v,n("ul",null,[n("li",null,[n("a",m,[a("181213-SpringBoot高级篇MongoDB之基本环境搭建与使用"),e(s)])]),n("li",null,[n("a",b,[a("190113-SpringBoot高级篇MongoDB之查询基本使用姿势"),e(s)])])]),g,n("ul",null,[n("li",null,[a("工程："),n("a",q,[a("spring-boot-demo"),e(s)])]),n("li",null,[a("子module："),n("a",y,[a("111-mongo-template"),e(s)])])])])}const w=t(l,[["render",f],["__file","04.190218-SpringBoot高级篇MongoDB之修改基本使用姿势.html.vue"]]);export{w as default};
