---
order: 18
title: ç¬¬ 12 ç« ï¼šRAG â€”â€” å½“æ¨¡å‹â€œä¸çŸ¥é“â€æ—¶ï¼Œç³»ç»Ÿè¯¥å¦‚ä½•è¡¥å¿ï¼Ÿ
tag:
  - LLM
category:
  - LLM
date: 2025-12-30 16:22:07
keywords: LLMåº”ç”¨å¼€å‘
---

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»é€æ­¥è§£å†³äº†ï¼š

* å¦‚ä½•çº¦æŸæ¨¡å‹è¡Œä¸ºï¼ˆPromptï¼‰
* å¦‚ä½•ç®¡ç†å¯¹è¯ä¸ä¸Šä¸‹æ–‡ï¼ˆContext / Memoryï¼‰

ä½†åˆ°è¿™é‡Œï¼Œä¸€ä¸ªæ›´æ ¹æœ¬çš„é—®é¢˜å¼€å§‹æµ®ç°ï¼š

> **å¦‚æœç”¨æˆ·çš„é—®é¢˜ï¼Œæœ¬èº«å°±è¶…å‡ºäº†æ¨¡å‹çš„çŸ¥è¯†è¾¹ç•Œï¼Œæˆ–è€…ä¼ä¸šç§æœ‰çŸ¥è¯†èŒƒå›´ï¼Œç³»ç»Ÿè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ**

è¿™å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ° RAGï¼ˆRetrieval-Augmented Generationï¼‰å­˜åœ¨çš„åŸå› ã€‚

---

## 12.1 å…ˆåˆ«æ€¥ç€å®ç°ï¼šä»€ä¹ˆæ˜¯ RAG

åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œå·²ç»ä»å·¥ç¨‹çš„è§†è§’ä»‹ç»äº†RAG: `åŠ¨æ€æ„é€ ä¸€ä¸ªâ€œæœ€å°ä¸”ç›¸å…³çš„çŸ¥è¯†ä¸Šä¸‹æ–‡â€`

æˆ‘ä»¬å¯¹é½è¿›è¡Œå±•å¼€

> **RAG æ˜¯ä¸€ç§ï¼š
> åœ¨æ¨¡å‹ç”Ÿæˆä¹‹å‰ï¼Œ
> é€šè¿‡å¤–éƒ¨æ£€ç´¢æœºåˆ¶ï¼Œ
> ä¸ºæ¨¡å‹â€œä¸´æ—¶è¡¥å……å…¶æœ¬ä¸å…·å¤‡çš„çŸ¥è¯†â€çš„ç³»ç»Ÿæ¶æ„ã€‚**

æ³¨æ„å‡ ä¸ªå…³é”®è¯ï¼š

* **ç”Ÿæˆä¹‹å‰**
* **å¤–éƒ¨**
* **ä¸´æ—¶**
* **è¡¥å……**

è¿™æ„å‘³ç€ï¼š

* çŸ¥è¯†ä¸è¿›å…¥æ¨¡å‹å‚æ•°
* ä¸ä¾èµ–æ¨¡å‹â€œè®°ä½â€
* ä¸æ±¡æŸ“é•¿æœŸä¸Šä¸‹æ–‡

---

## 12.2 RAG è§£å†³çš„ï¼Œå…¶å®æ˜¯â€œçŸ¥è¯†æ—¶æ•ˆä¸è¾¹ç•Œé—®é¢˜â€

ä¸ºä»€ä¹ˆåªé æ¨¡å‹æœ¬èº«ä¸€å®šä¸å¤Ÿï¼Ÿ

åœ¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­ï¼Œå…¸å‹é—®é¢˜åŒ…æ‹¬ï¼š

* ä¼ä¸šåˆ¶åº¦é¢‘ç¹å˜åŒ–
* å†…éƒ¨æµç¨‹ä¸å¯¹å¤–å…¬å¼€
* æ–‡æ¡£ä½“é‡è¿œè¶…ä¸Šä¸‹æ–‡çª—å£
* æ³•è§„ / åˆåŒ / SOP æœ‰æ˜ç¡®ç‰ˆæœ¬è¾¹ç•Œ

è¿™äº›é—®é¢˜æœ‰ä¸€ä¸ªå…±åŒç‰¹å¾ï¼š

> **å®ƒä»¬ä¸æ˜¯â€œæ¨¡å‹ä¸èªæ˜â€ï¼Œè€Œæ˜¯â€œæ¨¡å‹ä¸å¯èƒ½çŸ¥é“â€ã€‚**

RAG çš„æ ¸å¿ƒä»·å€¼å°±åœ¨äºï¼š

> **æŠŠâ€œçŸ¥é“ä»€ä¹ˆâ€è¿™ä¸ªé—®é¢˜ï¼Œä»æ¨¡å‹èƒ½åŠ›ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œäº¤ç»™ç³»ç»Ÿè§£å†³ã€‚**

---

## 12.3 ä»ç³»ç»Ÿè§’åº¦çœ‹ï¼šRAG åœ¨æ•´ä½“æ¶æ„ä¸­çš„ä½ç½®


```mermaid
graph TD
    %% æ ·å¼å®šä¹‰ï¼šæŒ‰åŠŸèƒ½åˆ†ç±»ï¼Œå»¶ç»­ç³»åˆ—é…è‰²
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px
    classDef logicNode fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,rounded:10px
    classDef judgeNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px,diamond:true,rounded:5px
    classDef coreNode fill:#fce4ec,stroke:#c2185b,stroke-width:3px,rounded:10px,font-weight:bold
    classDef outputNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px
    classDef noteNode fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,rounded:8px

    %% æ ¸å¿ƒæµç¨‹ï¼šè¾“å…¥ â†’ æ„å›¾åˆ¤æ–­ â†’ è·¯ç”±é€‰æ‹©
    A[ç”¨æˆ·é—®é¢˜<br/>User Query]:::inputNode --> B[æ„å›¾ç†è§£ / ä»»åŠ¡åˆ¤æ–­<br/>Intent Recognition / Task Judgment<br/>ï¼ˆè¯†åˆ«éœ€æ±‚ç±»å‹ï¼šäº‹å®/åˆ›æ„/å·¥å…·è°ƒç”¨ï¼‰]:::logicNode
    
    %% åˆ†æ”¯åˆ¤æ–­ï¼šæ˜¯å¦éœ€è¦å¤–éƒ¨çŸ¥è¯†
    B --> C{æ˜¯å¦éœ€è¦å¤–éƒ¨çŸ¥è¯†?<br/>Need External Knowledge?}:::judgeNode
    
    %% è·¯å¾„1ï¼šæ— éœ€å¤–éƒ¨çŸ¥è¯† â†’ ç›´æ¥ç”Ÿæˆ
    C -->|âŒ å¦ï¼ˆå†…ç½®çŸ¥è¯†è¶³å¤Ÿï¼‰| D[ç›´æ¥ç”Ÿæˆ<br/>Direct Generation<br/>ï¼ˆåŸºäº LLM å†…ç½®çŸ¥è¯†åº“ï¼‰]:::outputNode
    
    %% è·¯å¾„2ï¼šéœ€è¦å¤–éƒ¨çŸ¥è¯† â†’ æ£€ç´¢+æ„å»º+ç”Ÿæˆ
    C -->|âœ… æ˜¯ï¼ˆéœ€è¡¥å……ä¿¡æ¯ï¼‰| E[æ£€ç´¢æ¨¡å—<br/>Retrieval Module<br/>ï¼ˆçŸ¥è¯†åº“æŸ¥è¯¢/å·¥å…·è°ƒç”¨ï¼‰]:::coreNode
    E --> F[ä¸Šä¸‹æ–‡æ„å»º<br/>Context Construction<br/>ï¼ˆæ•´åˆæ£€ç´¢ç»“æœ+å¯¹è¯å†å²ï¼‰]:::logicNode
    F --> G[LLM ç”Ÿæˆ<br/>LLM Generation<br/>ï¼ˆèåˆå¤–éƒ¨çŸ¥è¯†è¾“å‡ºï¼‰]:::outputNode

    %% æ ¸å¿ƒæ³¨è§£ï¼šç‚¹æ˜è·¯ç”±ä»·å€¼
    note[ğŸ“Œ æ ¸å¿ƒé€»è¾‘ï¼šæ™ºèƒ½è·¯ç”±ä¼˜åŒ–æ•ˆç‡ï¼Œå†…ç½®çŸ¥è¯†åœºæ™¯ç›´æ¥å“åº”ï¼Œéœ€å¤–éƒ¨ä¿¡æ¯æ—¶è§¦å‘æ£€ç´¢]:::noteNode
    B -.-> note

    %% ç®­å¤´æ ·å¼ï¼šå¼ºåŒ–è·¯å¾„åŒºåˆ†
    linkStyle 0 stroke:#616161,stroke-width:1.5px
    linkStyle 1 stroke:#f57c00,stroke-width:1.5px
    linkStyle 2 stroke:#388e3c,stroke-width:1.5px
    linkStyle 3 stroke:#c2185b,stroke-width:1.5px
    linkStyle 4 stroke:#9c27b0,stroke-width:1.5px
    linkStyle 5 stroke:#c2185b,stroke-width:1.5px
```

![](/imgs/column/llm/18-1.webp)

ä»è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ï¼š

* RAG ä¸æ˜¯â€œæ€»ä¼šå‘ç”Ÿâ€
* å®ƒæ˜¯ä¸€ä¸ª**æ¡ä»¶è§¦å‘çš„ç³»ç»Ÿèƒ½åŠ›**
* å¹¶ä¸”å‘ç”Ÿåœ¨ï¼š

  > **ä¸Šä¸‹æ–‡æ„å»ºé˜¶æ®µï¼Œè€Œä¸æ˜¯ Prompt é˜¶æ®µ**

---

## 12.4 ä¸€ä¸ªå¸¸è§è¯¯åŒºï¼šRAG â‰  ä¸‡èƒ½å¢å¼ºå™¨

åœ¨å¼•å…¥ RAG åï¼Œå¾ˆå¤šå›¢é˜Ÿä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯é¢„æœŸï¼š

> *â€œåªè¦æ¥äº† RAGï¼Œæ¨¡å‹å°±ä¸ä¼šèƒ¡è¯´äº†ã€‚â€*

ç°å®å¾€å¾€ç›¸åï¼š

* æ£€ç´¢ç»“æœä¸ç›¸å…³
* æ¨¡å‹æ›²è§£æ–‡æ¡£
* å›ç­”çœ‹ä¼¼â€œæœ‰ä¾æ®â€ï¼Œä½†å…¶å®é”™è¯¯

è¿™å¼•å‡ºä¸€ä¸ªéå¸¸é‡è¦çš„äº‹å®ï¼š

> **RAG çš„å¤±è´¥ï¼Œå¤§å¤šæ•°å¹¶ä¸æ˜¯å‘ç”Ÿåœ¨â€œç”Ÿæˆé˜¶æ®µâ€ï¼Œè€Œæ˜¯å‘ç”Ÿåœ¨â€œæ£€ç´¢ä¹‹å‰â€ã€‚**


ä¸€æ—¦ä½ çœŸæ­£ç†è§£äº† RAG çš„ç³»ç»Ÿå®šä½ï¼Œä¸‹ä¸€ä¸ªã€ä¹Ÿæ˜¯æ›´æ®‹é…·çš„é—®é¢˜å°±ä¼šå‡ºç°ï¼š

> **ä¸ºä»€ä¹ˆæˆ‘å·²ç»â€œæ¥äº† RAGâ€ï¼Œæ•ˆæœè¿˜æ˜¯ä¸å¥½ï¼Ÿ**

å¾ˆå¤šå¤±è´¥çš„ RAG é¡¹ç›®ï¼Œä¼šæŠŠé—®é¢˜å½’å› äºï¼š

* å‘é‡æ¨¡å‹ä¸å¤Ÿå¥½
* å¤§æ¨¡å‹ä¸å¤Ÿèªæ˜

ä½†åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒçœŸæ­£çš„ç“¶é¢ˆå‡ºç°åœ¨ä¸€ä¸ª**æ›´æ—©ã€ä¹Ÿæ›´åŸºç¡€çš„åœ°æ–¹**ï¼š â€”â€” æ–‡æ¡£æ˜¯â€œå¦‚ä½•è¢«æ‹†è§£ä¸è¡¨è¾¾çš„â€ ã€‚ 

å°±åƒç”¨æ¸”ç½‘æ•é±¼ï¼šå¦‚æœç½‘çœ¼å¤ªå¤§ï¼Œå°é±¼ä¼šæ¼èµ°ï¼›å¦‚æœç½‘çœ¼å¤ªå°ï¼Œä¼šè¢«æ°´è‰ç¼ ä½ã€‚æ¸”ç½‘çš„è®¾è®¡ï¼ˆå¯¹åº” Chunk è®¾è®¡ï¼‰ï¼Œæ¯” â€œç”¨ä»€ä¹ˆæè´¨åšæ¸”ç½‘â€ï¼ˆå¯¹åº”å‘é‡æ¨¡å‹ï¼‰æ›´é‡è¦ã€‚

---

## 12.5 æ–‡æ¡£ â†’ Chunk â†’ Embeddingï¼šæ£€ç´¢æ•ˆæœçš„çœŸæ­£ä¸Šé™

### 12.5.1 Chunk è®¾è®¡ï¼šè¢«ä¸¥é‡ä½ä¼°çš„å·¥ç¨‹å†³ç­–

Chunkï¼ˆæ–‡æ¡£ç‰‡æ®µï¼‰æ˜¯ RAG çš„ â€œåŸå­å•å…ƒâ€â€”â€” ç³»ç»Ÿæ£€ç´¢çš„æ˜¯ Chunkï¼Œæ³¨å…¥ä¸Šä¸‹æ–‡çš„ä¹Ÿæ˜¯ Chunkã€‚Chunk çš„å¤§å°ä¸åˆ‡åˆ†æ–¹å¼ï¼Œç›´æ¥å†³å®šäº†ï¼š

* èƒ½å¦è¢«æ£€ç´¢åˆ°ï¼šå¦‚æœ Chunk åŒ…å«çš„ä¿¡æ¯ä¸é—®é¢˜æ— å…³ï¼Œå†å…ˆè¿›çš„æ£€ç´¢å™¨ä¹Ÿæ‰¾ä¸åˆ°å®ƒï¼›
* è¢«æ£€ç´¢åˆ°åæ˜¯å¦ â€œåˆšå¥½æœ‰ç”¨â€ï¼šå¦‚æœ Chunk å¤ªå¤§ï¼ŒåŒ…å«å¤§é‡æ— å…³ä¿¡æ¯ï¼ˆå™ªå£°ï¼‰ï¼Œæ¨¡å‹ä¼šè¢«å¹²æ‰°ï¼›å¦‚æœå¤ªå°ï¼Œå…³é”®ä¿¡æ¯è¢«åˆ‡ç¢ï¼ˆæ¯”å¦‚ä¸€ä¸ªæµç¨‹çš„ â€œæ­¥éª¤ 1â€ å’Œ â€œæ­¥éª¤ 2â€ è¢«åˆ†åˆ°ä¸¤ä¸ª Chunkï¼‰ï¼Œæ¨¡å‹æ— æ³•ç†è§£å®Œæ•´é€»è¾‘ã€‚

åœ¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­ï¼ŒChunk è®¾è®¡çš„å¸¸è§é—®é¢˜ï¼š

* Chunk å¤ªå¤§ï¼š
  * å…¸å‹åœºæ™¯ï¼šç›´æ¥æŠŠæ•´ç¯‡æ–‡æ¡£ä½œä¸ºä¸€ä¸ª Chunkï¼ˆæ¯”å¦‚ä¸€ä»½ 10 é¡µçš„äº§å“æ‰‹å†Œï¼‰ã€‚
  * é—®é¢˜ï¼šæ£€ç´¢æ—¶å®¹æ˜“ â€œè¯¯ä¸­â€â€”â€” æ¯”å¦‚æ–‡æ¡£é‡Œåªæœ‰ 1 æ®µè®² â€œå®šä»·â€ï¼Œä½†å› ä¸ºæ•´ä¸ªæ–‡æ¡£è¢«æ£€ç´¢åˆ°ï¼Œæ¨¡å‹éœ€è¦ä» 5000 å­—ä¸­æ‰¾ç­”æ¡ˆï¼Œå¾ˆå®¹æ˜“è¢«å…¶ä»–å†…å®¹å¹²æ‰°

* Chunk å¤ªå°ï¼š
  * å…¸å‹åœºæ™¯ï¼šæŒ‰å›ºå®šå­—æ•°å¼ºåˆ¶æ‹†åˆ†ï¼ˆæ¯”å¦‚æ¯ 100 å­—åˆ‡ä¸€æ®µï¼‰ã€‚
  * é—®é¢˜ï¼šè¯­ä¹‰è¢«åˆ‡ç¢ â€”â€” æ¯”å¦‚ â€œå®¡æ‰¹æµç¨‹éœ€è¦éƒ¨é—¨ç»ç†ç­¾å­—åæäº¤ç»™ HRâ€ï¼Œå¦‚æœè¢«æ‹†æˆ â€œå®¡æ‰¹æµç¨‹éœ€è¦éƒ¨é—¨ç»ç†ç­¾å­—â€ å’Œ â€œåæäº¤ç»™ HRâ€ ä¸¤ä¸ª Chunkï¼Œå•ç‹¬æ£€ç´¢åˆ°ä»»ä½•ä¸€ä¸ªéƒ½æ— æ³•ç†è§£å®Œæ•´æµç¨‹ã€‚

> **Chunk è®¾è®¡ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨åšä¿¡æ¯å¯†åº¦çš„æƒè¡¡ï¼šæ—¢è¦è®©æ¯ä¸ª Chunk åŒ…å« â€œè¶³å¤Ÿå®Œæ•´çš„è¯­ä¹‰â€ï¼Œåˆè¦é¿å… â€œåŒ…å«è¿‡å¤šæ— å…³ä¿¡æ¯â€ã€‚**

---

### 12.5.2 ä¸€ä¸ªå·¥ç¨‹åŒ–çš„ Chunk å†³ç­–æ€è·¯

ä½ å¯ä»¥ä»è¿™æ ·çš„é—®é¢˜å¼€å§‹æ€è€ƒï¼š

* ç”¨æˆ·çš„é—®é¢˜ï¼Œé€šå¸¸å¯¹åº”æ–‡æ¡£çš„å“ªä¸€å±‚ï¼Ÿæ˜¯æ®µè½çº§ï¼Ÿç« èŠ‚çº§ï¼Ÿè¿˜æ˜¯æµç¨‹çº§ï¼Ÿ
* æ–‡æ¡£æœ¬èº«çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦æœ‰å¤©ç„¶çš„è¯­ä¹‰è¾¹ç•Œï¼ˆæ¯”å¦‚æ ‡é¢˜ã€åˆ—è¡¨ã€è¡¨æ ¼ï¼‰ï¼Ÿ

Chunk åº”è¯¥å°½é‡ä¸ **â€œè¢«æé—®çš„æœ€å°è¯­ä¹‰å•å…ƒâ€** å¯¹é½ã€‚ä¸¾å‡ ä¸ªä¼ä¸šåœºæ™¯çš„ä¾‹å­ï¼š

- åœºæ™¯ 1ï¼šFAQ æ–‡æ¡£ï¼ˆæ¯”å¦‚ â€œIT æ”¯æŒå¸¸è§é—®é¢˜â€ï¼‰
  - ç‰¹ç‚¹ï¼šæ¯ä¸ªé—®é¢˜å¯¹åº”ä¸€ä¸ªç‹¬ç«‹ç­”æ¡ˆï¼ˆæ¯”å¦‚ â€œå¦‚ä½•é‡ç½®å¯†ç ï¼Ÿâ€â†’ æ­¥éª¤ 1-3ï¼‰ã€‚
  - æœ€ä¼˜ Chunkï¼šæŒ‰ â€œé—®é¢˜ + ç­”æ¡ˆâ€ æˆå¯¹åˆ‡åˆ†ï¼ˆæ¯ä¸ª Chunk åŒ…å«ä¸€ä¸ªå®Œæ•´çš„é—®ç­”ï¼‰ã€‚
  - ç†ç”±ï¼šç”¨æˆ·çš„é—®é¢˜å¾€å¾€ç›´æ¥åŒ¹é… FAQ ä¸­çš„é—®é¢˜ï¼Œç²¾å‡†åˆ‡åˆ†èƒ½ç¡®ä¿æ£€ç´¢åˆ°çš„ Chunk åˆšå¥½åŒ…å«ç­”æ¡ˆã€‚

- åœºæ™¯ 2ï¼šäº§å“æ‰‹å†Œï¼ˆæ¯”å¦‚ â€œCRM ç³»ç»Ÿæ“ä½œæŒ‡å—â€ï¼‰
  - ç‰¹ç‚¹ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†ç« èŠ‚ï¼ˆæ¯”å¦‚ â€œå®¢æˆ·ç®¡ç†â€â†’â€œæ–°å¢å®¢æˆ·â€â†’â€œå­—æ®µè¯´æ˜â€ï¼‰ã€‚
  - æœ€ä¼˜ Chunkï¼šæŒ‰ â€œåŠŸèƒ½å­æ¨¡å—â€ åˆ‡åˆ†ï¼ˆæ¯”å¦‚ â€œæ–°å¢å®¢æˆ·çš„ 5 ä¸ªå¿…å¡«å­—æ®µâ€ ä½œä¸ºä¸€ä¸ª Chunkï¼‰ã€‚
  - ç†ç”±ï¼šç”¨æˆ·çš„é—®é¢˜å¤šæ˜¯ â€œå¦‚ä½•æ“ä½œ XX åŠŸèƒ½â€ï¼Œä¸å­æ¨¡å—çš„è¯­ä¹‰è¾¹ç•Œé«˜åº¦åŒ¹é…ã€‚

- åœºæ™¯ 3ï¼šä¼šè®®çºªè¦ï¼ˆæ¯”å¦‚ â€œQ3 é”€å”®ç­–ç•¥ä¼šè®°å½•â€ï¼‰
  - ç‰¹ç‚¹ï¼šåŒ…å«å¤šä¸ªè®¨è®ºç‚¹ï¼ˆæ¯”å¦‚ â€œç›®æ ‡è°ƒæ•´â€â€œèµ„æºåˆ†é…â€â€œé£é™©åº”å¯¹â€ï¼‰ã€‚
  - æœ€ä¼˜ Chunkï¼šæŒ‰ â€œè®¨è®ºä¸»é¢˜â€ åˆ‡åˆ†ï¼ˆæ¯ä¸ªä¸»é¢˜çš„è®¨è®ºè¿‡ç¨‹ + ç»“è®ºä½œä¸ºä¸€ä¸ª Chunkï¼‰ã€‚
  - ç†ç”±ï¼šç”¨æˆ·å¯èƒ½é—® â€œQ3 çš„é”€å”®ç›®æ ‡æ˜¯å¤šå°‘â€ï¼Œéœ€è¦å®šä½åˆ° â€œç›®æ ‡è°ƒæ•´â€ ä¸»é¢˜çš„ Chunkã€‚

æ­¤å¤–ï¼ŒChunk çš„å…ƒæ•°æ®ï¼ˆMetadataï¼‰ä¹Ÿå¾ˆé‡è¦ â€”â€” æ¯”å¦‚ç»™æ¯ä¸ª Chunk æ ‡è®° â€œæ–‡æ¡£ç±»å‹â€â€œæ›´æ–°æ—¶é—´â€â€œæ‰€å±éƒ¨é—¨â€ï¼Œèƒ½å¸®åŠ©æ£€ç´¢å™¨è¿›ä¸€æ­¥ç­›é€‰ï¼ˆæ¯”å¦‚ä¼˜å…ˆæ£€ç´¢ â€œ2024 å¹´æ›´æ–°â€ çš„æ–‡æ¡£ï¼‰ã€‚

---

## 12.6 RAGå·¥ç¨‹åŒ–å»ºè®¾


### 12.6.1 ä»â€œè°ƒç”¨ RAGâ€åˆ°â€œé›†æˆ RAGâ€ï¼šç³»ç»Ÿè§†è§’çš„è½¬å˜

å¾ˆå¤šæ•™ç¨‹é‡Œçš„ RAG çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```text
query â†’ embedding â†’ å‘é‡æ£€ç´¢ â†’ æ‹¼ prompt â†’ è°ƒæ¨¡å‹
```

è¿™åœ¨ Demo ä¸­æ²¡é—®é¢˜ï¼Œä½†åœ¨çœŸå®ç³»ç»Ÿä¸­ï¼Œè¿™ç§æ–¹å¼æ˜¯ä¸å¯æŒç»­çš„ã€‚

åŸå› åœ¨äºï¼š

* RAG ä¸æ˜¯ä¸€ä¸ª**å‡½æ•°**
* å®ƒæ˜¯ä¸€ä¸ª**é•¿æœŸå­˜åœ¨çš„ç³»ç»Ÿèƒ½åŠ›**

å½“æˆ‘ä»¬éœ€è¦é›†æˆRAGèƒ½åŠ›æ—¶ï¼Œå¿…é¡»å®Œæˆä¸€ä¸ªè§†è§’è½¬å˜ï¼š

> **RAG ä¸æ˜¯â€œæˆ‘ä»€ä¹ˆæ—¶å€™ç”¨ä¸€ä¸‹â€ï¼Œè€Œæ˜¯â€œç³»ç»Ÿåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ï¼Œå¿…é¡»ä¾èµ–å®ƒâ€ã€‚**


### 12.6.2 RAG çš„ç¬¬ä¸€ä¸ªå·¥ç¨‹é—®é¢˜ï¼šä½•æ—¶è§¦å‘ï¼Ÿ

ä¸€ä¸ªæˆç†Ÿç³»ç»Ÿï¼Œ**ä¸ä¼šå¯¹æ‰€æœ‰è¯·æ±‚éƒ½ä½¿ç”¨ RAG**ã€‚

å…¸å‹è§¦å‘æ¡ä»¶åŒ…æ‹¬ï¼š

* ç”¨æˆ·é—®é¢˜åŒ…å«ï¼š

  * ä¼ä¸šç§æœ‰åè¯
  * å†…éƒ¨æµç¨‹ / åˆ¶åº¦

* é—®é¢˜æ¶‰åŠï¼š

  * æ—¶æ•ˆæ€§
  * æ˜ç¡®ç‰ˆæœ¬
* æ¨¡å‹ç½®ä¿¡åº¦ä¸è¶³ï¼ˆå¦‚å¤šæ¬¡è‡ªæˆ‘çŸ›ç›¾ï¼‰

![](/imgs/column/llm/18-2.webp)

```mermaid
flowchart TD
    %% æ ·å¼å®šä¹‰ï¼šæç®€ä½†åˆ†å±‚
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px,font-size:14px
    classDef judgeNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px,diamond:true,rounded:5px,font-size:14px
    classDef outputNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px,font-size:14px
    classDef ragNode fill:#fce4ec,stroke:#c2185b,stroke-width:2px,rounded:10px,font-size:14px

    %% æ ¸å¿ƒæµç¨‹ï¼šæç®€è·¯ç”±é€»è¾‘
    A[ç”¨æˆ·é—®é¢˜<br/>User Query]:::inputNode --> B{æ˜¯å¦ä¾èµ–å¤–éƒ¨çŸ¥è¯†?<br/>Need External Knowledge?}:::judgeNode
    
    %% åˆ†æ”¯è·¯å¾„ï¼ˆè¡¥å……åœºæ™¯è¯´æ˜ï¼Œå›¾æ ‡å¼ºåŒ–ï¼‰
    B -->|âŒ å¦ï¼ˆå†…ç½®çŸ¥è¯†ï¼‰| C[ç›´æ¥ç”Ÿæˆ<br/>Direct Generation]:::outputNode
    B -->|âœ… æ˜¯ï¼ˆéœ€è¡¥å……ä¿¡æ¯ï¼‰| D[è§¦å‘ RAG<br/>Trigger RAG]:::ragNode

    %% å¯é€‰ï¼šæç®€æ³¨è§£ï¼ˆä¸å¹²æ‰°æ ¸å¿ƒæµç¨‹ï¼‰
    note[ğŸ“Œ æ ¸å¿ƒï¼šæŒ‰éœ€è§¦å‘æ£€ç´¢ï¼Œå¹³è¡¡æ•ˆç‡ä¸å‡†ç¡®æ€§]
    style note fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,font-size:12px,rounded:8px
    B -.-> note
```

### 12.6.3 RAG çš„ç¬¬äºŒä¸ªå·¥ç¨‹é—®é¢˜ï¼šæ¥å£å¦‚ä½•å®šä¹‰ï¼Ÿ

åœ¨è¿›é˜¶ç³»ç»Ÿä¸­ï¼ŒRAG æ¨¡å—ä¸åº”è¯¥â€œç›´æ¥æ‹¼ Promptâ€ï¼Œè€Œåº”è¯¥è¿”å›ä¸€ä¸ª**ç»“æ„åŒ–ç»“æœ**ï¼š

```json
{
  "documents": [
    {
      "id": "doc-123",
      "content": "...",
      "score": 0.87,
      "source": "HR-policy-v3"
    }
  ],
  "query_intent": "policy_explanation",
  "confidence": "high"
}
```

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š

* Prompt æ„å»ºä¸è¢« RAG å®ç°ç»‘æ­»
* ä¾¿äºè°ƒè¯•ä¸è¯„ä¼°
* ä¾¿äºå¤šæ¨¡å‹ / å¤šç­–ç•¥åˆ‡æ¢

> **RAG çš„è¾“å‡ºï¼Œæ˜¯ç³»ç»Ÿèµ„äº§ï¼Œä¸æ˜¯ Prompt ç‰‡æ®µã€‚**

### 12.6.4 RAG çš„ç¬¬ä¸‰ä¸ªå·¥ç¨‹é—®é¢˜ï¼šæ¨¡å‹å¦‚ä½•â€œè¢«è¿«ä½¿ç”¨â€æ£€ç´¢ç»“æœï¼Ÿ

è¿™æ˜¯**æœ€å®¹æ˜“è¢«å¿½ç•¥ã€ä½†æœ€è‡´å‘½çš„ä¸€ç‚¹**ã€‚

å³ä½¿ä½ æ£€ç´¢å›äº†æ­£ç¡®æ–‡æ¡£ï¼Œæ¨¡å‹ä»ç„¶å¯èƒ½ï¼š

* å¿½ç•¥å®ƒ
* æ›²è§£å®ƒ
* æ··åˆè‡ªèº«çŸ¥è¯†èƒ¡è¯´

å› æ­¤ä½ å¿…é¡»åœ¨ç³»ç»Ÿå±‚é¢åšçº¦æŸã€‚

#### ä¸€ç§å¸¸è§çš„å·¥ç¨‹ç­–ç•¥

```text
- æ‰€æœ‰ç»“è®ºå¿…é¡»å¼•ç”¨æä¾›çš„æ–‡æ¡£
- ä¸å…è®¸åŸºäºâ€œå¸¸è¯†â€è¡¥å……
- æ–‡æ¡£ä¸è¶³æ—¶ï¼Œå¿…é¡»å›ç­”â€œä¸ç¡®å®šâ€
```

![](/imgs/column/llm/18-3.webp)

```mermaid
graph TD
    %% æ ·å¼å®šä¹‰ï¼šæŒ‰åŠŸèƒ½åˆ†ç±»ï¼Œå»¶ç»­ç³»åˆ—é…è‰²
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px
    classDef logicNode fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,rounded:10px
    classDef coreNode fill:#fce4ec,stroke:#c2185b,stroke-width:3px,rounded:10px,font-weight:bold
    classDef llmNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px
    classDef noteNode fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,rounded:8px

    %% æ ¸å¿ƒæµç¨‹ï¼šæ£€ç´¢ç»“æœ â†’ çº¦æŸæ³¨å…¥ â†’ LLM ç”Ÿæˆ
    A[æ£€ç´¢ç»“æœ<br/>Retrieval Results<br/>ï¼ˆTop-K ç›¸å…³æ–‡æ¡£ç‰‡æ®µï¼‰]:::inputNode --> B[ä¸Šä¸‹æ–‡æ³¨å…¥<br/>Context Injection<br/>ï¼ˆæ•´åˆç‰‡æ®µ+æ ¼å¼æ ‡å‡†åŒ–ï¼‰]:::logicNode
    B --> C[å¼•ç”¨çº¦æŸ Prompt<br/>Citation Constraint Prompt<br/>ï¼ˆè¦æ±‚æ ‡æ³¨æ¥æº+ç¦æ­¢æ— ä¾æ®ç”Ÿæˆï¼‰]:::coreNode
    C --> D[LLM<br/>ï¼ˆç”Ÿæˆå¸¦å¼•ç”¨çš„å¯ä¿¡å›ç­”ï¼‰]:::llmNode

    %% æ ¸å¿ƒæ³¨è§£ï¼šç‚¹æ˜çº¦æŸä»·å€¼
    note[ğŸ“Œ æ ¸å¿ƒé€»è¾‘ï¼šé€šè¿‡ Prompt çº¦æŸå¼ºåˆ¶æ¥æºå¼•ç”¨ï¼Œè§£å†³ RAG ç”Ÿæˆâ€œå¹»è§‰â€é—®é¢˜ï¼Œæå‡å¯ä¿¡åº¦]:::noteNode
    C -.-> note 

    %% ç®­å¤´æ ·å¼ï¼šå¼ºåŒ–æµç¨‹è¿è´¯æ€§
    linkStyle 0 stroke:#616161,stroke-width:1.5px
    linkStyle 1 stroke:#9c27b0,stroke-width:1.5px
    linkStyle 2 stroke:#c2185b,stroke-width:2.5px
```

> **RAG çš„æˆåŠŸï¼Œ50% å–å†³äºâ€œç”Ÿæˆçº¦æŸâ€ï¼Œè€Œä¸æ˜¯â€œæ£€ç´¢å‡†ç¡®ç‡â€ã€‚**

### 12.6.5 RAG çš„ç¬¬å››ä¸ªå·¥ç¨‹é—®é¢˜ï¼šå¤±è´¥å¦‚ä½•è¢«å®šä½ï¼Ÿ

åœ¨åº”ç”¨çš„å®é™…è¡¨ç°ä¸­ï¼Œä¸€å®šä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼š

> *â€œç°åœ¨æ•ˆæœä¸å¥½ï¼Œä½†æˆ‘ä¸çŸ¥é“æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚â€*

ä¸€ä¸ªå¯è¯Šæ–­çš„ RAG ç³»ç»Ÿï¼Œè‡³å°‘èƒ½å›ç­”ï¼š

* æ˜¯ä¸æ˜¯æ ¹æœ¬æ²¡å¬å›ï¼Ÿ
* å¬å›çš„å†…å®¹æ˜¯å¦ç›¸å…³ï¼Ÿ
* æ¨¡å‹æ˜¯å¦ä½¿ç”¨äº†å¬å›å†…å®¹ï¼Ÿ
* å›ç­”æ˜¯å¦è¶…å‡ºäº†å¼•ç”¨èŒƒå›´ï¼Ÿ

è¿™è¦æ±‚ä½ åœ¨ç³»ç»Ÿä¸­æ˜ç¡®åŒºåˆ†ï¼š

```text
æ£€ç´¢å¤±è´¥ / å¬å›å™ªå£° / ç”Ÿæˆè¿çº¦
```

å¦åˆ™ï¼Œä½ æ°¸è¿œåªèƒ½â€œå‡­æ„Ÿè§‰è°ƒâ€ã€‚

### 12.6.6 ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­çš„ RAG é›†æˆç¤ºä¾‹

æœ€åä»¥ä¼ä¸šçŸ¥è¯†åº“ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹RAGçš„é›†æˆç¤ºä¾‹å›¾

![](/imgs/column/llm/18-4.webp)

```mermaid
graph TD
    %% æ ·å¼å®šä¹‰ï¼šå»¶ç»­ç³»åˆ—åˆ†ç±»é…è‰²ï¼Œå¼ºåŒ–åŒºåˆ†åº¦
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px,font-size:13px
    classDef logicNode fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,rounded:10px,font-size:13px
    classDef judgeNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px,diamond:true,rounded:5px,font-size:13px
    classDef coreNode fill:#fce4ec,stroke:#c2185b,stroke-width:3px,rounded:10px,font-weight:bold,font-size:13px
    classDef resultNode fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px,rounded:10px,font-size:13px
    classDef outputNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px,font-size:13px
    classDef noteNode fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,rounded:8px,font-size:12px

    %% æ ¸å¿ƒæµç¨‹ï¼šè¾“å…¥â†’æ„å›¾è¯†åˆ«â†’è·¯ç”±åˆ¤æ–­
    A[ç”¨æˆ·é—®é¢˜<br/>User Query]:::inputNode --> B[æ„å›¾è¯†åˆ«<br/>Intent Recognition<br/>ï¼ˆéœ€æ±‚åˆ†ç±»+è§¦å‘æ¡ä»¶åˆ¤æ–­ï¼‰]:::logicNode
    B --> C{æ˜¯å¦è§¦å‘ RAG?<br/>Trigger RAG?}:::judgeNode

    %% è·¯å¾„1ï¼šæ— éœ€ RAG â†’ ç›´æ¥ç”Ÿæˆ
    C -->|âŒ å¦ï¼ˆå†…ç½®çŸ¥è¯†è¶³å¤Ÿï¼‰| D[ç›´æ¥ç”Ÿæˆ<br/>Direct Generation<br/>ï¼ˆåŸºäº LLM å†…ç½®çŸ¥è¯†åº“ï¼‰]:::outputNode

    %% è·¯å¾„2ï¼šéœ€è¦ RAG â†’ å…¨æµç¨‹é“¾è·¯
    C -->|âœ… æ˜¯ï¼ˆéœ€å¤–éƒ¨çŸ¥è¯†ï¼‰| E[RAG æ¨¡å—<br/>RAG Module<br/>ï¼ˆçŸ¥è¯†åº“æ£€ç´¢+ç‰‡æ®µç­›é€‰ï¼‰]:::coreNode
    E --> F[ç»“æ„åŒ–æ£€ç´¢ç»“æœ<br/>Structured Retrieval Results<br/>ï¼ˆæ ‡æ³¨æ¥æº+å…³é”®ä¿¡æ¯æå–ï¼‰]:::resultNode
    F --> G[ä¸Šä¸‹æ–‡æ„å»ºå™¨<br/>Context Builder<br/>ï¼ˆæ•´åˆç»“æœ+å¯¹è¯å†å²+ç³»ç»Ÿçº¦æŸï¼‰]:::logicNode
    G --> H[çº¦æŸç”Ÿæˆ Prompt<br/>Constraint Generation Prompt<br/>ï¼ˆè¦æ±‚å¼•ç”¨æ¥æº+ç¦æ­¢æ— ä¾æ®ç”Ÿæˆï¼‰]:::coreNode
    H --> I[LLM è¾“å‡º<br/>LLM Output<br/>ï¼ˆå¯ä¿¡+å¯æº¯æºçš„å›ç­”ï¼‰]:::outputNode

    %% æ ¸å¿ƒæ³¨è§£ï¼šç‚¹æ˜å…¨æµç¨‹ä»·å€¼
    note[ğŸ“Œ æ ¸å¿ƒé€»è¾‘ï¼šæ™ºèƒ½è·¯ç”±ä¼˜åŒ–æ•ˆç‡ï¼ŒRAG+çº¦æŸç”Ÿæˆè§£å†³çŸ¥è¯†æ—¶æ•ˆæ€§ä¸å¹»è§‰é—®é¢˜ï¼Œå…¼é¡¾é€Ÿåº¦ä¸å¯ä¿¡åº¦]:::noteNode
    B -.-> note 

    %% ç®­å¤´æ ·å¼ï¼šå¼ºåŒ–è·¯å¾„åŒºåˆ†ä¸æ ¸å¿ƒé“¾è·¯
    linkStyle 0 stroke:#616161,stroke-width:1.5px
    linkStyle 1 stroke:#f57c00,stroke-width:1.5px
    linkStyle 2 stroke:#388e3c,stroke-width:1.5px
    linkStyle 3 stroke:#c2185b,stroke-width:1.5px
    linkStyle 4 stroke:#ef6c00,stroke-width:1.5px
    linkStyle 5 stroke:#9c27b0,stroke-width:1.5px
    linkStyle 6 stroke:#c2185b,stroke-width:2.5px
    linkStyle 7 stroke:#c2185b,stroke-width:2px
```

## 12.7 æœ¬ç« å°ç»“ï¼šRAG æ˜¯ç³»ç»Ÿå·¥ç¨‹ï¼Œè€Œä¸æ˜¯æ£€ç´¢æŠ€å·§

é€šè¿‡è¿™ä¸€ç« ï¼Œä½ åº”è¯¥å·²ç»å½¢æˆä¸€ä¸ªå®Œæ•´è®¤çŸ¥ï¼š

* RAG ä¸æ˜¯æ¨¡å‹å¢å¼ºï¼Œä¹Ÿä¸æ˜¯ç®€å•çš„â€œæŸ¥èµ„æ–™â€

è€Œæ˜¯ï¼š

> **ä¸€ç§ç”¨äºçªç ´æ¨¡å‹çŸ¥è¯†è¾¹ç•Œçš„ç³»ç»Ÿè¡¥å¿æœºåˆ¶ã€‚**

åŒæ—¶ä½ ä¹Ÿåº”è¯¥æ¸…æ¥šåœ°æ„è¯†åˆ°ï¼š

* RAG çš„æ•ˆæœä¸Šé™ï¼Œå¾ˆæ—©å°±è¢«æ–‡æ¡£ç»“æ„ä¸æ•°æ®å·¥ç¨‹å†³å®šäº†

è¿™æ„å‘³ç€ï¼š

> **RAG æ˜¯ä¸€ä¸ªæ•°æ®å·¥ç¨‹ä¸ç³»ç»Ÿè®¾è®¡é—®é¢˜ï¼Œè¿œæ—©äºå®ƒæ˜¯ä¸€ä¸ªæ¨¡å‹é—®é¢˜ã€‚**

å³ä¾¿æˆ‘ä»¬é€šè¿‡ç²¾å¿ƒçš„ Chunk è®¾è®¡ä¸º RAG æ‰“ä¸‹äº†åšå®åŸºç¡€ï¼Œä¹Ÿæ— æ³•å®Œå…¨é¿å…æ£€ç´¢å¤±è´¥çš„å¯èƒ½ â€”â€” æ¯•ç«Ÿç”¨æˆ·çš„é—®é¢˜å¯èƒ½å¤©é©¬è¡Œç©ºï¼ŒçŸ¥è¯†åº“çš„è¦†ç›–ä¹Ÿæ€»æœ‰è¾¹ç•Œã€‚é‚£ä¹ˆï¼Œå½“æ£€ç´¢çœŸçš„ â€œç©ºæ‰‹è€Œå½’â€ æ—¶ï¼Œç³»ç»Ÿè¯¥å¦‚ä½•åº”å¯¹æ‰èƒ½é¿å…é™·å…¥ â€œèƒ¡ç¼–ä¹±é€ â€ çš„é™·é˜±ï¼Ÿ

