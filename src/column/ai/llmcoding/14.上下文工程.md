---
order: 14
title: ç¬¬ 9 ç« ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹åœ¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­çš„è½åœ°
tag:
  - LLM
category:
  - LLM
date: 2025-12-30 15:25:07
keywords: LLMåº”ç”¨å¼€å‘
---

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»åå¤æåˆ°å‡ ä¸ªç°è±¡ï¼š

* Prompt å†™å¾—å†å¥½ï¼Œå¯¹è¯ä¸€é•¿å°±ä¼šå¤±æ§
* æ¨¡å‹èƒ½åŠ›æ²¡æœ‰å˜ï¼Œä½†ç³»ç»Ÿè¡¨ç°å´è¶Šæ¥è¶Šå·®
* ç”¨æˆ·çš„é—®é¢˜è¶Šæ¥è¶Šâ€œåˆç†â€ï¼Œæ¨¡å‹å´è¶Šæ¥è¶Šâ€œè·‘åâ€

è¿™äº›é—®é¢˜ï¼Œ**å‡ ä¹éƒ½ä¸æ˜¯æ¨¡å‹é—®é¢˜ï¼Œä¹Ÿä¸æ˜¯ Prompt é—®é¢˜**ã€‚ â€”â€” Prompt è§£å†³çš„æ˜¯ â€œå•æ¬¡ç”Ÿæˆçš„çº¦æŸâ€ï¼Œæ¨¡å‹è§£å†³çš„æ˜¯ â€œæ¦‚ç‡é¢„æµ‹çš„èƒ½åŠ›â€ï¼Œè€Œå®ƒä»¬å…±åŒå¿½ç•¥äº†å¤šè½®å¯¹è¯çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š**æ—¶é—´ç»´åº¦ä¸Šçš„ä¿¡æ¯ç®¡ç†ã€‚**

å®ƒä»¬æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼š

> **ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼ˆContext Engineeringï¼‰**

è¿™é—¨æŠ€æœ¯çœ‹ä¼¼ç®€å•ï¼ˆâ€œç®¡ç†å¯¹è¯å†å²â€ï¼‰ï¼Œå®åˆ™æ˜¯åŒºåˆ† â€œç©å…·çº§åº”ç”¨â€ å’Œ â€œç”Ÿäº§çº§ç³»ç»Ÿâ€ çš„å…³é”® â€”â€” å®ƒå†³å®šäº†ä½ çš„ LLM åº”ç”¨èƒ½åœ¨çœŸå®åœºæ™¯ä¸­ â€œè·‘å¤šè¿œâ€ã€‚

---

### 9.1 ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Ÿï¼ˆä¸æ˜¯â€œå¤šè½®å¯¹è¯â€ï¼‰

å¾ˆå¤šäººç¬¬ä¸€æ¬¡å¬åˆ°â€œä¸Šä¸‹æ–‡å·¥ç¨‹â€æ—¶ï¼Œä¼šæŠŠå®ƒç®€å•ç†è§£ä¸ºï¼š

* ç»´æŠ¤èŠå¤©å†å²
* æŠŠä¹‹å‰çš„å¯¹è¯ä¸€èµ·ä¼ ç»™æ¨¡å‹

ä½†è¿™åªæ˜¯**æœ€è¡¨å±‚ã€ä¹Ÿæ˜¯æœ€å±é™©çš„ä¸€ç§ç†è§£**ã€‚

æ›´å‡†ç¡®çš„å®šä¹‰æ˜¯ï¼š

> **ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Œæ˜¯ä¸€é—¨å…³äºã€Œåœ¨æœ‰é™çª—å£å†…ï¼Œå¦‚ä½•æŒç»­ã€å¯æ§åœ°å‘æ¨¡å‹æ³¨å…¥ä¿¡æ¯ã€çš„å·¥ç¨‹å­¦ç§‘ã€‚**

å®ƒå…³æ³¨çš„ä¸æ˜¯â€œèŠäº†å¤šå°‘è½®â€ï¼Œè€Œæ˜¯ â€œæ¯ä¸€è½®è¯¥è®©æ¨¡å‹çœ‹åˆ°ä»€ä¹ˆâ€â€”â€” å…·ä½“æ¥è¯´ï¼Œæ˜¯å››ä¸ªå…³é”®å†³ç­–ï¼š

* **å“ªäº›ä¿¡æ¯å¿…é¡»ä¸€ç›´å­˜åœ¨**ï¼šæ¯”å¦‚ç³»ç»Ÿçš„æ ¸å¿ƒçº¦æŸã€ç”¨æˆ·çš„å…³é”®èº«ä»½ä¿¡æ¯ï¼Œè¿™äº›æ˜¯ç»´æŒç³»ç»Ÿè¡Œä¸ºä¸€è‡´æ€§çš„åŸºç¡€ï¼›
* **å“ªäº›ä¿¡æ¯å¯ä»¥è¢«é—å¿˜**ï¼šæ¯”å¦‚å¯¹è¯ä¸­çš„å¯’æš„ã€ä¸´æ—¶è¿½é—®çš„æ— å…³ç»†èŠ‚ï¼Œè¿™äº›ä¿¡æ¯å¯¹åç»­å†³ç­–æ¯«æ— ä»·å€¼ï¼›
* **å“ªäº›ä¿¡æ¯éœ€è¦è¢«å‹ç¼©ã€æ€»ç»“ã€é‡å†™**ï¼šæ¯”å¦‚å¤šè½®å¯¹è¯ä¸­å½¢æˆçš„å…±è¯†ï¼ˆâ€œç”¨æˆ·æ˜¯é”€å”®éƒ¨å‘˜å·¥â€ï¼‰ï¼Œæ— éœ€ä¿ç•™å®Œæ•´å¯¹è¯ï¼Œåªéœ€æç‚¼æ ¸å¿ƒç»“è®ºï¼›
* **å“ªäº›ä¿¡æ¯åº”è¯¥æ°¸è¿œä¸è¿›å…¥ä¸Šä¸‹æ–‡**ï¼šæ¯”å¦‚æ•æ„Ÿæ•°æ®ï¼ˆç”¨æˆ·æ‰‹æœºå·ï¼‰ã€æ— æ•ˆåé¦ˆï¼ˆâ€œè°¢è°¢â€â€œå¥½çš„â€ï¼‰ã€æ½œåœ¨é£é™©å†…å®¹ï¼ˆæ¶æ„å¼•å¯¼çš„æé—®ï¼‰ã€‚

ä¸¾ä¸ªç›´è§‚çš„ä¾‹å­ï¼š

ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹çš„å¯¹è¯ä¸­ï¼Œ

- â€œä»…å›ç­”å†…éƒ¨æ”¿ç­–ï¼Œç¦æ­¢æ³„éœ²æœªå…¬å¼€ä¿¡æ¯â€ å¿…é¡»ä¸€ç›´å­˜åœ¨ï¼›
- ç”¨æˆ·è¯´çš„ â€œæˆ‘å†æƒ³æƒ³â€ å¯ä»¥è¢«é—å¿˜ï¼›
- â€œæˆ‘æ˜¯é”€å”®éƒ¨çš„ï¼Œç»å¸¸å‡ºå·®â€ éœ€è¦æ€»ç»“ä¸º â€œç”¨æˆ·ï¼šé”€å”®éƒ¨ï¼Œé«˜é¢‘å‡ºå·®â€ï¼›
- ç”¨æˆ·è¯¯è¾“å…¥çš„æ‰‹æœºå·åº”è¯¥ç›´æ¥è¿‡æ»¤ï¼Œä¸è¿›å…¥ä¸Šä¸‹æ–‡ã€‚

ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æœ¬è´¨ï¼Œæ˜¯å¯¹æ¨¡å‹çš„è¾“å…¥è¿›è¡Œ â€œä¸»åŠ¨æ²»ç†â€ â€”â€” è€Œä¸æ˜¯è¢«åŠ¨æ¥å—å¯¹è¯çš„è‡ªç„¶å¢é•¿ã€‚

---

### 9.2 ä¸ºä»€ä¹ˆâ€œè‡ªç„¶å¢é•¿çš„ä¸Šä¸‹æ–‡ä¸€å®šä¼šå¤±è´¥ï¼Ÿâ€

è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ç§**å‡ ä¹æ‰€æœ‰æ–°æ‰‹éƒ½ä¼šé‡‡ç”¨çš„æ–¹å¼**ï¼š

```text
ç”¨æˆ·é—®ä¸€å¥
æ¨¡å‹ç­”ä¸€å¥
å…¨éƒ¨åŸæ ·å¡å›ä¸Šä¸‹æ–‡
```

è¿™ç§æ–¹å¼åœ¨å‰å‡ è½®å¯¹è¯ä¸­è¡¨ç°è‰¯å¥½ï¼Œä½†å®ƒ**ä»å·¥ç¨‹è§’åº¦çœ‹æ˜¯å¿…ç„¶å¤±è´¥çš„**ã€‚

å‰é¢ä¹Ÿæåˆ°è¿‡ï¼ŒåŸå› æœ‰ä¸‰ç‚¹ï¼š

1. çª—å£æœ‰é™ vs ä¿¡æ¯æ— é™å¢é•¿
2. ä¸åŒä¿¡æ¯çš„â€œé‡è¦æ€§â€å¹¶ä¸ç›¸åŒ vs æ¨¡å‹å¹³ç­‰å¯¹å¾…
3. æ¨¡å‹æ— æ²»ç†èƒ½åŠ› vs ä¿¡æ¯éœ€åŠ¨æ€è°ƒæ•´

æ›´å±é™©çš„æ˜¯ï¼Œè¿™ç§ â€œè‡ªç„¶å¢é•¿â€ çš„æ–¹å¼ä¼šè®©é—®é¢˜ â€œå»¶è¿Ÿçˆ†å‘â€ï¼šå‰å‡ è½®çœ‹ä¼¼æ­£å¸¸ï¼Œç­‰å¯¹è¯è¾¾åˆ°ä¸€å®šé•¿åº¦åï¼Œé”™è¯¯ä¼šé›†ä¸­å‡ºç°ï¼Œä¸”å¾ˆéš¾å®šä½é—®é¢˜æ ¹æºï¼ˆæ˜¯å“ªä¸€è½®çš„ä¿¡æ¯å¯¼è‡´äº†åå·®ï¼Ÿï¼‰ã€‚


å› æ­¤ï¼Œä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ ¸å¿ƒå‰ææ˜¯ï¼š**æ”¾å¼ƒ â€œå…¨é‡ä¿ç•™â€ çš„å¹»æƒ³ï¼Œè½¬å‘ â€œç²¾å‡†ç­›é€‰â€ çš„ä¸»åŠ¨è®¾è®¡**ã€‚

---

### 9.3 ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ ¸å¿ƒæ€æƒ³ï¼šåˆ†å±‚ï¼Œè€Œä¸æ˜¯å †å 

æˆç†Ÿçš„ LLM ç³»ç»Ÿéƒ½ä¼šéšå«ä¸€ä¸ªå…±è¯†ï¼š

> **ä¸Šä¸‹æ–‡ä¸æ˜¯ä¸€æ¡æ—¶é—´çº¿ï¼Œè€Œæ˜¯ä¸€ç»„â€œèŒè´£ä¸åŒçš„ä¿¡æ¯å±‚â€ã€‚**

ä¸€ä¸ªé€šç”¨ã€ä½†éå¸¸é‡è¦çš„æŠ½è±¡å¯ä»¥è¡¨ç¤ºä¸ºï¼š

![](/imgs/column/llm/14-1.webp)

```mermaid
graph TD
    %% æ ·å¼å®šä¹‰ï¼šæ²¿ç”¨åˆ†ç±»é…è‰²ï¼Œå¼ºåŒ–èŠ‚ç‚¹åŒºåˆ†
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px
    classDef coreNode fill:#fce4ec,stroke:#c2185b,stroke-width:3px,rounded:10px,font-weight:bold
    classDef llmNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px,font-size:14px
    classDef noteNode fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,rounded:8px

    %% è¾“å…¥èŠ‚ç‚¹ï¼šæ¨ªå‘å¹¶åˆ—ï¼Œè§†è§‰å¯¹ç§°
    A[é•¿æœŸä¸å˜çš„ç³»ç»Ÿçº¦æŸ<br/>System Constraints<br/>ï¼ˆè§’è‰²/è§„åˆ™/æƒé™ï¼‰]:::inputNode --> F[ä¸Šä¸‹æ–‡æ„å»ºå™¨<br/>Context Builder<br/>ï¼ˆç­›é€‰+æ•´åˆ+Tokenæ§åˆ¶ï¼‰]:::coreNode
    B[è·¨è½®å¯¹è¯çš„çŠ¶æ€æ‘˜è¦<br/>Cross-turn State Summary<br/>ï¼ˆæ ¸å¿ƒç»“è®º/æœªå®Œæˆäº‹é¡¹ï¼‰]:::inputNode --> F
    C[æœ€è¿‘å¯¹è¯å†…å®¹<br/>Recent Conversation<br/>ï¼ˆç²¾ç®€5-10è½®ï¼Œæ§åˆ¶é•¿åº¦ï¼‰]:::inputNode --> F
    D[å¤–éƒ¨æ³¨å…¥çš„çŸ¥è¯†/å·¥å…·ç»“æœ<br/>External Knowledge/Tool Results<br/>ï¼ˆæ•°æ®åº“æŸ¥è¯¢/APIè¿”å›/æ–‡æ¡£ç‰‡æ®µï¼‰]:::inputNode --> F

    %% æ ¸å¿ƒè¾“å‡ºï¼šæŒ‡å‘LLM
    F --> G[LLM<br/>ï¼ˆæ¥æ”¶èåˆåçš„å®Œæ•´è¾“å…¥ï¼‰]:::llmNode

    %% è¡¥å……æ³¨è§£ï¼šç‚¹æ˜æ ¸å¿ƒä»·å€¼
    note[ğŸ“Œ æ ¸å¿ƒé€»è¾‘ï¼šå¤šæºä¿¡æ¯èåˆï¼Œè®©LLMå…¼å…·ã€Œä¸Šä¸‹æ–‡è¿è´¯æ€§ã€ä¸ã€Œå¤–éƒ¨çŸ¥è¯†èƒ½åŠ›ã€]:::noteNode
    F -.-> note 

    %% ç®­å¤´æ ·å¼ï¼šå¼ºåŒ–å±‚çº§å…³ç³»
    linkStyle 0 stroke:#616161,stroke-width:1.5px
    linkStyle 1 stroke:#616161,stroke-width:1.5px
    linkStyle 2 stroke:#616161,stroke-width:1.5px
    linkStyle 3 stroke:#616161,stroke-width:1.5px
    linkStyle 4 stroke:#c2185b,stroke-width:2.5px,stroke-dasharray:0 0 
```

è¿™å¼ å›¾èƒŒåéšè—ç€å‡ ä¸ªå…³é”®è®¾è®¡å†³ç­–,ä¹Ÿæ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ ¸å¿ƒä»·å€¼æ‰€åœ¨ï¼š

1. æ¯å±‚ä¿¡æ¯éƒ½æœ‰æ˜ç¡®çš„ â€œèŒè´£è¾¹ç•Œâ€

  - **é•¿æœŸä¸å˜çš„ç³»ç»Ÿçº¦æŸ**ï¼šè´Ÿè´£ â€œå®šè§„çŸ©â€ï¼Œå›ç­” â€œç³»ç»Ÿæ°¸è¿œä¸èƒ½åšä»€ä¹ˆã€å¿…é¡»éµå®ˆä»€ä¹ˆâ€ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„ â€œè¡Œä¸ºåº•çº¿â€ï¼›
  - **è·¨è½®å¯¹è¯çš„çŠ¶æ€æ‘˜è¦**ï¼šè´Ÿè´£ â€œè®°å…³é”®â€ï¼Œå›ç­” â€œå¯¹è¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ‰å“ªäº›ç¡®å®šçš„äº‹å®ã€æœªè§£å†³çš„é—®é¢˜â€ï¼Œæ˜¯ç»´æŒè¿è´¯æ€§çš„æ ¸å¿ƒï¼›
  - **æœ€è¿‘ N è½®å¯¹è¯å†…å®¹**ï¼šè´Ÿè´£ â€œä¿æµç•…â€ï¼Œå›ç­” â€œç”¨æˆ·åˆšåˆšé—®äº†ä»€ä¹ˆã€ç³»ç»Ÿåˆšåˆšç­”äº†ä»€ä¹ˆâ€ï¼Œé¿å…å¯¹è¯è„±èŠ‚ï¼›
  - **å¤–éƒ¨æ³¨å…¥çš„çŸ¥è¯† / å·¥å…·ç»“æœ**ï¼šè´Ÿè´£ â€œè¡¥ä¿¡æ¯â€ï¼Œå›ç­” â€œå½“å‰é—®é¢˜éœ€è¦å“ªäº›é¢å¤–çŸ¥è¯† / æ•°æ®â€ï¼Œæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„ä¸´æ—¶è¡¥å……ã€‚

2. æ¯å±‚ä¿¡æ¯éƒ½æœ‰æ˜ç¡®çš„ â€œä¼˜å…ˆçº§â€

  - å½“ä¸Šä¸‹æ–‡çª—å£æ¥è¿‘ token ä¸Šé™æ—¶ï¼Œéµå¾ª â€œå…ˆç ä½ä¼˜å…ˆçº§ï¼Œå†ä¿é«˜ä¼˜å…ˆçº§â€ çš„åŸåˆ™ï¼š
  - ç»å¯¹ä¸ç ï¼šé•¿æœŸä¸å˜çš„ç³»ç»Ÿçº¦æŸï¼›
  - å°½é‡ä¿ç•™ï¼šè·¨è½®å¯¹è¯çš„çŠ¶æ€æ‘˜è¦ï¼›
  - å¯åŠ¨æ€æˆªæ–­ï¼šæœ€è¿‘ N è½®å¯¹è¯å†…å®¹ï¼ˆæ¯”å¦‚ä» 10 è½®ç åˆ° 5 è½®ï¼‰ï¼›
  - æŒ‰éœ€ç­›é€‰ï¼šå¤–éƒ¨æ³¨å…¥çš„çŸ¥è¯† / å·¥å…·ç»“æœï¼ˆæ¯”å¦‚åªä¿ç•™ä¸å½“å‰é—®é¢˜ç›¸å…³çš„ç‰‡æ®µï¼‰ã€‚

3. æ¯å±‚ä¿¡æ¯éƒ½æœ‰æ˜ç¡®çš„ â€œæ›´æ–°è§„åˆ™â€

  - ç³»ç»Ÿçº¦æŸï¼šä»…åœ¨ä¸šåŠ¡è§„åˆ™å˜æ›´æ—¶æ›´æ–°ï¼ˆæ¯”å¦‚å…¬å¸æ”¿ç­–è°ƒæ•´ï¼‰ï¼Œå¹³æ—¶å›ºå®šä¸å˜ï¼›
  - çŠ¶æ€æ‘˜è¦ï¼šæ¯è½®å¯¹è¯ç»“æŸåæ›´æ–°ï¼ˆæ–°å¢ç¡®è®¤äº‹å®ã€ç§»é™¤å·²è§£å†³é—®é¢˜ã€ä¿®æ­£é”™è¯¯ä¿¡æ¯ï¼‰ï¼›
  - æœ€è¿‘ N è½®ï¼šæ¯è½®å¯¹è¯åè‡ªåŠ¨æ»‘åŠ¨ï¼Œç§»é™¤æœ€æ—©çš„å†…å®¹ï¼›
  - å¤–éƒ¨çŸ¥è¯†ï¼šéšå½“å‰é—®é¢˜åŠ¨æ€æ³¨å…¥ï¼Œé—®é¢˜è§£å†³åä¸ä¿ç•™ï¼ˆé¿å…å ç”¨çª—å£ï¼‰ã€‚

è¿™ç§åˆ†å±‚è®¾è®¡çš„ä¼˜åŠ¿æ˜¾è€Œæ˜“è§ï¼šå¯ç»´æŠ¤æ€§ã€å¯é¢„æµ‹æ€§ã€å¯æ‰©å±•æ€§ â€”â€” å½“ä½ éœ€è¦è°ƒæ•´ç³»ç»Ÿè¡Œä¸ºæ—¶ï¼Œåªéœ€ä¿®æ”¹å¯¹åº”å±‚çš„ä¿¡æ¯ï¼Œè€Œä¸ç”¨é‡æ„æ•´ä¸ªä¸Šä¸‹æ–‡é€»è¾‘ã€‚

---

### 9.4 ä¸Šä¸‹æ–‡å·¥ç¨‹ â‰  Prompt å·¥ç¨‹

è¿™æ˜¯ä¸€ä¸ªéå¸¸å®¹æ˜“æ··æ·†ã€ä½†å¿…é¡»åŒºåˆ†æ¸…æ¥šçš„ç‚¹ã€‚

| ç»´åº¦   | Prompt å·¥ç¨‹ | ä¸Šä¸‹æ–‡å·¥ç¨‹     |
| ---- | --------- | --------- |
| å…³æ³¨ç‚¹  | å•æ¬¡è°ƒç”¨çš„è¡Œä¸ºçº¦æŸ | è·¨è°ƒç”¨çš„ä¿¡æ¯æ¼”è¿›  |
| æ ¸å¿ƒé—®é¢˜ | æ¨¡å‹è¯¥å¦‚ä½•å›ç­”   | æ¨¡å‹â€œè®°ä½äº†ä»€ä¹ˆâ€ |
| æ—¶é—´ç»´åº¦ | é™æ€ï¼ˆä»…ä½œç”¨äºå½“å‰è½®ï¼‰| åŠ¨æ€ ï¼ˆè´¯ç©¿æ•´ä¸ªå¯¹è¯ç”Ÿå‘½å‘¨æœŸï¼‰  |
| å¤±è´¥æ¨¡å¼ | å›ç­”ä¸åˆè§„     | ç³»ç»Ÿé€æ¸å¤±æ§    |
| è½åœ°æ–¹å¼ | è®¾è®¡ç»“æ„åŒ– Promptï¼ˆRole/Task/Constraintsï¼‰ | è®¾è®¡åˆ†å±‚ä¸Šä¸‹æ–‡ï¼ˆçº¦æŸ / çŠ¶æ€ / è¿‘æœŸ / å¤–éƒ¨çŸ¥è¯†ï¼‰|

æˆ‘ä»¬å¯ä»¥ç”¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹çš„åœºæ™¯ï¼Œæ›´ç›´è§‚åœ°ç†è§£ä¸¤è€…çš„åŒºåˆ«ï¼š

- **Prompt å·¥ç¨‹**ï¼šè§£å†³ â€œç”¨æˆ·é—®â€˜å·®æ—…æŠ¥é”€æ ‡å‡†â€™æ—¶ï¼Œæ¨¡å‹èƒ½å‡†ç¡®å¼•ç”¨ 2025 å¹´æ”¿ç­–â€â€”â€” é€šè¿‡ Prompt ä¸­çš„ Constraints é™å®š â€œä»…ç”¨æä¾›çš„æ”¿ç­–æ–‡æ¡£å›ç­”â€ï¼›
- **ä¸Šä¸‹æ–‡å·¥ç¨‹**ï¼šè§£å†³ â€œç”¨æˆ·åç»­é—®â€˜æˆ‘æ˜¯é”€å”®éƒ¨ï¼Œèƒ½æŠ¥é«˜é“ä¸€ç­‰åº§å—â€™æ—¶ï¼Œæ¨¡å‹èƒ½è®°ä½â€˜ç”¨æˆ·æ˜¯é”€å”®éƒ¨â€™ï¼Œå¹¶ç»“åˆæ”¿ç­–ç»™å‡ºç­”æ¡ˆâ€â€”â€” é€šè¿‡çŠ¶æ€æ‘˜è¦å±‚ä¿ç•™ â€œç”¨æˆ·éƒ¨é—¨â€ è¿™ä¸€å…³é”®ä¿¡æ¯ã€‚

ç®€å•æ¥è¯´

> Prompt å†³å®š â€œè¿™ä¸€è½®ä½ è¯¥æ€ä¹ˆæƒ³â€ï¼Œä¸Šä¸‹æ–‡å†³å®š â€œä½ ç°åœ¨æ˜¯è°ã€åœ¨å¹²ä»€ä¹ˆâ€ã€‚

---

## 9.5 ä¸Šä¸‹æ–‡å·¥ç¨‹åœ¨ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä¸­çš„è½åœ°

åœ¨ç†è§£äº†æŠ½è±¡æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹å…·ä½“ç³»ç»Ÿã€‚

ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹é¢ä¸´çš„å…¸å‹çº¦æŸåŒ…æ‹¬ï¼š

* å¿…é¡»éµå®ˆä¼ä¸šè§„åˆ™ï¼ˆä¸å¯é—å¿˜ï¼‰
  - *æ¯”å¦‚ â€œç¦æ­¢æ³„éœ²æœªå…¬å¼€çš„è´¢åŠ¡æ”¿ç­–â€â€œæ‰€æœ‰å›ç­”å¿…é¡»æ ‡æ³¨æ”¿ç­–æ¥æºâ€â€œæ‹’ç»å›ç­”å¤–éƒ¨ç«å“ç›¸å…³é—®é¢˜â€â€”â€” è¿™äº›éœ€è¦æ˜ å°„åˆ° â€œé•¿æœŸä¸å˜çš„ç³»ç»Ÿçº¦æŸâ€ å±‚ï¼Œç¡®ä¿æ¯ä¸€è½®éƒ½èƒ½è¢«æ¨¡å‹çœ‹åˆ°ï¼›*
* å¿…é¡»ä¿æŒå¯¹è¯è¿ç»­æ€§ï¼ˆå¯å‹ç¼©ï¼‰
  - *æ¯”å¦‚ç”¨æˆ·å…ˆé—® â€œå·®æ—…æŠ¥é”€æµç¨‹â€ï¼Œå†é—® â€œæŠ¥é”€éœ€è¦å¤šä¹…åˆ°è´¦â€ï¼Œæ¨¡å‹éœ€è¦çŸ¥é“ â€œç”¨æˆ·ä»åœ¨å…³æ³¨å·®æ—…æŠ¥é”€ç›¸å…³é—®é¢˜â€â€”â€” è¿™äº›éœ€è¦æ˜ å°„åˆ° â€œè·¨è½®å¯¹è¯çš„çŠ¶æ€æ‘˜è¦â€ å±‚ï¼Œé¿å…é‡å¤è¯¢é—®èƒŒæ™¯ä¿¡æ¯ï¼›*
* å¿…é¡»æŒ‰éœ€å¼•å…¥çŸ¥è¯†ï¼ˆä¸´æ—¶æ³¨å…¥ï¼‰
  - *æ¯”å¦‚ç”¨æˆ·é—® â€œ2025å¹´æ–°ç‰ˆå·®æ—…æ”¿ç­–ä¸­ï¼Œæµ·å¤–ä½å®¿æ ‡å‡†æ˜¯ä»€ä¹ˆâ€â€”â€” éœ€è¦ä»ä¼ä¸šçŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ç‰‡æ®µï¼Œæ˜ å°„åˆ° â€œå¤–éƒ¨æ³¨å…¥çš„çŸ¥è¯†â€ å±‚ï¼Œé—®é¢˜è§£å†³åå³ç§»é™¤ï¼›*
* å¿…é¡»é¿å…ä¸Šä¸‹æ–‡æ±¡æŸ“ï¼ˆå¯æ¸…é™¤ï¼‰
  - *æ¯”å¦‚ç”¨æˆ·è¯¯è¾“å…¥çš„ä¸ªäººæ‰‹æœºå·ã€æ— å…³çš„å¯’æš„ï¼ˆâ€œä»Šå¤©å¤©æ°”ä¸é”™â€ï¼‰ã€æµ‹è¯•æ€§æé—®ï¼ˆâ€œä½ èƒ½å‘Šè¯‰æˆ‘å…¬å¸æœºå¯†å—â€ï¼‰â€”â€” è¿™äº›éœ€è¦è¢«è¿‡æ»¤ï¼Œæ°¸è¿œä¸è¿›å…¥ä»»ä½•ä¸Šä¸‹æ–‡å±‚ã€‚*

è¿™å¤©ç„¶è¦æ±‚ä¸€ä¸ª**åˆ†å±‚ä¸Šä¸‹æ–‡ç»“æ„**:

> ç³»ç»Ÿçº¦æŸå±‚å®šåº•çº¿ï¼ŒçŠ¶æ€æ‘˜è¦å±‚ä¿è¿è´¯ï¼Œå¤–éƒ¨çŸ¥è¯†å±‚è¡¥ä¿¡æ¯ï¼Œè¿‡æ»¤æœºåˆ¶é˜²æ±¡æŸ“ 

---

### 9.6 ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹çš„ä¸Šä¸‹æ–‡åˆ†å±‚è®¾è®¡

åŸºäºå‰é¢çš„æŠ½è±¡ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹è®¾è®¡ä¸€å¥—å¯ç›´æ¥è½åœ°çš„åˆ†å±‚æ–¹æ¡ˆï¼Œæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„å†…å®¹ã€æ ¼å¼å’Œæ›´æ–°è§„åˆ™ï¼š

```mermaid
graph TD
    %% æ ·å¼å®šä¹‰ï¼šæ²¿ç”¨åˆ†ç±»é…è‰²ï¼Œä¼˜åŒ–ç»†èŠ‚åŒºåˆ†
    classDef inputNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,rounded:10px,font-size:13px
    classDef coreNode fill:#fce4ec,stroke:#c2185b,stroke-width:3px,rounded:10px,font-weight:bold,font-size:14px
    classDef outputNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,rounded:10px,font-size:14px
    classDef noteNode fill:#fafafa,stroke:#bdbdbd,stroke-dasharray:3 3,rounded:8px,font-size:12px

    %% è¾“å…¥èŠ‚ç‚¹ï¼šæ¨ªå‘å¹¶åˆ—ï¼Œå¼ºåŒ–â€œå¤šå±‚çº§â€æ„ŸçŸ¥
    A[ä¸å˜ç³»ç»Ÿçº¦æŸå±‚<br/>System Constraint Layer<br/>ï¼ˆRole+æ ¸å¿ƒè§„åˆ™ï¼Œç¡®ä¿ç¨³å®šæ€§ï¼‰]:::inputNode --> F[ä¸Šä¸‹æ–‡æ„å»ºå™¨<br/>Context Builder<br/>ï¼ˆæ•´åˆ+æ ¡éªŒ+Tokenæ§åˆ¶ï¼‰]:::coreNode
    B[ä¼šè¯çŠ¶æ€æ‘˜è¦å±‚<br/>Session State Layer<br/>ï¼ˆç”¨æˆ·ä¿¡æ¯+å¯¹è¯å…±è¯†ï¼Œä¿éšœè¿è´¯æ€§ï¼‰]:::inputNode --> F
    C[æœ€è¿‘ N è½®å¯¹è¯å±‚<br/>Recent Conversation Layer<br/>ï¼ˆ5-10è½®å…³é”®äº¤äº’ï¼Œä¿ç•™è¯­å¢ƒï¼‰]:::inputNode --> F
    D[æ£€ç´¢çŸ¥è¯†æ³¨å…¥å±‚<br/>Retrieval Knowledge Layer<br/>ï¼ˆæ”¿ç­–ç‰‡æ®µ+æ¥æºæ ‡æ³¨ï¼Œæå‡å‡†ç¡®æ€§ï¼‰]:::inputNode --> F

    %% æœ€ç»ˆè¾“å‡ºï¼šæ˜ç¡®æŒ‡å‘ LLM è¾“å…¥
    F --> G[LLM æœ€ç»ˆè¾“å…¥<br/>Final LLM Input<br/>ï¼ˆç»“æ„åŒ–+å¯æ§ Token èŒƒå›´ï¼‰]:::outputNode

    %% æ ¸å¿ƒæ³¨è§£ï¼šç‚¹æ˜å¤šå±‚çº§èåˆä»·å€¼
    note[ğŸ“Œ æ ¸å¿ƒé€»è¾‘ï¼šå¤šå±‚çº§ä¿¡æ¯åˆ†å±‚æ³¨å…¥ï¼Œå…¼é¡¾ç¨³å®šæ€§ã€è¿è´¯æ€§ã€å‡†ç¡®æ€§]:::noteNode
    F -.-> note  

    %% ç®­å¤´æ ·å¼ï¼šå¼ºåŒ–å±‚çº§å…³ç³»ä¸æ ¸å¿ƒé“¾è·¯
    linkStyle 0 stroke:#616161,stroke-width:1.5px,stroke-linecap:round
    linkStyle 1 stroke:#616161,stroke-width:1.5px,stroke-linecap:round
    linkStyle 2 stroke:#616161,stroke-width:1.5px,stroke-linecap:round
    linkStyle 3 stroke:#616161,stroke-width:1.5px,stroke-linecap:round
    linkStyle 4 stroke:#c2185b,stroke-width:2.5px,stroke-linecap:round
```

![](/imgs/column/llm/14-2.webp)

è¿™é‡Œæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®èŒè´£ï¼š

#### 1. ä¸å˜ç³»ç»Ÿçº¦æŸå±‚ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

- **æ ¸å¿ƒå†…å®¹**ï¼šæ˜ç¡®ç³»ç»Ÿè§’è‰²ã€è¡Œä¸ºè¾¹ç•Œã€å®‰å…¨è§„åˆ™ï¼Œæ ¼å¼å›ºå®šï¼Œä¸éšå¯¹è¯å˜åŒ–ï¼›
- **ç¤ºä¾‹å†™æ³•**ï¼š
  ```text
  ä½ æ˜¯XXå…¬å¸å†…éƒ¨çŸ¥è¯†åº“åŠ©æ‰‹ï¼Œä»…ä¸ºå‘˜å·¥æä¾›æ”¿ç­–å’¨è¯¢æœåŠ¡ã€‚
  æ ¸å¿ƒè§„åˆ™ï¼š
  1. ä»…ä½¿ç”¨æä¾›çš„ä¼ä¸šæ”¿ç­–æ–‡æ¡£å›ç­”ï¼Œç¦æ­¢å¼•å…¥å¤–éƒ¨çŸ¥è¯†ã€å¸¸è¯†æˆ–ä¸ªäººæ¨æ–­ï¼›
  2. æ‰€æœ‰å›ç­”å¿…é¡»æ ‡æ³¨æ”¿ç­–æ¥æºï¼ˆå¦‚ã€Š2024å·®æ—…æ”¿ç­–ã€‹3.2æ¡ï¼‰ï¼Œæ— æ˜ç¡®æ¥æºçš„ä¿¡æ¯éœ€å›ç­”â€œä¸çŸ¥é“â€ï¼›
  3. ç¦æ­¢æ³„éœ²æœªå…¬å¼€æ”¿ç­–ã€å‘˜å·¥ä¸ªäººä¿¡æ¯ã€å•†ä¸šæœºå¯†ï¼›
  4. æ‹’ç»å›ç­”ä¸å…¬å¸æ”¿ç­–æ— å…³çš„é—®é¢˜ï¼ˆå¦‚ç«å“ä¿¡æ¯ã€ç§äººé—®é¢˜ï¼‰ã€‚
  ```
- **æ›´æ–°è§„åˆ™**ï¼šä»…å½“å…¬å¸æ”¿ç­–å‘ç”Ÿé‡å¤§å˜æ›´æ—¶æ‰‹åŠ¨æ›´æ–°ï¼Œå¹³æ—¶æ°¸ä¹…å›ºå®šã€‚

#### 2. ä¼šè¯çŠ¶æ€æ‘˜è¦å±‚ï¼ˆä¸­é«˜ä¼˜å…ˆçº§ï¼‰

- **æ ¸å¿ƒå†…å®¹**ï¼šæç‚¼å¯¹è¯ä¸­â€œå¯¹åç»­å†³ç­–æœ‰ç”¨çš„å…³é”®ä¿¡æ¯â€ï¼Œç»“æ„åŒ–å­˜å‚¨ï¼Œé¿å…å†—ä½™ï¼›
- **æ¨èå­—æ®µ**ï¼š
  ```text
  ã€ä¼šè¯çŠ¶æ€ã€‘
  - ç”¨æˆ·ä¿¡æ¯ï¼šå§“åï¼ˆå¯é€‰ï¼‰ã€éƒ¨é—¨ï¼ˆé”€å”®éƒ¨ï¼‰ã€æ ¸å¿ƒè¯‰æ±‚ï¼ˆå’¨è¯¢2024å·®æ—…æŠ¥é”€ç›¸å…³é—®é¢˜ï¼‰ï¼›
  - å·²ç¡®è®¤äº‹å®ï¼š1. ç”¨æˆ·éœ€é¢‘ç¹å‡ºå·®è‡³åä¸œåœ°åŒºï¼›2. å·²äº†è§£å›½å†…å·®æ—…ä½å®¿æ ‡å‡†ï¼ˆä¸€çº¿åŸå¸‚800å…ƒ/æ™šï¼‰ï¼›
  - å¾…è§£å†³é—®é¢˜ï¼š1. æµ·å¤–å·®æ—…ä½å®¿æ ‡å‡†ï¼›2. æŠ¥é”€å®¡æ‰¹æ—¶æ•ˆï¼›
  - å·²æ‹’ç»éœ€æ±‚ï¼šæ— ï¼ˆæœªæ¶‰åŠæ— å…³é—®é¢˜ï¼‰ã€‚
  ```
- **æ›´æ–°è§„åˆ™**ï¼šæ¯è½®å¯¹è¯ç»“æŸåï¼Œè°ƒç”¨ LLM å¯¹æ¯”æ–°äº¤äº’å†…å®¹ä¸å½“å‰çŠ¶æ€ï¼Œè‡ªåŠ¨æ–°å¢/ä¿®æ”¹/åˆ é™¤å­—æ®µï¼ˆæ¯”å¦‚ç”¨æˆ·è§£å†³â€œå®¡æ‰¹æ—¶æ•ˆâ€åï¼Œä»â€œå¾…è§£å†³â€ç§»è‡³â€œå·²ç¡®è®¤â€ï¼‰ã€‚

#### 3. æœ€è¿‘ N è½®å¯¹è¯å±‚ï¼ˆä¸­ä½ä¼˜å…ˆçº§ï¼‰

- **æ ¸å¿ƒå†…å®¹**ï¼šä¿ç•™æœ€è¿‘5-10è½®çš„å…³é”®äº¤äº’ï¼Œè¿‡æ»¤å¯’æš„ã€é‡å¤æé—®ç­‰æ— æ•ˆä¿¡æ¯ï¼›
- **N å€¼é€‰æ‹©ä¾æ®**ï¼š
  - æ¨¡å‹çª—å£å¤§å°ï¼ˆæ¯”å¦‚ GPT-3.5 4k token é€‰5è½®ï¼ŒGPT-4 8k token é€‰10è½®ï¼‰ï¼›
  - å¯¹è¯å¯†åº¦ï¼ˆæ–‡å­—å¯†é›†å‹å¯¹è¯é€‰5è½®ï¼ŒçŸ­å¥äº¤äº’é€‰10è½®ï¼‰ï¼›
- **ç¤ºä¾‹ç‰‡æ®µ**ï¼š
  ```json
  [
    {"role": "user", "content": "æˆ‘æ˜¯é”€å”®éƒ¨çš„ï¼Œç»å¸¸å»ä¸Šæµ·å‡ºå·®ï¼Œæƒ³äº†è§£2024å¹´å·®æ—…æŠ¥é”€æ ‡å‡†"},
    {"role": "assistant", "content": "æ ¹æ®ã€Š2024å·®æ—…æ”¿ç­–ã€‹3.2æ¡ï¼Œå›½å†…ä¸€çº¿åŸå¸‚ä½å®¿æ ‡å‡†ä¸º800å…ƒ/æ™šï¼Œä¸Šæµ·å±äºä¸€çº¿åŸå¸‚ï¼Œä½ å¯æŒ‰æ­¤æ ‡å‡†æŠ¥é”€"}
  ]
  ```
- **æ›´æ–°è§„åˆ™**ï¼šæ¯è½®å¯¹è¯åè‡ªåŠ¨æ»‘åŠ¨ï¼Œç§»é™¤æœ€æ—©çš„å†…å®¹ï¼›å½“ token æ¥è¿‘ä¸Šé™æ—¶ï¼Œä¼˜å…ˆä¿ç•™ç”¨æˆ·æé—®å’Œæ ¸å¿ƒå›ç­”ï¼Œè¿‡æ»¤æ— å…³ç»†èŠ‚ã€‚

#### 4. æ£€ç´¢çŸ¥è¯†æ³¨å…¥å±‚ï¼ˆä¸´æ—¶ä¼˜å…ˆçº§ï¼‰

- **æ ¸å¿ƒå†…å®¹**ï¼šä»…å½“å½“å‰é—®é¢˜éœ€è¦ç‰¹å®šæ”¿ç­–ç‰‡æ®µæ—¶æ³¨å…¥ï¼Œæ ¼å¼è§„èŒƒï¼Œæ ‡æ³¨æ¥æºï¼›
- **ç¤ºä¾‹å†™æ³•**ï¼š
  ```text
  ã€å‚è€ƒçŸ¥è¯†ã€‘
  æ¥æºï¼šã€Š2024å·®æ—…æ”¿ç­–ã€‹4.3æ¡
  æ ¸å¿ƒå†…å®¹ï¼šæµ·å¤–å·®æ—…ä½å®¿æ ‡å‡†æŒ‰ç›®çš„åœ°å›½å®¶/åœ°åŒºåˆ†çº§ï¼Œæ¬§ç¾å‘è¾¾å›½å®¶ä¸º1500å…ƒ/æ™šï¼Œä¸œå—äºšå›½å®¶ä¸º1000å…ƒ/æ™šï¼Œéœ€æå‰3ä¸ªå·¥ä½œæ—¥æäº¤å‡ºå·®ç”³è¯·ã€‚
  ```
- **æ›´æ–°è§„åˆ™**ï¼šéšå½“å‰é—®é¢˜åŠ¨æ€æ³¨å…¥ï¼Œä¸‹ä¸€è½®å¯¹è¯è‹¥ä¸æ¶‰åŠç›¸å…³ä¸»é¢˜ï¼Œè‡ªåŠ¨ç§»é™¤ï¼›è‹¥æ¶‰åŠåŒä¸€ä¸»é¢˜ï¼Œå¯æ›´æ–°è¡¥å……æ–°çš„çŸ¥è¯†ç‰‡æ®µã€‚

---

### 9.7 ä¸€ä¸ªæœ€å°å¯ç”¨çš„ä¸Šä¸‹æ–‡æ„å»ºç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰

åŸºäºä¸Šè¿°åˆ†å±‚è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªæœ€å°å¯ç”¨çš„ä¸Šä¸‹æ–‡æ„å»ºå‡½æ•°ã€‚è¿™æ®µä»£ç çš„æ ¸å¿ƒä¸æ˜¯è¯­æ³•ï¼Œè€Œæ˜¯èƒŒåçš„å·¥ç¨‹æ€æƒ³â€”â€”æ¯ä¸€æ­¥éƒ½ä½“ç°äº†â€œåˆ†å±‚ã€å¯æ§ã€åŠ¨æ€â€çš„åŸåˆ™ï¼š

```python
def build_context(
    system_constraints: str,  # ä¸å˜ç³»ç»Ÿçº¦æŸå±‚ï¼ˆå¿…ä¼ ï¼‰
    conversation_state: str,  # ä¼šè¯çŠ¶æ€æ‘˜è¦å±‚ï¼ˆå¯é€‰ï¼Œé»˜è®¤ç©ºï¼‰
    recent_messages: list,    # æœ€è¿‘Nè½®å¯¹è¯å±‚ï¼ˆå¿…ä¼ ï¼‰
    retrieved_docs: str       # æ£€ç´¢çŸ¥è¯†æ³¨å…¥å±‚ï¼ˆå¯é€‰ï¼Œé»˜è®¤ç©ºï¼‰
) -> list:
    """
    æ„å»ºä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹çš„LLMè¾“å…¥ä¸Šä¸‹æ–‡
    è®¾è®¡åŸåˆ™ï¼šé«˜ä¼˜å…ˆçº§ä¿¡æ¯å‰ç½®ï¼Œä½ä¼˜å…ˆçº§ä¿¡æ¯åŠ¨æ€è°ƒæ•´
    """
    messages = []

    # 1. ä¸å˜ç³»ç»Ÿçº¦æŸå±‚ï¼šç”¨systemè§’è‰²ç¡®ä¿æœ€é«˜ä¼˜å…ˆçº§ï¼Œä¸è¢«æ³¨æ„åŠ›è¡°å‡å½±å“
    messages.append({
        "role": "system",
        "content": f"ã€ç³»ç»Ÿçº¦æŸã€‘\n{system_constraints}"
    })

    # 2. ä¼šè¯çŠ¶æ€æ‘˜è¦å±‚ï¼šåŒæ ·ç”¨systemè§’è‰²ï¼Œç´§è·Ÿçº¦æŸä¹‹åï¼Œç¡®ä¿æ¨¡å‹ä¼˜å…ˆè¯»å–
    if conversation_state.strip():
        messages.append({
            "role": "system",
            "content": f"ã€ä¼šè¯çŠ¶æ€ã€‘\n{conversation_state}"
        })
    else:
        # çŠ¶æ€ä¸ºç©ºæ—¶ï¼ˆé¦–æ¬¡å¯¹è¯ï¼‰ï¼Œæ’å…¥é»˜è®¤æç¤ºï¼Œé¿å…æ¨¡å‹å›°æƒ‘
        messages.append({
            "role": "system",
            "content": "ã€ä¼šè¯çŠ¶æ€ã€‘\nç”¨æˆ·ä¸ºæ–°ç”¨æˆ·ï¼Œå°šæœªç¡®è®¤å…³é”®ä¿¡æ¯ï¼Œéœ€æ ¹æ®æé—®é€æ­¥è¡¥å……ã€‚"
        })

    # 3. æœ€è¿‘Nè½®å¯¹è¯å±‚ï¼šæ§åˆ¶é•¿åº¦ï¼Œä¿ç•™æœ€è¿‘5-10è½®ï¼Œé¿å…å†—ä½™
    # åŠ¨æ€æˆªæ–­é€»è¾‘ï¼šä¼˜å…ˆä¿ç•™æœ€è¿‘5è½®ï¼Œè‹¥tokenæ•°ä»è¶…æ ‡ï¼Œå†ç¼©å‡è‡³3è½®
    max_recent_rounds = 5
    truncated_messages = recent_messages[-max_recent_rounds:]
    # ï¼ˆå®é™…å·¥ç¨‹ä¸­éœ€æ·»åŠ tokenè®¡æ•°é€»è¾‘ï¼Œæ­¤å¤„ç®€åŒ–ï¼‰
    messages.extend(truncated_messages)

    # 4. æ£€ç´¢çŸ¥è¯†æ³¨å…¥å±‚ï¼šæŒ‰éœ€æ³¨å…¥ï¼Œç”¨systemè§’è‰²æ ‡æ³¨ï¼Œæ˜ç¡®ä¸ºå‚è€ƒèµ„æ–™
    if retrieved_docs.strip():
        # æ ¼å¼è§„èŒƒï¼šæ ‡æ³¨æ¥æº+æ ¸å¿ƒå†…å®¹ï¼Œä¾¿äºæ¨¡å‹å¼•ç”¨
        formatted_docs = f"ã€å‚è€ƒçŸ¥è¯†ã€‘\n{retrieved_docs}\nè¯·ä¸¥æ ¼åŸºäºä¸Šè¿°çŸ¥è¯†å›ç­”ï¼Œæ ‡æ³¨å¯¹åº”æ¥æºã€‚"
        messages.append({
            "role": "system",
            "content": formatted_docs
        })

    # å·¥ç¨‹å…³é”®ï¼šè¿”å›å‰æ£€æŸ¥æ€»tokenæ•°ï¼Œç¡®ä¿ä¸è¶…è¿‡æ¨¡å‹çª—å£ä¸Šé™
    # ï¼ˆå®é™…å·¥ç¨‹ä¸­éœ€æ·»åŠ tokenè®¡ç®—å’Œæˆªæ–­é€»è¾‘ï¼Œä¼˜å…ˆç æ£€ç´¢çŸ¥è¯†å’Œæœ€è¿‘å¯¹è¯ï¼‰
    return messages
```

è¯´æ˜ï¼š

1. **è§’è‰²é€‰æ‹©æŠ€å·§**ï¼šç³»ç»Ÿçº¦æŸå’ŒçŠ¶æ€æ‘˜è¦ç”¨`system`è§’è‰²ï¼Œè€Œä¸æ˜¯`user`æˆ–`assistant`â€”â€”å› ä¸º`system`è§’è‰²çš„ä¿¡æ¯åœ¨æ¨¡å‹å¤„ç†ä¸­ä¼˜å…ˆçº§æ›´é«˜ï¼Œèƒ½æœ‰æ•ˆæŠµæŠ—æ³¨æ„åŠ›è¡°å‡ï¼›
2. **åŠ¨æ€æˆªæ–­é€»è¾‘**ï¼šæœ€è¿‘å¯¹è¯çš„â€œNè½®â€ä¸æ˜¯å›ºå®šå€¼ï¼Œè€Œæ˜¯æ ¹æ®tokenæ•°åŠ¨æ€è°ƒæ•´ï¼Œé¿å…ç¡¬ç¼–ç å¯¼è‡´çš„çª—å£æº¢å‡ºï¼›
3. **å¼‚å¸¸å¤„ç†**ï¼šè€ƒè™‘åˆ°â€œé¦–æ¬¡å¯¹è¯æ— çŠ¶æ€â€â€œæ— æ£€ç´¢çŸ¥è¯†â€ç­‰åœºæ™¯ï¼Œè¡¥å……é»˜è®¤é€»è¾‘ï¼Œé¿å…æ¨¡å‹å› è¾“å…¥ä¸å®Œæ•´è€Œäº§ç”Ÿå¹»è§‰ï¼›
4. **æ ¼å¼è§„èŒƒ**ï¼šæ¯å±‚ä¿¡æ¯éƒ½æœ‰æ˜ç¡®çš„æ ‡ç­¾ï¼ˆã€ç³»ç»Ÿçº¦æŸã€‘ã€ä¼šè¯çŠ¶æ€ã€‘ï¼‰ï¼Œå¸®åŠ©æ¨¡å‹åŒºåˆ†ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼Œå‡å°‘æ··æ·†ã€‚


é‡ç‚¹æ³¨æ„ï¼Œè¿™æ®µä»£ç çœŸæ­£é‡è¦çš„ä¸æ˜¯â€œæ€ä¹ˆå†™â€ï¼Œè€Œæ˜¯å®ƒä½“ç°çš„åŸåˆ™ï¼š

> **ä¸Šä¸‹æ–‡æ˜¯è¢«è®¾è®¡å‡ºæ¥çš„ç³»ç»Ÿç»“æ„ï¼Œè€Œä¸æ˜¯å‰¯äº§å“ã€‚**

---

### 9.8 æœ¬ç« å°ç»“ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹å†³å®šç³»ç»Ÿâ€œèƒ½è·‘å¤šè¿œâ€

é€šè¿‡è¿™ä¸€ç« ï¼Œä½ åº”è¯¥å·²ç»å½¢æˆè¿™æ ·çš„æ ¸å¿ƒè®¤çŸ¥ï¼š

* å¤šè½®å¯¹è¯å¤±æ§ä¸æ˜¯å¶ç„¶ï¼Œä¹Ÿä¸æ˜¯â€œPrompt æŠ€å·§ä¸è¶³â€ï¼Œè€Œæ˜¯**ä¸Šä¸‹æ–‡æ²¡æœ‰è¢«å½“ä½œä¸€ç­‰å·¥ç¨‹å¯¹è±¡æ¥è®¾è®¡**â€”â€”æ²¡æœ‰åˆ†å±‚ã€æ²¡æœ‰ä¼˜å…ˆçº§ã€æ²¡æœ‰åŠ¨æ€ç®¡ç†ï¼Œè®©ä½ä»·å€¼ä¿¡æ¯æŒ¤å äº†é«˜ä»·å€¼ä¿¡æ¯çš„ç”Ÿå­˜ç©ºé—´ï¼›
* ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æœ¬è´¨æ˜¯â€œä¿¡æ¯æ²»ç†â€ï¼šé€šè¿‡åˆ†å±‚è®¾è®¡ï¼Œè®©ç³»ç»Ÿçº¦æŸâ€œä¸è¢«é—å¿˜â€ã€å¯¹è¯å…±è¯†â€œä¸è¢«ç¨€é‡Šâ€ã€å†—ä½™ä¿¡æ¯â€œä¸è¢«ä¿ç•™â€ã€å¤–éƒ¨çŸ¥è¯†â€œæŒ‰éœ€æ³¨å…¥â€ï¼›
* è½åœ°ä¸Šä¸‹æ–‡å·¥ç¨‹çš„å…³é”®ï¼Œæ˜¯é…å¥—ä¸‰å¤§æœºåˆ¶ï¼š**åˆ†å±‚ä¿¡æ¯å®šä¹‰æœºåˆ¶**ï¼ˆæ˜ç¡®æ¯å±‚å†…å®¹ï¼‰ã€**çŠ¶æ€åŠ¨æ€æ›´æ–°æœºåˆ¶**ï¼ˆæ¯è½®åˆ·æ–°æ‘˜è¦ï¼‰ã€**é•¿åº¦ç›‘æ§æˆªæ–­æœºåˆ¶**ï¼ˆé¿å…çª—å£æº¢å‡ºï¼‰ã€‚

ä½†ä½ ä¹Ÿåº”è¯¥æ„è¯†åˆ°ä¸€ä¸ªæ–°çš„è¾¹ç•Œï¼š

> å³ä½¿ä¸Šä¸‹æ–‡è¢«ç²¾å¿ƒç®¡ç†ï¼Œç³»ç»Ÿä¾ç„¶åªèƒ½å›ç­”â€œæ¨¡å‹å·²çŸ¥æˆ–ä¸Šä¸‹æ–‡å·²æä¾›â€çš„å†…å®¹ã€‚

å½“ç”¨æˆ·çš„é—®é¢˜**è¶…å‡ºä¼ä¸šæ–‡æ¡£è¦†ç›–èŒƒå›´ï¼Œæˆ–éœ€è¦å®æ—¶æ•°æ®æ”¯æ’‘**ï¼ˆæ¯”å¦‚â€œå½“å‰æˆ‘çš„æŠ¥é”€ç”³è¯·å®¡æ‰¹åˆ°å“ªä¸€æ­¥äº†â€ï¼‰æ—¶ï¼Œä»…é ä¸Šä¸‹æ–‡å·¥ç¨‹æ— æ³•è§£å†³â€”â€”æ­¤æ—¶éœ€è¦å¼•å…¥â€œå¤–éƒ¨å·¥å…·â€å’Œâ€œæ£€ç´¢å¢å¼ºâ€ï¼Œè®©ç³»ç»Ÿå…·å¤‡â€œä¸»åŠ¨è·å–ä¿¡æ¯â€çš„èƒ½åŠ›ã€‚

ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†èšç„¦ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ä¸å·¥å…·è°ƒç”¨ï¼Œæ¢è®¨å¦‚ä½•è®©ä¼ä¸šçŸ¥è¯†åº“åŠ©æ‰‹ä»â€œåªèƒ½å›ç­”å·²çŸ¥é—®é¢˜â€ï¼Œå‡çº§ä¸ºâ€œèƒ½è§£å†³æœªçŸ¥é—®é¢˜â€ã€‚