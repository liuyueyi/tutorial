---
order: 1
title: 1.Spring7.0ç‰¹æ€§é¢„è§ˆ
tag:
  - Spring
category:
  - SpringBoot
  - è¿­ä»£
date: 2025-05-30 12:55:36
keywords:
  - Spring
---

Spring å®˜æ–¹å·²ç»å‘å¸ƒäº† Spring Boot 4.0 çš„å¿«ç…§ç‰ˆæœ¬ï¼Œå†…ç½® Spring Framework 7.0ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å¿«é€Ÿé¢„è§ˆä¸€ä¸‹Spring7.0åˆå¸¦æ¥äº†å“ªäº›æ”¹å˜

> ä»¥ä¸‹æ‰€æœ‰å†…å®¹æ¥è‡ªå®˜æ–¹WiKi: [Spring-Framework-7.0-Release-Notes](https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-7.0-Release-Notes)

## 1. æœ€ä½ç¯å¢ƒè¦æ±‚

JDKçš„ç‰ˆæœ¬è¦æ±‚æ²¡æœ‰å˜æ›´ï¼Œ JDK 17-27 å‡æ”¯æŒ

- Jakarta EE 11 (Tomcat 11+)
- Kotlin 2.x
- JSONassert 2.0
- GraalVM 23

## 2. ç§»é™¤çš„API

### 2.1 Spring JCL åœç”¨

`Java Commons Loggingï¼ˆJCLï¼‰` æ˜¯ Apache æä¾›çš„æ—¥å¿—é—¨é¢ï¼ˆFacadeï¼‰ï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ç»Ÿä¸€æ¥å£è°ƒç”¨ä¸åŒåº•å±‚æ—¥å¿—æ¡†æ¶;


### 2.2 ç§»é™¤ `javax.annotation` å’Œ `javax.inject`æ³¨è§£

è¿™ä¸¤ä¸ªåŒ…ä¸‹æˆ‘ä»¬å¸¸è§çš„æ³¨è§£æœ‰ `@Resource` ï¼Œ `@PostConstruct`, `@Inject`ï¼Œè¿™äº›åœ¨SpringBoot2+çš„ç”Ÿæ€ä¸‹ï¼Œåº”è¯¥æ˜¯éå¸¸å¸¸è§çš„ä½¿ç”¨æ³¨è§£äº†ï¼Œå¦‚æœä½ åœ¨SpringBoot4(Spring7)ä¹‹åç»§ç»­ä½¿ç”¨ï¼Œé‚£ä¹ˆéœ€è¦æ”¹æˆ `jakarta.annotation` å’Œ `jakarta.inject packages`ä¸‹çš„ä¾èµ–

### 2.3 è·¯å¾„æ˜ å°„é€‰é¡¹åˆ é™¤

è‡ª 6.0 ç‰ˆæœ¬ä»¥æ¥ï¼Œå¤šä¸ªè·¯å¾„æ˜ å°„é€‰é¡¹å·²è¢«æ ‡è®°ä¸ºåˆ é™¤ã€‚ ä¸‹é¢è¿™äº›é€‰é¡¹ç°å·²è¢«å½»åº•åˆ é™¤ã€‚ å…¶ä¸­åŒ…æ‹¬ï¼š

1. `suffixPatternMatch`/`registeredSuffixPatternMatch` æ³¨è§£æ§åˆ¶æ–¹æ³•

æ§åˆ¶æ˜¯å¦å…è®¸é€šè¿‡ **URL è·¯å¾„åç¼€**ï¼ˆå¦‚ .jsonã€.xmlï¼‰åŒ¹é…æ§åˆ¶å™¨æ–¹æ³•ã€‚
- `suffixPatternMatch=true`ï¼šå…è®¸é€šè¿‡åç¼€åŒ¹é…ï¼ˆä¾‹å¦‚ /data.json æ˜ å°„åˆ° @RequestMapping("/data")ï¼‰ã€‚
- `registeredSuffixPatternMatch=true`ï¼šä»…å…è®¸åŒ¹é…å·²æ³¨å†Œçš„åç¼€ï¼ˆéœ€é…åˆ ContentNegotiationManager é…ç½®ï¼‰ã€‚

ä¸€ä¸ªç®€å•ä½¿ç”¨åœºæ™¯

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configurePathMatch(PathMatchConfigurer configurer) {
        configurer.setUseSuffixPatternMatch(true) // å¯ç”¨åç¼€åŒ¹é…
                  .setUseRegisteredSuffixPatternMatch(true); // ä»…åŒ¹é…å·²æ³¨å†Œåç¼€
    }
}
```

**æ³¨æ„**ï¼š
- å¯ç”¨åç¼€åŒ¹é…å¯èƒ½å¯¼è‡´å®‰å…¨é£é™©ï¼ˆå¦‚é€šè¿‡ .jsp è®¿é—®æœªæˆæƒèµ„æºï¼‰ï¼Œå»ºè®®ç»“åˆç™½åå•ä½¿ç”¨ã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒregisteredSuffixPatternMatch ä¸º falseã€‚

2. `trailingSlashMatch` ï¼ˆAbstractHandlerMapping æ‰©å±•ï¼‰

**ä½œç”¨**ï¼š
æ§åˆ¶æ˜¯å¦å¿½ç•¥ URL æœ«å°¾çš„æ–œæ ï¼ˆ/ï¼‰ã€‚
- trailingSlashMatch=trueï¼š/path å’Œ /path/ è§†ä¸ºåŒä¸€è·¯å¾„ã€‚
- trailingSlashMatch=falseï¼šä¸¥æ ¼åŒºåˆ†æœ«å°¾æ–œæ ã€‚

```java
@Override
public void configurePathMatch(PathMatchConfigurer configurer) {
    configurer.setUseTrailingSlashMatch(false); // ä¸¥æ ¼åŒ¹é…æœ«å°¾æ–œæ 
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
Spring Boot 2.3+ é»˜è®¤ç¦ç”¨æœ«å°¾æ–œæ åŒ¹é…ï¼Œéœ€æ‰‹åŠ¨å¯ç”¨ã€‚

3. å†…å®¹åå•†é…ç½®

**favorPathExtension / ignoreUnknownPathExtensions**

*ä½œç”¨*ï¼š
- favorPathExtension=trueï¼šä¼˜å…ˆé€šè¿‡ URL åç¼€ï¼ˆå¦‚ .jsonï¼‰å†³å®šå“åº”å†…å®¹ç±»å‹ã€‚
- ignoreUnknownPathExtensions=trueï¼šå¿½ç•¥æœªè¯†åˆ«çš„åç¼€ï¼ˆè¿”å›é»˜è®¤å†…å®¹ç±»å‹ï¼‰ã€‚

*å…³è”ç­–ç•¥ç±»*ï¼š
- PathExtensionContentNegotiationStrategyï¼šåŸºäºè·¯å¾„åç¼€åå•†ã€‚
- ServletPathExtensionContentNegotiationStrategyï¼šåŸºäº Servlet å®¹å™¨ç‰¹æ€§åå•†ã€‚

*Java Config ç¤ºä¾‹*ï¼š

```java
@Bean
public ContentNegotiationManagerFactoryBean contentNegotiationManager() {
    ContentNegotiationManagerFactoryBean factory = new ContentNegotiationManagerFactoryBean();
    factory.setFavorPathExtension(true);
    factory.setIgnoreUnknownExtensions(true);
    return factory;
}
```

*MVC Java Config*

```
@Override
public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
    configurer.favorPathExtension(true)
              .ignoreUnknownExtensions(true);
}
```


4. è·¯å¾„æ¨¡å¼è§£æé…ç½®

**`matchOptionalTrailingSeparator` in `PathPatternParser`**


*ä½œç”¨*ï¼š
æ§åˆ¶è·¯å¾„åŒ¹é…æ—¶æ˜¯å¦å…è®¸å¯é€‰çš„å°¾éƒ¨æ–œæ ã€‚
- trueï¼š/path å’Œ /path/ åŒ¹é…åŒä¸€æ§åˆ¶å™¨æ–¹æ³•ã€‚
- falseï¼šä¸¥æ ¼åŒºåˆ†å°¾éƒ¨æ–œæ ã€‚

*é…ç½®ç¤ºä¾‹*ï¼ˆSpring Boot 2.3+ï¼‰

```properties
# application.properties
spring.mvc.pathmatch.matching-strategy=ant_path_matcher
```

éœ€é…åˆ PathPatternParser ä½¿ç”¨ï¼ˆé»˜è®¤ç­–ç•¥ä¸º AntPathMatcherï¼‰


## 3.å¼ƒç”¨

1. Spring MVC çš„ `<mvc:*>` XML é…ç½®å‘½åç©ºé—´ç°å·²å¼ƒç”¨ï¼Œæ¨èæ”¹ç”¨ Java é…ç½®æ–¹å¼ã€‚ç›®å‰æš‚æ— å®Œå…¨ç§»é™¤ XML é…ç½®çš„è®¡åˆ’ï¼Œä½†åç»­æ›´æ–°å°†ä¸å†é€‚é… Java é…ç½®æ¨¡å‹ã€‚å…¶ä»–å‘½åç©ºé—´ï¼ˆå¦‚ `<bean>`ï¼‰æœªå¼ƒç”¨ã€‚
2. Kotlin å›¢é˜Ÿè®¡åˆ’åœ¨æœªæ¥çš„ Kotlin 2.x ç‰ˆæœ¬ä¸­ç§»é™¤å¯¹ JSR 223 çš„æ”¯æŒï¼Œå› æ­¤ Spring ä¸­é’ˆå¯¹ Kotlin è„šæœ¬çš„æ¨¡æ¿åŠŸèƒ½å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ã€‚
3. Spring TestContext Framework å¯¹ JUnit 4 çš„æ”¯æŒå·²å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ JUnit Jupiter çš„ SpringExtensionã€‚  
	å¼ƒç”¨çš„ç±»åŒ…æ‹¬ï¼š  
	- SpringRunner  
	- SpringClassRule  
	- SpringMethodRule  
	- AbstractJUnit4SpringContextTests  
	- AbstractTransactionalJUnit4SpringContextTestsåŠç›¸å…³æ”¯æŒç±»ã€‚
4. Jackson 2.x çš„æ”¯æŒå·²å¼ƒç”¨ï¼Œæ¨èè¿ç§»åˆ° Jackson 3.x

## 4. Nullå®‰å…¨

æ–°ç‰ˆæœ¬é‡‡ç”¨ JSpecify æ³¨è§£æ¥å£°æ˜ API çš„ç©ºå€¼å®‰å…¨æ€§ï¼Œä½¿ç”¨ @Nullable è¡¨ç¤ºå¯ä¸º Nullï¼Œä½¿ç”¨ @NonNull è¡¨ç¤ºä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”ä¼šé€šè¿‡ Idea é…åˆæç¤ºè­¦å‘Šæˆ–é”™è¯¯ä¿¡æ¯ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š

```java
import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;

public class Person {
    private String name;

    public void setName(@NonNull String name) {
        this.name = name;
    }

    @Nullable
    public String getName() {
        return this.name;
    }
}
```

## 5. HTTPä»£ç†

æ–°ç‰ˆæœ¬æä¾›äº† @ImportHttpServices æ³¨è§£ï¼Œè®©ä½ ä¸º HTTP æ¥å£åˆ›å»ºä»£ç†æ›´åŠ å®¹æ˜“ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼ˆå®ƒå…è®¸æ‚¨è½»æ¾å£°æ˜ã€æ£€æµ‹å’Œé…ç½®æ•´ä¸ª HTTP æœåŠ¡ç»„ï¼‰ï¼š

```java
@Configuration(proxyBeanMethods = false)
@ImportHttpServices(group = "weather", types = {FreeWeather.class, CommercialWeather.class})
@ImportHttpServices(group = "user", types = {UserServiceInternal.class, UserServiceOfficial.class})
static class HttpServicesConfiguration extends AbstractHttpServiceRegistrar {

	@Bean
	public RestClientHttpServiceGroupConfigurer groupConfigurer() {
		return groups -> groups.filterByName("weather", "user")
				.configureClient((group, builder) -> builder.defaultHeader("User-Agent", "My-Application"));
	}

}
```

## 6. Beanæ³¨å…¥

Bean æ³¨å†Œå™¨å®ç°ä½¿ç”¨ BeanRegistry å’Œ Environment APIï¼Œä»¥ç®€æ´çµæ´»çš„æ–¹å¼é€šè¿‡ç¼–ç¨‹æ–¹å¼æ³¨å†Œ Beanã€‚ä¾‹å¦‚ï¼Œå®ƒå…è®¸é€šè¿‡ if è¡¨è¾¾å¼ã€for å¾ªç¯ç­‰è¿›è¡Œè‡ªå®šä¹‰æ³¨å†Œã€‚


åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨Configurationæ¥æ³¨å†Œbeanï¼Œå¦‚


```java
@Configuration
@Import(MyBeanRegistrar.class)
class MyConfiguration {
}
```

ç°åœ¨åˆ™å¯ä»¥é€šè¿‡å®ç°`BeanRegistrar`æ¥å®ç°æ›´çµæ´»çš„beanæ³¨å†Œ

```java
class MyBeanRegistrar implements BeanRegistrar {

    @Override
    public void register(BeanRegistry registry, Environment env) {
        registry.registerBean("foo", Foo.class);
        registry.registerBean("bar", Bar.class, spec -> spec
                .prototype()
                .lazyInit()
                .description("Custom description")
                .supplier(context -> new Bar(context.bean(Foo.class))));
        if (env.matchesProfiles("baz")) {
            registry.registerBean(Baz.class, spec -> spec
                    .supplier(context -> new Baz("Hello World!")));
        }
    }
}
```


## 7. æ¥å£ç‰ˆæœ¬æ§åˆ¶

æ–°ç‰ˆæœ¬å¼•å…¥äº†ä¼˜é›…çš„ API ç‰ˆæœ¬æ§åˆ¶æ”¯æŒï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ @RequestMapping æ³¨è§£ä¸­çš„ version å‚æ•°æ¥å®ç°ç‰ˆæœ¬æ§åˆ¶ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º

> https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-7.0-Release-Notes


```java
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/account/{id}")
public class AccountController {

	// 1
	@GetMapping  
	public Account getAccount() {
	}

	// 2
	@GetMapping(version = "1.1") 
	public Account getAccount1_1() {
	}

	// 3
	@GetMapping(version = "1.2+") 
	public Account getAccount1_2() {
	}

	// 4
	@GetMapping(version = "1.5") 
	public Account getAccount1_5() {
	}
}
```

1. åŒ¹é…ä»»ä½•ç‰ˆæœ¬
2. åŒ¹é… version 1.1
3. åŒ¹é… 1.2 and above
4. åŒ¹é… 1.5

ç„¶åé€šè¿‡è¯·æ±‚å‚æ•°æ¥æ§åˆ¶ä¸åŒçš„ç‰ˆæœ¬ï¼Œv1/v2çš„è¯·æ±‚åˆ†åˆ«ä¸º

- http://localhost:8080/account/1?version=1  getAccount()
- http://localhost:8080/account/1?version=1.1   å¯¹åº” getAccount1_1()
- http://localhost:8080/account/1?version=1.3   å¯¹åº” getAccount1_2()ï¼Œ å› ä¸ºæ²¡æœ‰ç›´æ¥çš„1.3ç‰ˆæœ¬ï¼Œå› æ­¤æ‰¾æœ€è¿‘çš„ä¸€ä¸ªæ»¡è¶³çš„
- http://localhost:8080/account/1?version=1.5   å¯¹åº” getAccount1_5()
- http://localhost:8080/account/1?version=1.6   æ­£å¸¸1ã€3éƒ½å¯ä»¥åŒ¹é…ï¼Œä½†æ˜¯å› ä¸ºæœ‰äº†4å¯¹åº”çš„1.5ç‰ˆæœ¬ï¼Œä½†æ˜¯æ²¡æœ‰1.6ç‰ˆæœ¬ï¼Œåˆ™1ã€3éƒ½æ— æ³•æ­£ç¡®å“åº”ï¼Œè¿”å›400é”™è¯¯
	- è¿™ç§åœºæ™¯è¡¨ç¤ºå½“å‰è¯·æ±‚çš„ç‰ˆæœ¬æ¯”æˆ‘ä»¬æœåŠ¡æä¾›çš„æœ€å¤§ç‰ˆæœ¬è¿˜é«˜ï¼Œä¸å“åº”

## 8.å…¶ä»–ä¼˜åŒ–

1. SPEL è¡¨è¾¾å¼å‡çº§ï¼šSPEL è¡¨è¾¾å¼ä¸­æ”¯æŒç©ºå®‰å…¨å’Œ Elvis è¿ç®—ç¬¦ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š

```java
@Value("#{systemProperties['pop3.port'] ?: 25}")
```

å®ƒè¡¨ç¤ºï¼Œå°†æ³¨å…¥ç³»ç»Ÿå±æ€§ pop3.port çš„å€¼ï¼Œå¦‚æœæœªå®šä¹‰è¯¥å±æ€§å€¼ï¼Œæ³¨å…¥ 25 è¿™ä¸ªå€¼ã€‚

2. GraalVM åŸç”Ÿåº”ç”¨æ”¯æŒï¼šå€ŸåŠ© Spring AOT æŠ€æœ¯ï¼Œå°†åº”ç”¨ç¼–è¯‘æˆåŸç”Ÿé•œåƒï¼Œæå¤§åœ°ç¼©çŸ­äº†å¯åŠ¨æ—¶é—´ã€‚

3. æ”¯æŒ Jackson 3.xï¼šæ”¾å¼ƒå¯¹ Jackson 2.x çš„æ”¯æŒï¼Œå‡çº§ä¸º Jackson 3.xã€‚

4. Servlet å’Œ WebSocket ç‰ˆæœ¬å‡çº§ï¼šä½¿ç”¨ Servlet 6.1 å’Œ WebSocket 2.2 ä½œä¸º Web åº”ç”¨ç¨‹åºçš„åº•å±‚å®ç°ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºåº”è¯¥éƒ¨ç½²åœ¨æœ€æ–°çš„ Servlet å®¹å™¨ä¸Šï¼Œæ¯”å¦‚ Tomcat 11+ å’Œ Jetty 12.1+ã€‚

5. HttpHeaders ä¼˜åŒ–ï¼šHttpHeaders æ“ä½œå¦‚ä¸‹ï¼š

```java
@RestController
public class MyController {

    @GetMapping("/headers")
    public ResponseEntity<String> handleRequest(HttpHeaders headers) {
        // æ—§æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰
        // headers.getFirst("X-Custom-Header");

        // æ–°æ–¹å¼
        String value = headers.firstValue("X-Custom-Header").orElse(null);

        // éå†æ‰€æœ‰å¤´éƒ¨
        headers.forEach((name, values) -> {
            System.out.println(name + ": " + values);
        });

        return ResponseEntity.ok("Processed");
    }
}
```

## 9.å°ç»“

SpringBoot3+éƒ½è¿˜æ²¡å°ä¸Šé²œï¼Œè¿™ä¸‹4.0å°±æ¥äº†ï¼Œè¿˜åœ¨ç”¨java8çš„å°ä¼™ä¼´ï¼Œä½ ä»¬è¿˜å­¦å¾—åŠ¨å—ğŸ˜­

