---
order: 4
title: 4.JPAä¹‹deleteä½¿ç”¨å§¿åŠ¿è¯¦è§£
tag: 
  - JPA
category: 
  - SpringBoot
  - DBç³»åˆ—
  - JPA
date: 2019-07-02 20:03:02
keywords: Spring SpringBoot JPA mysql äº‹åŠ¡ update save
---

å¸¸è§dbä¸­çš„å››ä¸ªæ“ä½œcurdï¼Œå‰é¢çš„å‡ ç¯‡åšæ–‡åˆ†åˆ«ä»‹ç»äº†insertï¼Œupdateï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹deleteçš„ä½¿ç”¨å§¿åŠ¿ï¼Œé€šè¿‡JPAå¯ä»¥æ€æ ·åˆ é™¤æ•°æ®

ä¸€èˆ¬æ¥è®²æ˜¯ä¸å»ºè®®ç‰©ç†åˆ é™¤ï¼ˆç›´æ¥ä»è¡¨ä¸­åˆ é™¤è®°å½•ï¼‰æ•°æ®çš„ï¼Œåœ¨å¦‚ä»Šæ•°æ®å°±æ˜¯é’±çš„æ—¶ä»£ï¼Œæ›´å¸¸è§çš„åšæ³•æ˜¯åœ¨è¡¨ä¸­æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºçŠ¶æ€çš„å­—æ®µï¼Œç„¶åé€šè¿‡ä¿®æ”¹è¿™ä¸ªå­—æ®µæ¥è¡¨ç¤ºè®°å½•æ˜¯å¦æœ‰æ•ˆï¼Œä»è€Œå®ç°é€»è¾‘åˆ é™¤ï¼›è¿™ä¹ˆåšçš„åŸå› å¦‚ä¸‹

- ç‰©ç†åˆ é™¤ï¼Œå¦‚æœå‡ºé—®é¢˜æ¢å¤æ¯”è¾ƒéº»çƒ¦
- æ— æ³•ä¿è¯ä»£ç ä¸€å®šå‡†ç¡®ï¼Œåœ¨å‡ºé—®é¢˜çš„æ—¶å€™ï¼Œåˆ é”™äº†æ•°æ®ï¼Œé‚£å°±ggäº†
- åˆ é™¤æ•°æ®ï¼Œä¼šå¯¼è‡´é‡å»ºç´¢å¼•
- Innodbæ•°æ®åº“å¯¹äºå·²ç»åˆ é™¤çš„æ•°æ®åªæ˜¯æ ‡è®°ä¸ºåˆ é™¤ï¼Œå¹¶ä¸çœŸæ­£é‡Šæ”¾æ‰€å ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œè¿™å°±å¯¼è‡´InnoDBæ•°æ®åº“æ–‡ä»¶ä¸æ–­å¢é•¿ï¼Œä¹Ÿä¼šå¯¼è‡´è¡¨ç¢ç‰‡
- é€»è¾‘åˆ é™¤ï¼Œä¿ç•™æ•°æ®ï¼Œæ–¹ä¾¿åç»­é’ˆå¯¹æ•°æ®çš„æŒ–æ˜æˆ–è€…åˆ†æ

<!-- more -->

## I. ç¯å¢ƒå‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå½“ç„¶å¾—å…ˆå‡†å¤‡å¥½åŸºç¡€ç¯å¢ƒï¼Œå¦‚å®‰è£…æµ‹è¯•ä½¿ç”¨mysqlï¼Œåˆ›å»ºSpringBooté¡¹ç›®å·¥ç¨‹ï¼Œè®¾ç½®å¥½é…ç½®ä¿¡æ¯ç­‰ï¼Œå…³äºæ­å»ºé¡¹ç›®çš„è¯¦æƒ…å¯ä»¥å‚è€ƒå‰ä¸€ç¯‡æ–‡ç«  
- [190612-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹åŸºç¡€ç¯å¢ƒæ­å»º](http://spring.hhui.top/spring-blog/2019/06/12/190612-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/)

ä¸‹é¢ç®€å•çš„çœ‹ä¸€ä¸‹æ¼”ç¤ºæ·»åŠ è®°å½•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦çš„é…ç½®

### 1. è¡¨å‡†å¤‡

æ²¿ç”¨å‰ä¸€ç¯‡çš„è¡¨ï¼Œç»“æ„å¦‚ä¸‹

```sql
CREATE TABLE `money` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `money` int(26) NOT NULL DEFAULT '0' COMMENT 'é’±',
  `is_deleted` tinyint(1) NOT NULL DEFAULT '0',
  `create_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4;
```

### 2. é¡¹ç›®é…ç½®

é…ç½®ä¿¡æ¯ï¼Œä¸ä¹‹å‰æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œæˆ‘ä»¬æ–°å¢äº†æ›´è¯¦ç»†çš„æ—¥å¿—æ‰“å°ï¼›æœ¬ç¯‡ä¸»è¦ç›®æ ‡é›†ä¸­åœ¨æ·»åŠ è®°å½•çš„ä½¿ç”¨å§¿åŠ¿ï¼Œå¯¹äºé…ç½®è¯´æ˜ï¼Œåé¢å•ç‹¬è¿›è¡Œè¯´æ˜

```properties
## DataSource
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/story?useUnicode=true&characterEncoding=UTF-8&useSSL=false
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=
## jpaç›¸å…³é…ç½®
spring.jpa.database=MYSQL
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jackson.serialization.indent_output=true
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
```

### 3. æ•°æ®å‡†å¤‡

æ•°æ®ä¿®æ”¹å˜›ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå‘è¡¨é‡Œé¢æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œç”¨äºåé¢çš„æ“ä½œ

```sql
INSERT INTO `money` (`id`, `name`, `money`, `is_deleted`, `create_at`, `update_at`)
VALUES
	(20, 'jpa ä¸€ç°ç°5', 2323, 0, '2019-07-02 08:42:41', '2019-07-02 08:42:41'),
	(21, 'jpa ä¸€ç°ç°6', 2333, 0, '2019-07-02 08:42:41', '2019-07-02 08:42:41'),
	(22, 'jpa ä¸€ç°ç°7', 6666, 0, '2019-07-02 08:42:41', '2019-07-02 08:42:41'),
	(23, 'jpa ä¸€ç°ç°8', 2666, 0, '2019-07-02 08:42:41', '2019-07-02 08:42:41');
```

![](/imgs/190702/00.jpg)

## II. Deleteä½¿ç”¨æ•™ç¨‹

ä¸‹é¢è°ˆåŠåˆ°çš„åˆ é™¤ï¼Œéƒ½æ˜¯ç‰©ç†åˆ é™¤ï¼Œå¯ä»¥ç†è§£ä¸ºç›´æ¥å°†æŸäº›è®°å½•ä»è¡¨ä¸­æŠ¹é™¤æ‰ï¼ˆå¹¶ä¸æ˜¯è¯´åˆ äº†å°±å®Œå…¨æ²¡æœ‰åŠæ³•æ¢å¤ï¼‰é’ˆå¯¹CURDå››ç§æ“ä½œè€Œè¨€ï¼Œé™¤äº†readä¹‹å¤–ï¼Œå¦å¤–ä¸‰ä¸ªinsert,update,deleteéƒ½ä¼šåŠ å†™é”ï¼ˆä¸€èˆ¬æ¥å°†ä¼šæ¶‰åŠåˆ°è¡Œé”å’Œgapé”ï¼Œä»åé¢ä¹Ÿä¼šçœ‹åˆ°ï¼Œè¿™ä¸‰ä¸ªæ“ä½œè¦æ±‚æ˜¾ç¤ºå£°æ˜äº‹ç‰©ï¼‰

### 1. è¡¨å…³è”POJO

å‰é¢æ’å…¥ç¯‡å·²ç»ä»‹ç»äº†POJOçš„é€æ­¥åˆ›å»ºè¿‡ç¨‹ï¼Œå·²ç»å¯¹åº”çš„æ³¨è§£å«ä¹‰ï¼Œä¸‹é¢ç›´æ¥è´´å‡ºæˆæœ

```java
@Data
@DynamicUpdate
@DynamicInsert
@Entity
@Table(name = "money")
public class MoneyPO {
    @Id
    // å¦‚æœæ˜¯autoï¼Œåˆ™ä¼šæŠ¥å¼‚å¸¸ Table 'mysql.hibernate_sequence' doesn't exist
    // @GeneratedValue(strategy = GenerationType.AUTO)
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Integer id;

    @Column(name = "name")
    private String name;

    @Column(name = "money")
    private Long money;

    @Column(name = "is_deleted")
    private Byte isDeleted;

    @Column(name = "create_at")
    @CreatedDate
    private Timestamp createAt;

    @Column(name = "update_at")
    @CreatedDate
    private Timestamp updateAt;

}
```

ä¸Šé¢ç±»ä¸­çš„å‡ ä¸ªæ³¨è§£ï¼Œè¯´æ˜å¦‚ä¸‹

- `@Data` å±äºlombokæ³¨è§£ï¼Œä¸jpaæ— å…³ï¼Œè‡ªåŠ¨ç”Ÿæˆ`getter/setter/equals/hashcode/tostring`ç­‰æ–¹æ³•
- `@Entity`, `@Table` jpaæ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»ä¸dbçš„è¡¨å…³è”ï¼Œå…·ä½“åŒ¹é…çš„æ˜¯è¡¨ `money`
- `@Id` `@GeneratedValue` ä½œç”¨ä¸è‡ªå¢ä¸»é”®
- `@Column`è¡¨æ˜è¿™ä¸ªå±æ€§ä¸è¡¨ä¸­çš„æŸåˆ—å¯¹åº”
- `@CreateDate`æ ¹æ®å½“å‰æ—¶é—´æ¥ç”Ÿæˆé»˜è®¤çš„æ—¶é—´æˆ³

### 2. Repository APIå£°æ˜

æ¥ä¸‹æ¥æˆ‘ä»¬æ–°å»ºä¸€ä¸ªapiç»§æ‰¿è‡ª`CurdRepository`ï¼Œç„¶åé€šè¿‡è¿™ä¸ªapiæ¥ä¸æ•°æ®åº“æ‰“äº¤é“

```java
public interface MoneyDeleteRepository extends CrudRepository<MoneyPO, Integer> {
    /**
     * æŸ¥è¯¢æµ‹è¯•
     * @param id
     * @return
     */
    List<MoneyPO> queryByIdGreaterThanEqual(int id);
}
```

### 3. ä½¿ç”¨å§¿åŠ¿

å…ˆå†™ä¸€ä¸ªç”¨äºæŸ¥è¯¢æ•°æ®çš„æ–¹æ³•ï¼Œç”¨äºæ ¡éªŒæˆ‘ä»¬æ‰§è¡Œåˆ é™¤ä¹‹åï¼Œæ˜¯å¦ç¡®å®è¢«åˆ é™¤äº†

```java
private void showLeft() {
    List<MoneyPO> records = moneyDeleteRepository.queryByIdGreaterThanEqual(20);
    System.out.println(records);
}
```

åœ¨æ‰§è¡Œä¸‹é¢æ“ä½œä¹‹å‰ï¼Œå…ˆè°ƒç”¨ä¸Šé¢çš„ï¼Œè¾“å‡ºç»“æœå¦‚

```bash
[MoneyPO(id=20, name=jpa ä¸€ç°ç°5, money=2323, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0), MoneyPO(id=21, name=jpa ä¸€ç°ç°6, money=2333, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0), MoneyPO(id=22, name=jpa ä¸€ç°ç°7, money=6666, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0), MoneyPO(id=23, name=jpa ä¸€ç°ç°8, money=2666, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0)]
```

#### a. æ ¹æ®ä¸»é”®idè¿›è¡Œåˆ é™¤

è¿™ç§åº”è¯¥å±äºæœ€å¸¸è§çš„åˆ é™¤æ–¹å¼äº†ï¼Œä¸ºäº†é¿å…è¯¯åˆ ï¼Œé€šè¿‡ç²¾ç¡®çš„ä¸»é”®idæ¥åˆ é™¤è®°å½•ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä½¿ç”¨å§¿åŠ¿ï¼Œ`CrudRepository`è¿™ä¸ªæ¥å£å·²ç»æä¾›äº†å¯¹åº”çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨

```java
private void deleteById() {
    // ç›´æ¥æ ¹æ®idè¿›è¡Œåˆ é™¤
    moneyDeleteRepository.deleteById(21);
    showLeft();
}
```

æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œå¯¹æ¯”å‰é¢çš„è¾“å‡ºå¯ä»¥çŸ¥é“ `id=21` çš„è®°å½•è¢«åˆ é™¤äº†

```bash
[MoneyPO(id=20, name=jpa ä¸€ç°ç°5, money=2323, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0), MoneyPO(id=22, name=jpa ä¸€ç°ç°7, money=6666, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0), MoneyPO(id=23, name=jpa ä¸€ç°ç°8, money=2666, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0)]
```

**ç„¶åä¸€ä¸ªç–‘é—®è‡ªç„¶è€Œç„¶çš„æ¥äº†ï¼Œå¦‚æœè¿™ä¸ªidå¯¹åº”çš„è®°å½•ä¸å­˜åœ¨ï¼Œä¼šæ€æ ·?**

æŠŠä¸Šé¢ä»£ç å†æ‰§è¡Œä¸€æ¬¡ï¼Œå‘ç°æŠ›äº†å¼‚å¸¸

![](/imgs/190702/01.jpg)

ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬debugè¿›å»ï¼Œè°ƒç”¨çš„å®ç°æ˜¯é»˜è®¤çš„ `SimpleJpaRepository`ï¼Œå…¶æºç å¦‚

```java
// ç±»ä¸º: org.springframework.data.jpa.repository.support.SimpleJpaRepository
@Transactional
public void deleteById(ID id) {

	Assert.notNull(id, ID_MUST_NOT_BE_NULL);

	delete(findById(id).orElseThrow(() -> new EmptyResultDataAccessException(
			String.format("No %s entity with id %s exists!", entityInformation.getJavaType(), id), 1)));
}

@Transactional
public void delete(T entity) {

	Assert.notNull(entity, "The entity must not be null!");
	em.remove(em.contains(entity) ? entity : em.merge(entity));
}
```

ä»æºç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ˜¯å…ˆé€šè¿‡idè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœå¯¹åº”çš„è®°å½•ä¸å­˜åœ¨æ—¶ï¼Œç›´æ¥æŠ›å¼‚å¸¸ï¼›å½“å­˜åœ¨æ—¶ï¼Œèµ°removeé€»è¾‘ï¼›

å¦‚æœæˆ‘ä»¬å¸Œæœ›åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œä¸è¦æŠ¥é”™ï¼Œå¯ä»¥æ€ä¹ˆåŠï¼Ÿ

- è‡ªå®šä¹‰å®ç°ä¸€ä¸ªç»§æ‰¿`SimpleJpaRepository`çš„ç±»ï¼Œè¦†ç›–åˆ é™¤æ–¹æ³•

```java
@Repository
@Transactional(readOnly = true)
public class MoneyDeleteRepositoryV2 extends SimpleJpaRepository<MoneyPO, Integer> {

    @Autowired
    public MoneyDeleteRepositoryV2(EntityManager em) {
        this(JpaEntityInformationSupport.getEntityInformation(MoneyPO.class, em), em);
    }

    public MoneyDeleteRepositoryV2(JpaEntityInformation<MoneyPO, ?> entityInformation, EntityManager entityManager) {
        super(entityInformation, entityManager);
    }

    public MoneyDeleteRepositoryV2(Class<MoneyPO> domainClass, EntityManager em) {
        super(domainClass, em);
    }

    @Override
    public void deleteById(Integer id) {
        Optional<MoneyPO> rec = findById(id);
        rec.ifPresent(super::delete);
    }
}
```

ç„¶åå†è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•å°±å¯ä»¥äº†ï¼Œä¸æ¼”ç¤ºå…·ä½“çš„æµ‹è¯•caseäº†ï¼Œæºç å¯ä»¥åˆ°é¡¹ç›®å·¥ç¨‹ä¸­æŸ¥çœ‹ ğŸ‘‰  [æºç ](https://github.com/liuyueyi/spring-boot-demo/tree/master/spring-boot/102-jpa)

#### b. æ¡ä»¶åˆ¤æ–­åˆ é™¤

è™½ç„¶æ ¹æ®idè¿›è¡Œåˆ é™¤æ¯”è¾ƒç¨³å¦¥ï¼Œä½†ä¹Ÿæ— æ³•é¿å…æŸäº›æƒ…å†µä¸‹éœ€è¦æ ¹æ®å…¶ä»–çš„å­—æ®µæ¥åˆ é™¤ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åˆ é™¤åä¸º `jpa ä¸€ç°ç°7`çš„æ•°æ®ï¼Œè¿™æ—¶åˆ™éœ€è¦æˆ‘ä»¬åœ¨`MoneyDeleteRepository`æ–°å¢ä¸€ä¸ªæ–¹æ³•

```java
/**
 * æ ¹æ®nameè¿›è¡Œåˆ é™¤
 *
 * @param name
 */
void deleteByName(String name);
```

è¿™é‡Œæ¯”è¾ƒç®€å•çš„æä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„å‘½åè§„åˆ™ï¼Œåé¢åœ¨æŸ¥è¯¢è¿™ä¸€ç¯‡ä¼šæ›´åŠ è¯¦ç»†çš„è¯´æ˜ï¼›

- `delete` è¡¨ç¤ºæ‰§è¡Œçš„æ˜¯åˆ é™¤æ“ä½œ
- `By` è¡¨ç¤ºæ ¹æ®æŸä¸ªå­—æ®µæ¥è¿›è¡Œæ¡ä»¶é™å®š
- `Name` è¿™ä¸ªæœ‰POJOä¸­çš„å±æ€§åŒ¹é…

ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœç¿»è¯‘æˆsqlï¼Œç›¸å½“äº `delete from money where name=xx`

è°ƒç”¨æ–¹å¼å’Œå‰é¢ä¸€æ ·ï¼Œå¦‚ä¸‹

```java
private void deleteByName() {
    moneyDeleteRepository.deleteByName("jpa ä¸€ç°ç°7");
    showLeft();
}
```

ç„¶åæˆ‘ä»¬æ‰§è¡Œä¸Šé¢çš„æµ‹è¯•ï¼Œå‘ç°å¹¶ä¸èƒ½æˆåŠŸï¼ŒæŠ¥é”™äº†

![](/imgs/190702/02.jpg)

é€šè¿‡å‰é¢updateçš„å­¦ä¹ ï¼ŒçŸ¥é“éœ€è¦æ˜¾ç¤ºåŠ ä¸€ä¸ªäº‹ç‰©çš„æ³¨è§£ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥åŠ åœ¨`Repository`ä¸­

```java
/**
 * æ ¹æ®nameè¿›è¡Œåˆ é™¤
 *
 * @param name
 */
@Transactional
void deleteByName(String name);
```

ç„¶åå†æ¬¡æ‰§è¡Œè¾“å‡ºå¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠsqlçš„æ—¥å¿—ä¹Ÿæ‰“å°äº†

```bash
Hibernate: select moneypo0_.id as id1_0_, moneypo0_.create_at as create_a2_0_, moneypo0_.is_deleted as is_delet3_0_, moneypo0_.money as money4_0_, moneypo0_.name as name5_0_, moneypo0_.update_at as update_a6_0_ from money moneypo0_ where moneypo0_.name=?
Hibernate: delete from money where id=?
Hibernate: select moneypo0_.id as id1_0_, moneypo0_.create_at as create_a2_0_, moneypo0_.is_deleted as is_delet3_0_, moneypo0_.money as money4_0_, moneypo0_.name as name5_0_, moneypo0_.update_at as update_a6_0_ from money moneypo0_ where moneypo0_.id>=?
[MoneyPO(id=20, name=jpa ä¸€ç°ç°5, money=2323, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0), MoneyPO(id=23, name=jpa ä¸€ç°ç°8, money=2666, isDeleted=0, createAt=2019-07-02 08:42:41.0, updateAt=2019-07-02 08:42:41.0)]
```

ä»æœ€ç»ˆå‰©ä½™çš„è®°å½•æ¥çœ‹ï¼Œnameä¸º`jpa ä¸€ç°ç°7`çš„è¢«åˆ é™¤äº†ï¼Œå†çœ‹ä¸€ä¸‹å‰é¢åˆ é™¤çš„sqlï¼Œä¼šå‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼Œ`deleteByName` è¿™ä¸ªæ–¹æ³•ï¼Œç¿»è¯‘æˆsqlå˜æˆäº†ä¸¤æ¡

- `select * from money where name=xxx`  å…ˆæ ¹æ®nameæŸ¥è¯¢è®°å½•
- `delete from money where id = xxx`  æ ¹æ®å‰é¢æŸ¥è¯¢è®°å½•çš„idï¼Œåˆ é™¤è®°å½•

#### c. æ¯”è¾ƒåˆ é™¤

æ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸ªåˆ é™¤moneyåœ¨`[2000,3000]`åŒºé—´çš„è®°å½•ï¼Œè¿™æ—¶æˆ‘ä»¬æ–°å¢çš„æ”¾å…¥å¯ä»¥æ˜¯

```java
/**
 * æ ¹æ®æ•°å­—æ¯”è¾ƒè¿›è¡Œåˆ é™¤
 *
 * @param low
 * @param big
 */
@Transactional
void deleteByMoneyBetween(Long low, Long big);
```

é€šè¿‡æ–¹æ³•å‘½åä¹Ÿå¯ä»¥ç®€å•çŸ¥é“ä¸Šé¢è¿™ä¸ªç­‰åŒäºsql `delete from money where money between xxx and xxx`

æµ‹è¯•ä»£ç ä¸º

```java
private void deleteByCompare() {
    moneyDeleteRepository.deleteByMoneyBetween(2000L, 3000L);
    showLeft();
}
```

è¾“å‡ºæ—¥å¿—

```
Hibernate: select moneypo0_.id as id1_0_, moneypo0_.create_at as create_a2_0_, moneypo0_.is_deleted as is_delet3_0_, moneypo0_.money as money4_0_, moneypo0_.name as name5_0_, moneypo0_.update_at as update_a6_0_ from money moneypo0_ where moneypo0_.money between ? and ?
Hibernate: delete from money where id=?
Hibernate: delete from money where id=?
Hibernate: select moneypo0_.id as id1_0_, moneypo0_.create_at as create_a2_0_, moneypo0_.is_deleted as is_delet3_0_, moneypo0_.money as money4_0_, moneypo0_.name as name5_0_, moneypo0_.update_at as update_a6_0_ from money moneypo0_ where moneypo0_.id>=?
[]
```

ä»æ‹¼æ¥çš„sqlå¯ä»¥çœ‹å‡ºï¼Œä¸Šé¢çš„é€»è¾‘ç­‰åŒäºï¼Œå…ˆæ‰§è¡Œäº†æŸ¥è¯¢ï¼Œç„¶åæ ¹æ®idä¸€ä¸ªä¸€ä¸ªè¿›è¡Œåˆ é™¤....

### 4. å°ç»“

æˆ‘ä»¬é€šè¿‡å£°æ˜æ–¹æ³•çš„æ–¹å¼æ¥å®ç°æ¡ä»¶åˆ é™¤ï¼›éœ€è¦æ³¨æ„

- åˆ é™¤éœ€è¦æ˜¾ç¤ºå£°æ˜äº‹ç‰© `@Transactional`
- åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„è®°å½•ï¼Œä¼šæŠ›å¼‚å¸¸
- å£°æ˜åˆ é™¤æ–¹æ³•æ—¶ï¼Œå®é™…ç­‰åŒäºå…ˆæŸ¥è¯¢è®°å½•ï¼Œç„¶åæ ¹æ®è®°å½•çš„idè¿›è¡Œç²¾å‡†åˆ é™¤



## II. å…¶ä»–


**æºç **

- å·¥ç¨‹ï¼š[https://github.com/liuyueyi/spring-boot-demo](https://github.com/liuyueyi/spring-boot-demo)
- module: [https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/102-jpa](https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/102-jpa)

**ç›¸å…³åšæ–‡**

- [mysqlä¹‹é”ä¸äº‹åŠ¡è¯¦è§£](https://blog.hhui.top/hexblog/2018/03/23/mysql%E4%B9%8B%E9%94%81%E4%B8%8E%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/)
- [Springå­¦ä¹ ä¹‹äº‹åŠ¡çš„ä½¿ç”¨å§¿åŠ¿](https://blog.hhui.top/hexblog/2018/05/12/Spring%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)
- [Springå­¦ä¹ ä¹‹äº‹åŠ¡ç®¡ç†ä¸ä¼ æ’­å±æ€§](https://blog.hhui.top/hexblog/2018/05/13/Spring%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%A0%E6%92%AD%E5%B1%9E%E6%80%A7/)
- [190612-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹åŸºç¡€ç¯å¢ƒæ­å»º](http://spring.hhui.top/spring-blog/2019/06/12/190612-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/)
- [190614-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹æ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿](http://spring.hhui.top/spring-blog/2019/06/14/190614-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E6%96%B0%E5%A2%9E%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)
- [190623-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹updateä½¿ç”¨å§¿åŠ¿](http://spring.hhui.top/spring-blog/2019/06/23/190623-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8Bupdate%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)

