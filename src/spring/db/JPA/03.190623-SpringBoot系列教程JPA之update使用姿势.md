---
order: 3
title: 3.JPAä¹‹updateä½¿ç”¨å§¿åŠ¿
tag: 
  - JPA
category: 
  - SpringBoot
  - DBç³»åˆ—
  - JPA
date: 2019-06-23 09:43:41
keywords: Spring SpringBoot JPA mysql äº‹åŠ¡ update save
---

ä¸Šé¢ä¸¤ç¯‡åšæ–‡æ‹‰å¼€äº†jpaä½¿ç”¨å§¿åŠ¿çš„é¢çº±ä¸€è§’ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ‰¯ï¼Œæ•°æ®æ’å…¥dbä¹‹åï¼Œå¹¶ä¸æ˜¯è¯´å°±ä¸€å±‚ä¸å˜äº†ï¼Œå°±å¥½æ¯”æˆ‘åœ¨é“¶è¡Œå¼€äº†æˆ·ï¼Œå½“ç„¶æ˜¯å‡†å¤‡å¾€é‡Œé¢å­˜é’±äº†ï¼Œæœ‰å­˜å°±æœ‰å–ï¼ˆç‰¹åˆ«æ˜¯å½“ä¸‹é“¶è¡Œåˆ©ç‡è¿™ä¹ˆä½è¿˜ä¸å¦‚ä¹°æ¯”ç‰¹å¸å±¯ç€ï¼Œæˆªæ­¢19å¹´6æœˆ22æ—¥ï¼Œbtcå·²ç»çªç ´1.1w$ï¼Œå¯æƒœæ²¡é’±ä¹°ğŸ˜­ï¼‰è¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ï¼Œæ•°æ®æ›´æ–°--updateçš„ä½¿ç”¨å§¿åŠ¿

<!-- more -->

é€šè¿‡æœ¬ç¯‡åšæ–‡ï¼Œæ‚¨è‡³å°‘å¯ä»¥é€‰åˆ°

- `save()` ç›´æ¥æ ¹æ®idæ¥ä¿®æ”¹è®°å½•
- åˆ©ç”¨`jpl` å®ç°æŸ¥è¯¢ä¿®æ”¹çš„ä½¿ç”¨å§¿åŠ¿
- åˆè¯†äº‹ç‰©çš„ç¥ç§˜é¢çº±

## I. ç¯å¢ƒå‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå½“ç„¶å¾—å…ˆå‡†å¤‡å¥½åŸºç¡€ç¯å¢ƒï¼Œå¦‚å®‰è£…æµ‹è¯•ä½¿ç”¨mysqlï¼Œåˆ›å»ºSpringBooté¡¹ç›®å·¥ç¨‹ï¼Œè®¾ç½®å¥½é…ç½®ä¿¡æ¯ç­‰ï¼Œå…³äºæ­å»ºé¡¹ç›®çš„è¯¦æƒ…å¯ä»¥å‚è€ƒå‰ä¸€ç¯‡æ–‡ç«  
- [190612-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹åŸºç¡€ç¯å¢ƒæ­å»º](http://spring.hhui.top/spring-blog/2019/06/12/190612-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/)
- [190614-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹æ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿](http://spring.hhui.top/spring-blog/2019/06/14/190614-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E6%96%B0%E5%A2%9E%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)

ä¸‹é¢ç®€å•çš„çœ‹ä¸€ä¸‹æ¼”ç¤ºæ·»åŠ è®°å½•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦çš„é…ç½®

### 1. è¡¨å‡†å¤‡

æ²¿ç”¨å‰ä¸€ç¯‡çš„è¡¨ï¼Œç»“æ„å¦‚ä¸‹

```sql
CREATE TABLE `money` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `money` int(26) NOT NULL DEFAULT '0' COMMENT 'é’±',
  `is_deleted` tinyint(1) NOT NULL DEFAULT '0',
  `create_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `name` (`name`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4;
```

### 2. é¡¹ç›®é…ç½®

é…ç½®ä¿¡æ¯ï¼Œä¸ä¹‹å‰æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œæˆ‘ä»¬æ–°å¢äº†æ›´è¯¦ç»†çš„æ—¥å¿—æ‰“å°ï¼›æœ¬ç¯‡ä¸»è¦ç›®æ ‡é›†ä¸­åœ¨æ·»åŠ è®°å½•çš„ä½¿ç”¨å§¿åŠ¿ï¼Œå¯¹äºé…ç½®è¯´æ˜ï¼Œåé¢å•ç‹¬è¿›è¡Œè¯´æ˜

```properties
## DataSource
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/story?useUnicode=true&characterEncoding=UTF-8&useSSL=false
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=
## jpaç›¸å…³é…ç½®
spring.jpa.database=MYSQL
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jackson.serialization.indent_output=true
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
```

### 3. æ•°æ®å‡†å¤‡

æ•°æ®ä¿®æ”¹å˜›ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå‘è¡¨é‡Œé¢æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œç”¨äºåé¢çš„æ“ä½œ

```sql
INSERT INTO `money` (`id`, `name`, `money`, `is_deleted`, `create_at`, `update_at`)
VALUES
	(21, 'jpa ä¿®æ”¹->ä¸€ç°ç°', 1212, 0, '2019-06-22 21:41:13', '2019-06-22 21:41:13'),
	(22, 'jpa ä¿®æ”¹->ä¸€ç°ç°', 6666, 0, '2019-06-22 21:41:13', '2019-06-22 21:41:13');
```

![](/imgs/190623/00.jpg)

## II. Updateä½¿ç”¨æ•™ç¨‹

ä¸‹é¢å¼€å§‹è¿›å…¥æ­£é¢˜ï¼Œä¸ºæ–¹ä¾¿åˆçœ‹çš„åŒå­¦ï¼ˆæ²¡ç©ºæˆ–è€…æ²¡å…´è¶£ç…å‰é¢å‡ ä¸ªåšæ–‡çš„åŒå­¦ï¼‰ä¼šæœ‰éƒ¨åˆ†å†…å®¹å’Œå‰é¢çš„åšæ–‡ç›¸åŒï¼Œçœ‹è¿‡çš„è¯·æ— è§†

### 1. è¡¨å…³è”POJO

å‰é¢æ’å…¥ç¯‡å·²ç»ä»‹ç»äº†POJOçš„é€æ­¥åˆ›å»ºè¿‡ç¨‹ï¼Œå·²ç»å¯¹åº”çš„æ³¨è§£å«ä¹‰ï¼Œä¸‹é¢ç›´æ¥è´´å‡ºæˆæœ

```java
@Data
@DynamicInsert
@Entity
@Table(name = "money")
public class MoneyPO {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")

    private Integer id;

    @Column(name = "name")
    private String name;

    @Column(name = "money")
    private Long money;

    @Column(name = "is_deleted")
    private Byte isDeleted;

    @Column(name = "create_at")
    @CreatedDate
    private Timestamp createAt;

    @Column(name = "update_at")
    @CreatedDate
    private Timestamp updateAt;
}
```

ä¸Šé¢ç±»ä¸­çš„å‡ ä¸ªæ³¨è§£ï¼Œè¯´æ˜å¦‚ä¸‹

- `@Data` å±äºlombokæ³¨è§£ï¼Œä¸jpaæ— å…³ï¼Œè‡ªåŠ¨ç”Ÿæˆ`getter/setter/equals/hashcode/tostring`ç­‰æ–¹æ³•
- `@Entity`, `@Table` jpaæ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»ä¸dbçš„è¡¨å…³è”ï¼Œå…·ä½“åŒ¹é…çš„æ˜¯è¡¨ `money`
- `@Id` `@GeneratedValue` ä½œç”¨ä¸è‡ªå¢ä¸»é”®
- `@Column`è¡¨æ˜è¿™ä¸ªå±æ€§ä¸è¡¨ä¸­çš„æŸåˆ—å¯¹åº”
- `@CreateDate`æ ¹æ®å½“å‰æ—¶é—´æ¥ç”Ÿæˆé»˜è®¤çš„æ—¶é—´æˆ³

### 2. Repository APIå£°æ˜

æ¥ä¸‹æ¥æˆ‘ä»¬æ–°å»ºä¸€ä¸ªapiç»§æ‰¿è‡ª`CurdRepository`ï¼Œç„¶åé€šè¿‡è¿™ä¸ªapiæ¥ä¸æ•°æ®åº“æ‰“äº¤é“

```java
public interface MoneyUpdateRepository extends CrudRepository<MoneyPO, Integer> {
}
```

### 3. ä½¿ç”¨å§¿åŠ¿

#### a. save

åœ¨å‰é¢ä¸€ç¯‡æ’å…¥åšæ–‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å½“POJOçš„idå­˜åœ¨æ—¶ï¼Œè°ƒç”¨saveæ–¹æ³•å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µ

- è‹¥dbä¸­è¿™ä¸ªidå¯¹åº”çš„å­—æ®µä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥
- è‹¥dbä¸­è¿™ä¸ªidå¯¹åº”çš„å­—æ®µå­˜åœ¨ï¼Œåˆ™æ›´æ–°

æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹æ›´æ–°çš„æ•ˆæœï¼Œä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†ä¸¤å—ï¼Œä¸€ä¸ªæ˜¯å½“poä¸­çš„æ‰€æœ‰æˆå‘˜å€¼æœ‰æ•ˆï¼Œæ›´æ–°å…¶ä¸­çš„ä¸€ä¸ªæ—¶ï¼Œä¼šæ€æ ·ï¼›å¦å¤–ä¸€ä¸ªæ¼”ç¤ºçš„æ˜¯éƒ¨åˆ†æ›´æ–°æ—¶ä¼šæ€æ ·ï¼ˆnameä¸ºç©ºï¼Œè¡¨ç¤ºæˆ‘ä¸å¸Œæœ›æ›´æ–°nameï¼‰

```java
public void simpleUpdateById() {
    MoneyPO record = moneyUpdateRepository.findById(21).get();
    // ç›´æ¥ä¿®æ”¹è¿™ä¸ªrecordçš„å†…å®¹
    record.setMoney(3333L);
    moneyUpdateRepository.save(record);

    record = moneyUpdateRepository.findById(21).get();
    System.out.println("after updateMoney record: " + record);


    record.setName(null);
    record.setMoney(6666L);
    moneyUpdateRepository.save(record);
    
    record = moneyUpdateRepository.findById(21).get();
    System.out.println("after updateMoney record: " + record);
}
```

è¾“å‡ºç»“æœå‘ç°ï¼Œå‰é¢æ‰§è¡ŒæˆåŠŸï¼Œåé¢æ‰§è¡Œå¤±è´¥

![](/imgs/190623/01.jpg)

ä¸Šé¢ä¸ºç¬¬ä¸€ä¸ªæ‰§è¡Œç»“æœï¼Œä»æ‹¼æ¥çš„sqlå¯ä»¥çŸ¥é“ï¼Œæ˜¯å…¨é‡çš„ä¿®æ”¹ï¼›è¾“å‡ºç»“æœä¹Ÿå¦‚æˆ‘ä»¬é¢„æœŸ

åé¢å°†nameè®¾ç½®ä¸ºç©ºä¹‹åï¼Œå†æ¬¡æ›´æ–°ï¼Œå‘ç°æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ä¸‹ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬çš„dbé™åˆ¶ï¼Œå­—æ®µä¸å…è®¸æœ‰nullçš„å­˜åœ¨

![](/imgs/190623/02.jpg)


ä»æ‹¼æ¥çš„sqlä¸Šçœ‹ï¼Œæˆ‘ä»¬çŸ¥é“æ˜¯å› ä¸ºæ¯ä¸ªæˆå‘˜éƒ½ä½œä¸ºäº†`update sql`å®¶æ—çš„ä¸€å‘˜ï¼Œåœ¨insertè¿™ä¸€ç¯‡ä¸­æˆ‘ä»¬ä¹Ÿé‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œå½“æ—¶æ˜¯åœ¨POJOä¸Šæ·»åŠ æ³¨è§£`@DynamicInsert`ï¼Œæ ¹æ®å®é™…éœ€è¦é€‰æ‹©æ’å…¥ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°è¿™é‡Œæ˜¯ä¸æ˜¯ä¹Ÿæœ‰ç±»ä¼¼çš„æ³¨è§£å‘¢

```java
@Data
@DynamicUpdate
@DynamicInsert
@Entity
@Table(name = "money")
public class MoneyPO {
}
```

åœ¨pojoä¸Šæ·»åŠ æ³¨è§£`@DynamicUpdate`ä¹‹åï¼Œå†æ¬¡è¿›è¡Œå°è¯•ï¼Œç»“æœå¦‚ä¸‹

![](/imgs/190623/03.jpg)

å±…ç„¶è¿˜æ˜¯å¤±è´¥äº†ï¼Œä»è¾“å‡ºçš„sqlæ¥çœ‹ï¼Œå±…ç„¶æŠŠ`name`å’Œ`money`éƒ½å½“æˆäº†sqlçš„ä¸€éƒ¨åˆ†ï¼Œéš¾é“æ˜¯å› ä¸ºæˆ‘ä»¬è°ƒç”¨äº†setteræ–¹æ³•çš„åŸå› ä¹ˆã€‚å¾…ç€çŒœæµ‹ï¼Œå†æ¥ä¸€æ¬¡

```java
MoneyPO toUpdate = new MoneyPO();
toUpdate.setId(21);
toUpdate.setMoney(6666L);
moneyUpdateRepository.save(toUpdate);
record = moneyUpdateRepository.findById(21).get();
System.out.println("after updateMoney record: " + record);
```

è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œçœ‹æ¥æˆ‘ä»¬ä¸Šé¢çš„çŒœæµ‹å¹¶ä¸å¯¹ï¼Œæ‹¼æ¥sqlåº”è¯¥æ˜¯æ ¹æ®å“ªä¸ªå­—æ®µå‘ç”Ÿäº†å˜åŒ–ï¼Œå°±æŠŠå“ªä¸ªåšä¸ºsqlçš„ä¸€éƒ¨åˆ†æ¥åšçš„

![](/imgs/190623/04.jpg)

ä¸Šé¢è¿™ä¸ªä½¿ç”¨å§¿åŠ¿çœ‹å®Œä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªæ›´æ–°çš„æ”¯æŒï¼Œå¿…é¡»å…ˆè·å–ç›®æ ‡å¯¹è±¡å†è¿›è¡Œä¿®æ”¹ï¼Œå¾ˆéš¾æ»¡è¶³æˆ‘ä»¬çš„æ—¥å¸¸ä¸šåŠ¡åœºæ™¯ï¼›

#### b. æŸ¥è¯¢æ›´æ–°

æ ¹æ®æŸä¸ªæ¡ä»¶æ¥æ›´æ–°å¯¹åº”çš„æ•°æ®ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒå¸¸è§äº†ï¼Œåœ¨jpaä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æ ¹æ®æ–¹æ³•åæ¥æ”¯æ’‘è¿™ç§åœºæ™¯çš„æ–¹å¼ï¼Œä½†æ˜¯å‘ç°äº†å¦å¤–ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿--`jql`

ç›´æ¥åœ¨æ–¹æ³•æ–¹é¢ï¼Œæ·»åŠ æ³¨è§£ï¼Œæ³¨è§£å†…éƒ¨å†™sql

```java
/**
 * æ ¹æ®é‡‘é’±æ¥ä¿®æ”¹çŠ¶æ€
 *
 * @param money
 * @param state
 */
@Modifying
@Query("update MoneyPO m set m.isDeleted=?2 where  m.money=?1")
void updateStateByMoney(Long money, Byte state);

/**
 * è¡¨è¾¾å¼è®¡ç®—
 *
 * @param id
 * @param money
 */
@Modifying
@Query("update MoneyPO m set m.money=m.money + ?2 where m.id=?1")
void addMoneyById(Integer id, Long money);
```

ä¸Šé¢å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ›´æ–°çš„caseï¼Œæ³¨æ„ä¸¤ä¸ªæ³¨è§£

- `@Modifying` è¿™ä¸ªå¿…é¡»æœ‰ï¼Œå‘Šè¯‰æ¡†æ¶æˆ‘ä»¬æ‰§è¡Œçš„æ˜¯æ›´æ–°/åˆ é™¤æ“ä½œ
- `@Query` å†…éƒ¨æ˜¯æ­£å¸¸çš„sqlè¯­å¥ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¡¨åï¼Œä¸æ˜¯å®é™…çš„è¡¨ï¼Œè€Œæ˜¯æˆ‘ä»¬å‰é¢å®šä¹‰çš„POJO

ç„¶åæ¥æµ‹è¯•ä¸€ä¸‹ä½¿ç”¨

```java
public void updateByQuery() {
    // é€šè¿‡æŸ¥è¯¢ä¿®æ”¹
    moneyUpdateRepository.updateStateByMoney(6666L, (byte) 0x01);

    MoneyPO record = moneyUpdateRepository.findById(21).get();
    System.out.println("after update record: " + record);


    moneyUpdateRepository.addMoneyById(21, 3333L);
    record = moneyUpdateRepository.findById(21).get();
    System.out.println("after addMoney record: " + record);
}
```

æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‚²å‚¬çš„å‘ç°å±…ç„¶æŠ¥é”™äº† `Caused by: javax.persistence.TransactionRequiredException: Executing an update/delete query`

![](/imgs/190623/05.jpg)

ä»å †æ ˆçš„æè¿°ä¸Šæ¥çœ‹ï¼Œæ›´æ–°/åˆ é™¤å¿…é¡»è¦å¼€å¯äº‹åŠ¡ï¼Œé‚£ä¹ˆäº‹åŠ¡æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿä¸‹é¢æ¨èå‡ ç¯‡åšæ–‡

- [mysqlä¹‹é”ä¸äº‹åŠ¡è¯¦è§£](https://blog.hhui.top/hexblog/2018/03/23/mysql%E4%B9%8B%E9%94%81%E4%B8%8E%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/)
- [Springå­¦ä¹ ä¹‹äº‹åŠ¡çš„ä½¿ç”¨å§¿åŠ¿](https://blog.hhui.top/hexblog/2018/05/12/Spring%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)
- [Springå­¦ä¹ ä¹‹äº‹åŠ¡ç®¡ç†ä¸ä¼ æ’­å±æ€§](https://blog.hhui.top/hexblog/2018/05/13/Spring%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%A0%E6%92%AD%E5%B1%9E%E6%80%A7/)

å…³äºjpaä¸­æ›´å¤šäº‹åŠ¡ç›¸å…³çš„ï¼Œåé¢å†å¼•å…¥ï¼Œæˆ‘ä»¬å…ˆå›åˆ°æœ¬æ–‡ä¸»é¢˜ï¼Œå¦‚ä½•è§£å†³é—®é¢˜: åœ¨è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ä¸Šé¢æ·»åŠ äº‹åŠ¡æ³¨è§£å³å¯

```java
@Transactional
public void testUpdate() {
    simpleUpdateById();
    updateByQuery();
}
```

å†æ¬¡æ‰§è¡Œä¹‹åï¼Œç»“æœå¦‚ä¸‹

![](/imgs/190623/06.jpg)

çœ‹ä¸Šé¢çš„ç»“æœï¼Œå‘ç°money+3333ä¹‹åçš„è¾“å‡ºç»“æœå±…ç„¶è¿˜æ˜¯6666ï¼›ä½†æ˜¯æˆ‘ä»¬å†çœ‹dbçš„ç»“æœï¼Œå·²ç»æ˜¯9999äº†ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ

![](/imgs/190623/07.jpg)

ä¸Šé¢è¿™ä¸ªé—®é¢˜æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œåˆæ­¥çŒœæµ‹ä¸äº‹ç‰©å·²ç»jpaçš„å†…éƒ¨ç¼“å­˜æœºåˆ¶æœ‰å…³ç³»ï¼Œè‡³äºå…·ä½“æ˜¯ä¸æ˜¯è¿™æ ·ï¼Œæœ‰å¿…è¦ä¸“é—¨å¼€å‘æ¥éªŒè¯ä¸€äºŒ

### 4. å°ç»“

åˆ©ç”¨JPAå®ç°è¡¨æ•°æ®çš„æ›´æ–°ï¼Œä¸Šé¢ä¸»è¦ä»‹ç»äº†ä¸¤ç§æ–¹å¼ï¼Œ save + jql

**save**

é€šè¿‡saveæ›´æ–°æ—¶ï¼Œéœ€è¦æŒ‡å®šidæ¥å®ç°å•æ¡è®°å½•çš„ä¿®æ”¹

**jql**

è¯­æ³•ä¸sqlå·®ä¸å¤šï¼Œé…åˆä¸¤ä¸ªæ³¨è§£ `@Modifying`, `@Query`æ¥ä½¿ç”¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œä¸¤ç‚¹éœ€è¦æ³¨æ„

- è¡¨åæ˜¯æˆ‘ä»¬å®šä¹‰çš„ä¸dbä¸­è¡¨å…³è”çš„POJO
- å‚æ•°ä¼ é€’æ ¼å¼ä¸º`?index`ï¼Œ indexä¸ºå‚æ•°ä½ç½®

```java
@Modifying
@Query("update MoneyPO m set m.isDeleted=?2 where  m.money=?1")
void updateStateByMoney(Long money, Byte state);
```

æ•°æ®ä¿®æ”¹å’Œåˆ é™¤ï¼Œéœ€è¦æ˜¾ç¤ºå£°æ˜äº‹åŠ¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œä¸€ä¸ªæ˜¯åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ `@Transactional`ï¼Œæˆ–è€…ç›´æ¥åœ¨repository apiçš„æ¥å£ä¸Šæ·»åŠ æ³¨è§£ `@Transactional`


## II. å…¶ä»–

### 0. æºç ä¸ç›¸å…³åšæ–‡

**æºç **

- å·¥ç¨‹ï¼š[https://github.com/liuyueyi/spring-boot-demo](https://github.com/liuyueyi/spring-boot-demo)
- module: [https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/102-jpa](https://github.com/liuyueyi/spring-boot-demo/blob/master/spring-boot/102-jpa)

**ç›¸å…³åšæ–‡**

- [mysqlä¹‹é”ä¸äº‹åŠ¡è¯¦è§£](https://blog.hhui.top/hexblog/2018/03/23/mysql%E4%B9%8B%E9%94%81%E4%B8%8E%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/)
- [Springå­¦ä¹ ä¹‹äº‹åŠ¡çš„ä½¿ç”¨å§¿åŠ¿](https://blog.hhui.top/hexblog/2018/05/12/Spring%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)
- [Springå­¦ä¹ ä¹‹äº‹åŠ¡ç®¡ç†ä¸ä¼ æ’­å±æ€§](https://blog.hhui.top/hexblog/2018/05/13/Spring%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E4%B8%8E%E4%BC%A0%E6%92%AD%E5%B1%9E%E6%80%A7/)
- [190612-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹åŸºç¡€ç¯å¢ƒæ­å»º](http://spring.hhui.top/spring-blog/2019/06/12/190612-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/)
- [190614-SpringBootç³»åˆ—æ•™ç¨‹JPAä¹‹æ–°å¢è®°å½•ä½¿ç”¨å§¿åŠ¿](http://spring.hhui.top/spring-blog/2019/06/14/190614-SpringBoot%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8BJPA%E4%B9%8B%E6%96%B0%E5%A2%9E%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)

